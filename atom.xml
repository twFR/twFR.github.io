<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://twFR.github.io</id>
    <title>ğŸŒŸè°­å…ˆç”Ÿâœ¨</title>
    <updated>2021-01-17T12:10:52.101Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://twFR.github.io"/>
    <link rel="self" href="https://twFR.github.io/atom.xml"/>
    <subtitle>æ•²ä¸å‡ºä»£ç çš„ç¨‹åºçŒ¿çš„ğŸ </subtitle>
    <logo>https://twFR.github.io/images/avatar.png</logo>
    <icon>https://twFR.github.io/favicon.ico</icon>
    <rights>All rights reserved 2021, ğŸŒŸè°­å…ˆç”Ÿâœ¨</rights>
    <entry>
        <title type="html"><![CDATA[Time Format]]></title>
        <id>https://twFR.github.io/post/time-format/</id>
        <link href="https://twFR.github.io/post/time-format/">
        </link>
        <updated>2021-01-16T06:28:09.000Z</updated>
        <content type="html"><![CDATA[<p>æ˜¨å¤©å¬é«˜äººè¯´golangçš„time formatå¾ˆæœ‰æ„æ€ï¼Œä¹‹å‰æ²¡æœ‰ç”¨åˆ°è¿‡ï¼Œä¸“é—¨äº†è§£äº†ä¸€ä¸‹<br>
å½“æˆ‘è¯•ç€éšä¾¿å¦‚ä¸‹æ‰“å°å½“å‰æ—¶é—´ï¼š</p>
<pre><code>fmt.Println(time.Now().Format(&quot;2021å¹´1æœˆ16æ—¥&quot; ))
</code></pre>
<p>output:</p>
<pre><code>16161å¹´1æœˆ16æ—¥
</code></pre>
<p>å¤§æƒ‘ä¸è§£ï¼Œgoogeläº†ä¸€ä¸‹ï¼Œè¯´æ˜¯ä¸€å®šè¦ç”¨å›ºå®šçš„æ—¶é—´å»æ ¼å¼åŒ–ï¼ŒGoçš„è›‹è¾°ï¼Œæœç„¶ä»ªå¼æ„Ÿè¿˜æ˜¯å¾ˆé‡è¦çš„ï¼Œå¦‚ä¸‹</p>
<pre><code>fmt.Println(time.Now().Format(&quot;2006å¹´1æœˆ2æ—¥ 15:04:05&quot; ))
fmt.Println(time.Now().Format(&quot;2006å¹´1æœˆ2æ—¥&quot; ))
</code></pre>
<p>output:</p>
<pre><code>2021å¹´1æœˆ16æ—¥ 18:37:18
2021å¹´1æœˆ16æ—¥
</code></pre>
<p>ç¨å¾®çœ‹ä¸‹æºç <br>
åœ¨AppendFormatæ–¹æ³•é‡Œè°ƒç”¨nextStdChunkæ–¹æ³•ï¼Œç¡®å®æ˜¯ç”¨å¾ªç¯å»å¯¹å›ºå®šçš„æ—¶é—´æ£€ç´¢ï¼š</p>
<pre><code>// nextStdChunk finds the first occurrence of a std string in
// layout and returns the text before, the std string, and the text after.
func nextStdChunk(layout string) (prefix string, std int, suffix string) {
	for i := 0; i &lt; len(layout); i++ {
		switch c := int(layout[i]); c {
		case 'J': // January, Jan
			if len(layout) &gt;= i+3 &amp;&amp; layout[i:i+3] == &quot;Jan&quot; {
				if len(layout) &gt;= i+7 &amp;&amp; layout[i:i+7] == &quot;January&quot; {
					return layout[0:i], stdLongMonth, layout[i+7:]
				}
				if !startsWithLowerCase(layout[i+3:]) {
					return layout[0:i], stdMonth, layout[i+3:]
				}
			}

		case 'M': // Monday, Mon, MST
			if len(layout) &gt;= i+3 {
				if layout[i:i+3] == &quot;Mon&quot; {
					if len(layout) &gt;= i+6 &amp;&amp; layout[i:i+6] == &quot;Monday&quot; {
						return layout[0:i], stdLongWeekDay, layout[i+6:]
					}
					if !startsWithLowerCase(layout[i+3:]) {
						return layout[0:i], stdWeekDay, layout[i+3:]
					}
				}
				if layout[i:i+3] == &quot;MST&quot; {
					return layout[0:i], stdTZ, layout[i+3:]
				}
			}

		case '0': // 01, 02, 03, 04, 05, 06, 002
			if len(layout) &gt;= i+2 &amp;&amp; '1' &lt;= layout[i+1] &amp;&amp; layout[i+1] &lt;= '6' {
				return layout[0:i], std0x[layout[i+1]-'1'], layout[i+2:]
			}
			if len(layout) &gt;= i+3 &amp;&amp; layout[i+1] == '0' &amp;&amp; layout[i+2] == '2' {
				return layout[0:i], stdZeroYearDay, layout[i+3:]
			}

		case '1': // 15, 1
			if len(layout) &gt;= i+2 &amp;&amp; layout[i+1] == '5' {
				return layout[0:i], stdHour, layout[i+2:]
			}
			return layout[0:i], stdNumMonth, layout[i+1:]

		case '2': // 2006, 2
			if len(layout) &gt;= i+4 &amp;&amp; layout[i:i+4] == &quot;2006&quot; {
				return layout[0:i], stdLongYear, layout[i+4:]
			}
			return layout[0:i], stdDay, layout[i+1:]

		case '_': // _2, _2006, __2
			if len(layout) &gt;= i+2 &amp;&amp; layout[i+1] == '2' {
				//_2006 is really a literal _, followed by stdLongYear
				if len(layout) &gt;= i+5 &amp;&amp; layout[i+1:i+5] == &quot;2006&quot; {
					return layout[0 : i+1], stdLongYear, layout[i+5:]
				}
				return layout[0:i], stdUnderDay, layout[i+2:]
			}
			if len(layout) &gt;= i+3 &amp;&amp; layout[i+1] == '_' &amp;&amp; layout[i+2] == '2' {
				return layout[0:i], stdUnderYearDay, layout[i+3:]
			}

		case '3':
			return layout[0:i], stdHour12, layout[i+1:]

		case '4':
			return layout[0:i], stdMinute, layout[i+1:]

		case '5':
			return layout[0:i], stdSecond, layout[i+1:]

		case 'P': // PM
			if len(layout) &gt;= i+2 &amp;&amp; layout[i+1] == 'M' {
				return layout[0:i], stdPM, layout[i+2:]
			}

		case 'p': // pm
			if len(layout) &gt;= i+2 &amp;&amp; layout[i+1] == 'm' {
				return layout[0:i], stdpm, layout[i+2:]
			}

		case '-': // -070000, -07:00:00, -0700, -07:00, -07
			if len(layout) &gt;= i+7 &amp;&amp; layout[i:i+7] == &quot;-070000&quot; {
				return layout[0:i], stdNumSecondsTz, layout[i+7:]
			}
			if len(layout) &gt;= i+9 &amp;&amp; layout[i:i+9] == &quot;-07:00:00&quot; {
				return layout[0:i], stdNumColonSecondsTZ, layout[i+9:]
			}
			if len(layout) &gt;= i+5 &amp;&amp; layout[i:i+5] == &quot;-0700&quot; {
				return layout[0:i], stdNumTZ, layout[i+5:]
			}
			if len(layout) &gt;= i+6 &amp;&amp; layout[i:i+6] == &quot;-07:00&quot; {
				return layout[0:i], stdNumColonTZ, layout[i+6:]
			}
			if len(layout) &gt;= i+3 &amp;&amp; layout[i:i+3] == &quot;-07&quot; {
				return layout[0:i], stdNumShortTZ, layout[i+3:]
			}

		case 'Z': // Z070000, Z07:00:00, Z0700, Z07:00,
			if len(layout) &gt;= i+7 &amp;&amp; layout[i:i+7] == &quot;Z070000&quot; {
				return layout[0:i], stdISO8601SecondsTZ, layout[i+7:]
			}
			if len(layout) &gt;= i+9 &amp;&amp; layout[i:i+9] == &quot;Z07:00:00&quot; {
				return layout[0:i], stdISO8601ColonSecondsTZ, layout[i+9:]
			}
			if len(layout) &gt;= i+5 &amp;&amp; layout[i:i+5] == &quot;Z0700&quot; {
				return layout[0:i], stdISO8601TZ, layout[i+5:]
			}
			if len(layout) &gt;= i+6 &amp;&amp; layout[i:i+6] == &quot;Z07:00&quot; {
				return layout[0:i], stdISO8601ColonTZ, layout[i+6:]
			}
			if len(layout) &gt;= i+3 &amp;&amp; layout[i:i+3] == &quot;Z07&quot; {
				return layout[0:i], stdISO8601ShortTZ, layout[i+3:]
			}

		case '.': // .000 or .999 - repeated digits for fractional seconds.
			if i+1 &lt; len(layout) &amp;&amp; (layout[i+1] == '0' || layout[i+1] == '9') {
				ch := layout[i+1]
				j := i + 1
				for j &lt; len(layout) &amp;&amp; layout[j] == ch {
					j++
				}
				// String of digits must end here - only fractional second is all digits.
				if !isDigit(layout, j) {
					std := stdFracSecond0
					if layout[i+1] == '9' {
						std = stdFracSecond9
					}
					std |= (j - (i + 1)) &lt;&lt; stdArgShift
					return layout[0:i], std, layout[j:]
				}
			}
		}
	}
	return layout, 0, &quot;&quot;
}
</code></pre>
<p>è®°æ—¶é—´æ–¹æ³•ä¹ŸæŒºç®€å• 6(å¹´)1(æœˆ)2(æ—¥)3(æ—¶)4(åˆ†)5(ç§’),ä¸¥é‡æ€€ç–‘åªæ˜¯ä¸ºäº†ç®€å•ã€‚ çœ‹æ¥æˆ‘è¿˜æ˜¯å¤ªå•çº¯</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[operator summary]]></title>
        <id>https://twFR.github.io/post/operator-summary/</id>
        <link href="https://twFR.github.io/post/operator-summary/">
        </link>
        <updated>2020-10-21T01:45:45.000Z</updated>
        <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ">æ¦‚å¿µ</h2>
<p>Operator æ˜¯ä¸€ç»„è½¯ä»¶ï¼Œå¯ç”¨äºé™ä½è¿è¡Œå…¶ä»–è½¯ä»¶çš„æ“ä½œå¤æ‚ç¨‹åº¦ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼ŒOperator æ˜¯ä¸€ç§æ‰“åŒ…ã€éƒ¨ç½²å’Œç®¡ç† Kubernetes åº”ç”¨ç¨‹åºçš„æ–¹æ³•ã€‚<br>
operatorå¯ä»¥ï¼š</p>
<ul>
<li>é‡å¤å®‰è£…å’Œå‡çº§</li>
<li>æŒç»­å¯¹æ¯ä¸ªç³»ç»Ÿç»„ä»¶æ‰§è¡Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥</li>
<li>æ±‡æ€»ç°åœºå·¥ç¨‹å¸ˆäº†è§£çš„æƒ…å†µå¹¶å°†å…¶ä¼ è¾“ç»™æ‰€æœ‰ç”¨æˆ·ï¼Œè€Œéä¸€ä¸¤ä¸ªç”¨æˆ·<br>
operatorä¸servie brokerç›¸æ¯”ï¼š</li>
<li>Service Broker æœç€å®ç°åº”ç”¨ç¨‹åºçš„ç¼–ç¨‹å¼å‘ç°å’Œéƒ¨ç½²çš„ç›®æ ‡å‰è¿›äº†ä¸€æ­¥ã€‚ä½†å®ƒå¹¶éä¸€ä¸ªé•¿æ—¶é—´è¿è¡Œçš„è¿›ç¨‹ï¼Œæ‰€ä»¥æ— æ³•æ‰§è¡Œç¬¬ 2 å¤©æ“ä½œï¼Œå¦‚å‡çº§ã€æ•…éšœè½¬ç§»æˆ–æ‰©å±•ã€‚å®ƒåœ¨å®‰è£…æ—¶æä¾›å¯¹å¯è°ƒå‚æ•°çš„è‡ªå®šä¹‰å’Œå‚æ•°åŒ–ï¼Œè€Œ Operator åˆ™å¯æŒç»­ç›‘æ§é›†ç¾¤çš„å½“å‰çŠ¶æ€ã€‚éé›†ç¾¤æœåŠ¡ä»éå¸¸é€‚åˆäº Service Brokerï¼Œä½†ä¹Ÿå­˜åœ¨åˆé€‚äºè¿™äº›æœåŠ¡çš„ Operator</li>
</ul>
<h2 id="operator-framework">operator framework</h2>
<ul>
<li><strong>operator SDK</strong>   è¾…åŠ©å¼€å‘è€…æ ¹æ®è‡ªèº«ä¸“ä¸šçŸ¥è¯†ï¼Œå¼•å¯¼ï¼Œæ„å»ºï¼Œæµ‹è¯•å’ŒåŒ…è£…å…¶operator</li>
<li><strong>Operator Lifecycle</strong> Manager æ§åˆ¶é›†ç¾¤ä¸­operatorçš„å®‰è£…ï¼Œå‡çº§å’ŒåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰</li>
<li><strong>Operator Registry</strong> å­˜å‚¨CSVå’ŒCRDä»¥ä¾¿åœ¨é›†ç¾¤ä¸­åˆ›å»ºï¼Œå¹¶å­˜å‚¨æœ‰å…³è½¯ä»¶åŒ…å’Œé¢‘é“çš„operatorå…ƒæ•°æ®</li>
<li>OperatorHub</li>
<li>Operator Metering</li>
</ul>
<h3 id="å¸¸ç”¨æœ¯è¯­">å¸¸ç”¨æœ¯è¯­</h3>
<ul>
<li><strong>bundle</strong> åœ¨bndle fromatä¸­ï¼Œbundleæ˜¯CSVï¼Œmanifestsä»¥åŠmetadataçš„é›†åˆ</li>
<li><strong>CatalogSource</strong> å®šä¹‰åº”ç”¨ç¨‹åºçš„CSV CRDå’Œè½¯ä»¶åŒ…ä»“åº“</li>
<li><strong>channel</strong>  channelä¸º Operator å®šä¹‰æ›´æ–°æµï¼Œç”¨äºä¸ºè®¢é˜…è€…æ¨å‡ºæ›´æ–°ã€‚channel headæŒ‡å‘è¯¥channelçš„æœ€æ–°ç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œstable channelä¸­ä¼šåŒ…å« Operator çš„æ‰€æœ‰ç¨³å®šç‰ˆæœ¬ï¼ŒæŒ‰ç”±æ—§åˆ°æ–°çš„é¡ºåºæ’åˆ—</li>
<li><strong>CSV</strong> CSVæ˜¯åˆ©ç”¨operatorçš„manifeståˆ›å»ºçš„YAMLæ¸…å•ï¼Œå¯è¾…åŠ©olmåœ¨é›†ç¾¤ä¸­è¿è¡Œoperatorã€‚é™„å¸¦çš„manifestè¿˜å¯ç”¨äºåœ¨ç”¨æˆ·ç•Œé¢å¡«å……å¾½æ ‡ æè¿°å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒCSV è¿˜æ˜¯è¿è¡Œ Operator æ‰€éœ€çš„æŠ€æœ¯ä¿¡æ¯æ¥æºï¼Œç±»ä¼¼äºå…¶éœ€è¦çš„ RBAC è§„åˆ™åŠå…¶ç®¡ç†æˆ–ä¾èµ–çš„è‡ªå®šä¹‰èµ„æº (CR)ã€‚</li>
<li><strong>InstallPlan</strong> ipæ˜¯ä¸€ä¸ªåˆ—å‡ºäº†ä¸ºè‡ªåŠ¨å®‰è£…æˆ–å‡çº§ CSV è€Œéœ€åˆ›å»ºçš„èµ„æºçš„è®¡ç®—åˆ—è¡¨</li>
<li><strong>OperatorGroup</strong> ogå°†éƒ¨ç½²åœ¨åŒä¸€å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰ Operator é…ç½®ä¸ºogå¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ä¸€ç³»åˆ—å‘½åç©ºé—´æˆ–é›†ç¾¤èŒƒå›´å†…ç›‘è§†å…¶ CRã€‚</li>
<li><strong>Subscription</strong> subé€šè¿‡è·Ÿè¸ªè½¯ä»¶åŒ…ä¸­çš„é¢‘é“æ¥ä¿æŒ CSV æœ€æ–°ã€‚</li>
</ul>
<h3 id="operator-lifecycle-manager">Operator Lifecycle Manager</h3>
<p>olmå¯å¸®åŠ©ç”¨æˆ·å®‰è£… æ›´æ–°å’Œç®¡ç†æ‰€æœ‰operatorçš„ç”Ÿå‘½å‘¨æœŸ</p>
<ol>
<li>olmèµ„æº
<ul>
<li>ç”±olm oeratorå’Œcatalog oeratorç®¡ç†çš„CRD
<ul>
<li><strong>CSV</strong> OLM éœ€è¦ä¸ Operator ç›¸å…³çš„å…ƒæ•°æ®ï¼Œä»¥ç¡®ä¿å®ƒå¯ä»¥åœ¨é›†ç¾¤ä¸­å®‰å…¨è¿è¡Œï¼Œå¹¶åœ¨å‘å¸ƒæ–°ç‰ˆ Operator æ—¶æä¾›æœ‰å…³å¦‚ä½•åº”ç”¨æ›´æ–°çš„ä¿¡æ¯ã€‚æ­¤å¤–ï¼ŒCSV è¿˜æ˜¯è¿è¡Œ Operator æ‰€éœ€çš„æŠ€æœ¯ä¿¡æ¯æ¥æºï¼Œä¾‹å¦‚å…¶ç®¡ç†æˆ–ä¾èµ–çš„è‡ªå®šä¹‰èµ„æº (CR)ã€RBAC è§„åˆ™ã€é›†ç¾¤è¦æ±‚å’Œå®‰è£…ç­–ç•¥ã€‚æ­¤ä¿¡æ¯å‘Šè¯‰ OLM å¦‚ä½•åˆ›å»ºæ‰€éœ€èµ„æºå¹¶å°† Operator è®¾ç½®ä¸º Deploymentã€‚</li>
<li><strong>catalogsource</strong> CatalogSource ä»£è¡¨ OLM å¯æŸ¥è¯¢çš„å…ƒæ•°æ®å­˜å‚¨ï¼Œä»¥å‘ç°å’Œå®‰è£… Operator åŠå…¶ä¾èµ–é¡¹ã€‚<br>
catsrcæœ‰ä¸‰ç§sourceTypesï¼š<br>
- å¸¦æœ‰<code>image</code>å¼•ç”¨çš„<code>grpc</code>ï¼šOLMæ‹‰å–é•œåƒå¹¶è¿è¡Œpod<br>
- å¸¦æœ‰<code>address</code>å¼•ç”¨çš„<code>grpc</code>:OLMä¼šå°è¯•ç»™å®šåœ°å€çš„gRPC API<br>
- <code>internal</code>æˆ–<code>configmap</code>: OLM è§£æ ConfigMap æ•°æ®ï¼Œå¹¶è¿è¡Œä¸€ä¸ªå¯ä»¥ä¸ºå…¶æä¾› gRPC API çš„ pod</li>
<li><strong>Subscription</strong> å°† Operator ä¸ CatalogSource å…³è”çš„è‡ªå®šä¹‰èµ„æº,Subscription æè¿°äº†è¦è®¢é˜… Operator è½¯ä»¶åŒ…çš„å“ªä¸ªé¢‘é“ï¼Œä»¥åŠæ˜¯è‡ªåŠ¨è¿˜æ˜¯æ‰‹åŠ¨æ‰§è¡Œæ›´æ–°ã€‚å¦‚æœè®¾ç½®ä¸ºè‡ªåŠ¨ï¼ŒSubscription ä¼šç¡®ä¿ç”± OLM ç®¡ç†å¹¶å‡çº§ Operatorï¼Œä»¥ç¡®ä¿é›†ç¾¤ä¸­å§‹ç»ˆè¿è¡Œæœ€æ–°ç‰ˆæœ¬ã€‚</li>
<li><strong>InstallPlan</strong> ipå®šä¹‰äº†è¦åˆ›å»ºçš„ä¸€ç»„èµ„æºï¼Œç”¨äºå®‰è£…æˆ–å‡çº§åˆ° CSV å®šä¹‰çš„ ClusterService çš„ç‰¹å®šç‰ˆæœ¬ã€‚</li>
<li><strong>OperatorGroup</strong> ä¸º OLM å®‰è£…çš„ Operator æä¾›å¤šç§Ÿæˆ·é…ç½®ã€‚OperatorGroup é€‰æ‹©ç›®æ ‡å‘½åç©ºé—´ï¼Œåœ¨å…¶ä¸­ä¸ºå…¶æˆå‘˜ Operator ç”Ÿæˆæ‰€éœ€çš„ RBAC è®¿é—®æƒé™ã€‚</li>
</ul>
</li>
</ul>
</li>
<li>olmæ¶æ„<br>
ç”±olm operatorå’Œcatalog operatorç®¡ç†çš„CRDï¼šcsvï¼Œipï¼Œcatsrcï¼Œsubï¼Œog<br>
ç”±olm operatoråˆ›å»ºçš„èµ„æºï¼šsaï¼ŒclusterRolesï¼ŒclusterRoleBindings<br>
ç”±catalog operatoråˆ›å»ºçš„èµ„æº CRD CSV
<ul>
<li><strong>Catalog Operator</strong><br>
Catalog Operator è´Ÿè´£è§£æå’Œå®‰è£… CSV åŠå…¶æŒ‡å®šçš„æ‰€éœ€èµ„æºã€‚å¦å¤–è¿˜è´Ÿè´£ç›‘è§†é¢‘é“ä¸­çš„ CatalogSource ä¸­æ˜¯å¦æœ‰è½¯ä»¶åŒ…æ›´æ–°ï¼Œå¹¶å°†å…¶å‡çº§ï¼ˆå¯é€‰æ‹©è‡ªåŠ¨ï¼‰è‡³æœ€æ–°å¯ç”¨ç‰ˆæœ¬ã€‚<br>
ç”¨æˆ·å¯åˆ›å»º Subscription èµ„æºï¼Œè¯¥èµ„æºå°†é…ç½®æ‰€éœ€è½¯ä»¶åŒ…ã€é¢‘é“å’Œ CatalogSourceï¼Œä»¥ä¾¿ä»ä¸­æ‹‰å–æ›´æ–°ã€‚æ‰¾åˆ°æ›´æ–°åï¼Œä¾¿ä¼šä»£è¡¨ç”¨æˆ·å°†é€‚å½“ InstallPlan å†™å…¥å‘½åç©ºé—´ã€‚<br>
catalog operatorå·¥ä½œæµï¼š
<ol>
<li>è¿æ¥åˆ°é›†ç¾¤ä¸­çš„æ¯ä¸ª CatalogSource</li>
<li>ç›‘è§†æ˜¯å¦æœ‰ç”¨æˆ·åˆ›å»ºçš„æœªè§£æ InstallPlanï¼Œå¦‚æœæœ‰ï¼š
<ul>
<li>æŸ¥æ‰¾ä¸è¯·æ±‚åç§°ç›¸åŒ¹é…çš„ CSVï¼Œå¹¶å°†æ­¤ CSC æ·»åŠ ä¸ºå·²è§£æçš„èµ„æºã€‚</li>
<li>å¯¹äºæ¯ä¸ªå—ç®¡æˆ–æ‰€éœ€ CRDï¼Œå°†å…¶æ·»åŠ ä¸ºå·²è§£æçš„èµ„æºã€‚</li>
<li>å¯¹äºæ¯ä¸ªæ‰€éœ€ CRDï¼Œæ‰¾åˆ°ç®¡ç†ç›¸åº” CRD çš„ CSVã€‚</li>
</ul>
</li>
<li>ç›‘è§†æ˜¯å¦æœ‰å·²è§£æçš„ InstallPlan å¹¶ä¸ºå…¶åˆ›å»ºå·²å‘ç°çš„æ‰€æœ‰èµ„æºï¼ˆç”¨æˆ·æ‰¹å‡†æˆ–è‡ªåŠ¨ï¼‰ã€‚</li>
<li>ç›‘è§† CatalogSource å’Œ Subscriptionï¼Œå¹¶æ ¹æ®å®ƒä»¬åˆ›å»º InstallPlanã€‚</li>
</ol>
</li>
<li><strong>OLM operator</strong><br>
é›†ç¾¤ä¸­å­˜åœ¨ CSV ä¸­æŒ‡å®šéœ€è¦çš„èµ„æºåï¼ŒOLM Operator å°†è´Ÿè´£éƒ¨ç½²ç”± CSV èµ„æºå®šä¹‰çš„åº”ç”¨ç¨‹åºã€‚OLM Operator ä¸è´Ÿè´£åˆ›å»ºæ‰€éœ€èµ„æºï¼Œ Catalog Operator æ¥åˆ›å»ºè¿™äº›èµ„æº<br>
OLM operatorå·¥ä½œæµï¼š
<ol>
<li>ç›‘è§†å‘½åç©ºé—´ä¸­çš„ ClusterServiceVersion (CSV)ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æ»¡è¶³è¦æ±‚</li>
<li>æ»¡è¶³è¦æ±‚ï¼Œè¿è¡ŒCSVå®‰è£…ç­–ç•¥</li>
</ol>
<pre><code>&gt; CSVå¿…é¡»ä¸ºogçš„æ´»è·ƒæˆå‘˜æ‰å¯è¿è¡Œè¯¥å®‰è£…ç­–ç•¥
</code></pre>
</li>
<li>Catalog Registry<br>
Catalog Registry å­˜å‚¨ CSV å’Œ CRD ä»¥ä¾¿åœ¨é›†ç¾¤ä¸­åˆ›å»ºï¼Œå¹¶å­˜å‚¨æœ‰å…³è½¯ä»¶åŒ…å’Œé¢‘é“çš„å…ƒæ•°æ®ã€‚</li>
</ul>
</li>
<li>OG
<ul>
<li>ogæˆå‘˜èµ„æ ¼ï¼Œæ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶ï¼š
<ol>
<li>Operator çš„ CSV ä¸ OperatorGroup å­˜åœ¨äºåŒä¸€å‘½åç©ºé—´ä¸­ã€‚</li>
<li>Operator çš„ CSV InstallMode æ”¯æŒ OperatorGroup æ‰€é’ˆå¯¹çš„å‘½åç©ºé—´é›†ã€‚<br>
InstallModeå’Œå—æ”¯æŒçš„og
<ul>
<li>OwnNamespaceï¼šOperator å¯ä»¥æ˜¯é€‰æ‹©å…¶è‡ªæœ‰å‘½åç©ºé—´çš„ OperatorGroup çš„æˆå‘˜ã€‚</li>
<li>SingleNamespaceï¼šOperator å¯ä»¥æ˜¯é€‰æ‹©æŸä¸€ä¸ªå‘½åç©ºé—´çš„ OperatorGroup çš„æˆå‘˜ã€‚</li>
<li>MultiNamespaceï¼šOperator å¯ä»¥æ˜¯é€‰æ‹©å¤šä¸ªå‘½åç©ºé—´çš„ OperatorGroup çš„æˆå‘˜ã€‚</li>
<li>AllNamespacesï¼šOperator å¯ä»¥æ˜¯é€‰æ‹©æ‰€æœ‰å‘½åç©ºé—´çš„ OperatorGroup çš„æˆå‘˜ï¼ˆç›®æ ‡å‘½åç©ºé—´é›†ä¸ºç©ºå­—ç¬¦ä¸² &quot;&quot;ï¼‰<br>
å…¨å±€ OperatorGroup çš„ status.namespace åŒ…å«ç©ºå­—ç¬¦ä¸² (&quot;&quot;)ï¼Œè€Œè¯¥å­—ç¬¦ä¸²ä¼šå‘æ­£åœ¨ä½¿ç”¨çš„ Operator å‘å‡ºä¿¡å·ï¼Œè¦æ±‚å…¶ç›‘è§†æ‰€æœ‰å‘½åç©ºé—´ã€‚<br>
OLM ä¼šåœ¨æ¯ä¸ª OperatorGroup çš„ç›®æ ‡å‘½åç©ºé—´ä¸­å¤åˆ¶ OperatorGroup çš„æ‰€æœ‰æ´»è·ƒæˆå‘˜ CSVã€‚å¤åˆ¶ CSV çš„ç›®çš„åœ¨äºå‘Šè¯‰ç›®æ ‡å‘½åç©ºé—´çš„ç”¨æˆ·ï¼Œç‰¹å®š Operator å·²é…ç½®ä¸ºç›‘è§†åœ¨æ­¤åˆ›å»ºçš„èµ„æºã€‚</li>
</ul>
</li>
</ol>
</li>
</ul>
</li>
</ol>
<ul>
<li>åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶<br>
åˆ›å»º OperatorGroup æ—¶ï¼Œä¼šç”Ÿæˆä¸‰ä¸ª ClusterRoleã€‚æ¯ä¸ª ClusterRole å‡åŒ…å«ä¸€ä¸ª AggregationRuleï¼Œåè€…è®¾ç½®äº† ClusterRoleSelector ä»¥åŒ¹é…æ ‡ç­¾ï¼Œ
<ul>
<li>&lt;operatorgroup_name&gt;-admin  ï¼ˆolm.opgroup.permissions/aggregate-to-admin: &lt;operatorgroup_name&gt;ï¼‰</li>
<li>&lt;operatorgroup_name&gt;-edit    ï¼ˆolm.opgroup.permissions/aggregate-to-edit: &lt;operatorgroup_name&gt;ï¼‰</li>
<li>&lt;operatorgroup_name&gt;-view   ï¼ˆolm.opgroup.permissions/aggregate-to-view: &lt;operatorgroup_name&gt;ï¼‰<br>
CSV æˆä¸º OperatorGroup çš„æ´»è·ƒæˆå‘˜æ—¶ï¼Œåªè¦è¯¥ CSV æ­£åœ¨ä½¿ç”¨ AllNamespaces InstallMode æ¥ç›‘è§†æ‰€æœ‰å‘½åç©ºé—´ï¼Œä¸”æ²¡æœ‰å›  InterOperatorGroupOwnerConflict åŸå› å¤„äºæ•…éšœçŠ¶æ€ï¼Œä¾¿ä¼šç”Ÿæˆä»¥ä¸‹ RBAC èµ„æºã€‚</li>
<li>æ¥è‡ª CRD çš„æ¯ä¸ª API èµ„æºçš„ ClusterRole ï¼ˆ&lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-admin &lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-edit &lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-view &lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-view-crdviewï¼‰</li>
<li>æ¥è‡ªAPIServiceï¼Œé’ˆå¯¹æ¯ä¸ª API èµ„æºç”Ÿæˆçš„ ClusterRole ï¼ˆ&lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-admin &lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-edit &lt;kind&gt;.&lt;group&gt;-&lt;version&gt;-viewï¼‰</li>
<li>é¢å¤–çš„roleå’Œrolebinding</li>
</ul>
</li>
<li>ogäº¤é›†<br>
å¦‚æœä¸¤ä¸ª OperatorGroup çš„ç›®æ ‡å‘½åç©ºé—´é›†çš„äº¤é›†ä¸æ˜¯ç©ºé›†ï¼Œä¸”æ ¹æ® olm.providedAPIs æ³¨è§£çš„å®šä¹‰ï¼Œæ‰€æä¾›çš„ API é›†çš„äº¤é›†ä¹Ÿä¸æ˜¯ç©ºé›†ï¼Œåˆ™ç§°è¿™ä¸¤ä¸ª OperatorGroup çš„æä¾›çš„ API æœ‰äº¤é›†ã€‚</li>
<li>ogæ•…éšœ<br>
1. å¦‚æœä¸€ä¸ªå‘½åç©ºé—´ä¸­å­˜åœ¨å¤šä¸ª OperatorGroupï¼Œåˆ™åœ¨è¯¥å‘½åç©ºé—´ä¸­åˆ›å»ºçš„æ‰€æœ‰ CSV å‡ä¼šå˜æˆæ•…éšœçŠ¶æ€ï¼Œæ•…éšœåŸå› ä¸ºï¼šTooManyOperatorGroupsã€‚ä¸€æ—¦å‘½åç©ºé—´ä¸­ OperatorGroup çš„æ•°é‡å˜æˆ 1ï¼Œå› è¯¥åŸå› å¤„äºæ•…éšœçŠ¶æ€çš„ CSV å°†è½¬å˜ä¸ºç­‰å¾…å¤„ç†çŠ¶æ€ã€‚<br>
2. å¦‚æœ CSV çš„ InstallMode ä¸æ”¯æŒå…¶å‘½åç©ºé—´ä¸­ OperatorGroup çš„ç›®æ ‡å‘½åç©ºé—´é€‰æ‹©ï¼ŒCSV å°†å˜ä¸ºæ•…éšœçŠ¶æ€ï¼Œæ•…éšœåŸå› ä¸º UnsupportedOperatorGroupã€‚ä¸€æ—¦ OperatorGroup çš„ç›®æ ‡å‘½åç©ºé—´é€‰æ‹©å˜ä¸ºå—æ”¯æŒçš„é…ç½®ï¼Œæˆ– CSV çš„ InstallMode ç»ä¿®æ”¹åæ”¯æŒ OperatorGroup çš„ç›®æ ‡å‘½åç©ºé—´é€‰æ‹©ï¼Œå› è¯¥åŸå› å¤„äºæ•…éšœçŠ¶æ€çš„ CSV å°†è½¬å˜ä¸ºç­‰å¾…å¤„ç†çŠ¶æ€ã€‚</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[prime filter ]]></title>
        <id>https://twFR.github.io/post/prime-fliter/</id>
        <link href="https://twFR.github.io/post/prime-fliter/">
        </link>
        <updated>2020-06-02T07:01:03.000Z</updated>
        <content type="html"><![CDATA[<p>ä½¿ç”¨å¹¶å‘æ¥åšä¸€ä¸ªç´ æ•°ç­›</p>
<pre><code>package main

import &quot;fmt&quot;

func main() {
	ch :=GenerateNatural()
	for i:=0;i&lt;100;i++{
		prime := &lt;-ch                              // ç¬¬ä¸€ä¸ªä¸€å®šæ˜¯ç´ æ•°
		fmt.Printf(&quot;%v: %v\n&quot;, i+1, prime)
		ch = primeFliter(ch,prime)
	}
}

// ç”Ÿæˆä¸€ä¸ªè‡ªç„¶æ•°åˆ—
func GenerateNatural() chan int {
	ch := make(chan int)
	go func() {
		for i := 2; ; i++ {
			ch &lt;- i
		}
	}()
	return ch
}

// æ ¹æ®primeè¿‡æ»¤ï¼Œè¿‡æ»¤åçš„ç¬¬ä¸€ä¸ªä¸€å®šæ˜¯ç´ æ•°
func primeFliter(in &lt;- chan int,prime int) chan int{
	out := make(chan int)
	go func() {
		for {
			if i:=&lt;-in;i%prime!=0{
				out &lt;- i
			}
		}
	}()
	return out
}
</code></pre>
<p>GenerateNaturalå’ŒPrimeFilterå‡½æ•°å†…éƒ¨éƒ½å¯åŠ¨äº†æ–°çš„Goroutineï¼Œå½“mainå‡½æ•°ä¸å†ä½¿ç”¨ç®¡é“æ—¶åå°Goroutineæœ‰æ³„æ¼çš„é£é™©ã€‚å¯ä»¥é€šè¿‡contextåŒ…æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼Œä¸‹é¢æ˜¯æ”¹è¿›çš„ç´ æ•°ç­›å®ç°ï¼š</p>
<pre><code>package main

import (
	&quot;context&quot;
	&quot;fmt&quot;
)

func GenerateNatural(ctx context.Context) chan int {
	ch := make(chan int)
	go func() {
		for i := 2; ; i++ {
			select {
			case &lt;-ctx.Done():
				return
			case ch &lt;- i:
			}
		}
	}()
	return ch
}

func primeFilter(ctx context.Context, in &lt;-chan int, prime int) chan int {
	out := make(chan int)
	go func() {
		for {
			if i := &lt;-in; i%prime != 0 {
				select {
				case &lt;-ctx.Done():
					return
				case out &lt;- i:
				}
			}
		}
	}()
	return out
}

func main() {

	ctx, cancel := context.WithCancel(context.Background())
	ch := GenerateNatural(ctx)
	for i := 0; i &lt; 1000; i++ {
		prime := &lt;-ch
		fmt.Printf(&quot;%v: %v\n&quot;, i+1, prime)
		ch = primeFilter(ctx, ch, prime)
	}

	cancel()   // mainå‡½æ•°å®Œæˆæ—¶ï¼Œè°ƒç”¨cancel(),é€šçŸ¥åå°goroutineé€€å‡ºï¼Œå³ctx.Doneæ”¶åˆ°ä¿¡å·
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[golang unsafe package]]></title>
        <id>https://twFR.github.io/post/golang-unsafe-package/</id>
        <link href="https://twFR.github.io/post/golang-unsafe-package/">
        </link>
        <updated>2020-05-08T06:27:11.000Z</updated>
        <content type="html"><![CDATA[<p>ä½¿ç”¨unsafe.Pointeræ¥å–åˆ‡ç‰‡çš„å±æ€§</p>
<pre><code>func testPointer() {
	s := make([]int, 9, 20)
	s = append(s, 2)
	len := *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;s)) + uintptr(8)))
	cap := *(*int)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;s)) + uintptr(16)))

	dataPointer := *(*int)(unsafe.Pointer(&amp;s))
	data1 := *(*int)(unsafe.Pointer(uintptr(dataPointer)))

	fmt.Printf(&quot;len: %d cap:%d \n&quot;, len, cap)
	fmt.Printf(&quot;dataPointer: %d  data1:%d \n&quot;, dataPointer, data1)

	i := 0
	for {
		if i &gt;= len {
			break
		}
		fmt.Printf(&quot;data%d:%d \n&quot;, i, *(*int)(unsafe.Pointer(uintptr(dataPointer) + uintptr(8*i))))
		i++
	}
}
</code></pre>
<p>unsafe åŒ…ç»•è¿‡äº† Go çš„ç±»å‹ç³»ç»Ÿï¼Œè¾¾åˆ°ç›´æ¥æ“ä½œå†…å­˜çš„ç›®çš„ï¼Œä½¿ç”¨å®ƒæœ‰ä¸€å®šçš„é£é™©æ€§ã€‚ä½†æ˜¯åœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œä½¿ç”¨ unsafe åŒ…æä¾›çš„å‡½æ•°ä¼šæå‡ä»£ç çš„æ•ˆç‡ï¼ŒGo æºç ä¸­ä¹Ÿæ˜¯å¤§é‡ä½¿ç”¨ unsafe åŒ…ã€‚</p>
<p>unsafe åŒ…å®šä¹‰äº† Pointer å’Œä¸‰ä¸ªå‡½æ•°ï¼š</p>
<p>é€šè¿‡ä¸‰ä¸ªå‡½æ•°å¯ä»¥è·å–å˜é‡çš„å¤§å°(Sizeof)ã€åç§»(Offsetof)ã€å¯¹é½(Alignof)ç­‰ä¿¡æ¯ã€‚</p>
<p>uintptr å¯ä»¥å’Œ unsafe.Pointer è¿›è¡Œç›¸äº’è½¬æ¢ï¼Œuintptr å¯ä»¥è¿›è¡Œæ•°å­¦è¿ç®—ã€‚è¿™æ ·ï¼Œé€šè¿‡ uintptr å’Œ unsafe.Pointer çš„ç»“åˆå°±è§£å†³äº† Go æŒ‡é’ˆä¸èƒ½è¿›è¡Œæ•°å­¦è¿ç®—çš„é™åˆ¶ã€‚</p>
<p>é€šè¿‡ unsafe ç›¸å…³å‡½æ•°ï¼Œå¯ä»¥è·å–ç»“æ„ä½“ç§æœ‰æˆå‘˜çš„åœ°å€ï¼Œè¿›è€Œå¯¹å…¶åšè¿›ä¸€æ­¥çš„è¯»å†™æ“ä½œï¼Œçªç ´ Go çš„ç±»å‹å®‰å…¨é™åˆ¶ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[docker]]></title>
        <id>https://twFR.github.io/post/docker-file/</id>
        <link href="https://twFR.github.io/post/docker-file/">
        </link>
        <updated>2020-04-07T02:34:00.000Z</updated>
        <content type="html"><![CDATA[<blockquote>
<p>reference: <a href="https://docs.docker.com/engine/reference/builder/">dockerå®˜æ–¹æ–‡æ¡£</a></p>
</blockquote>
<h2 id="dockerfile">dockerfile</h2>
<ul>
<li>dockerfileå¿…é¡»ä»¥<code>FROM</code>æŒ‡ä»¤å¼€å§‹ã€‚<code>ARG</code>æ˜¯å”¯ä¸€å¯ä»¥æ—©äº<code>FROM</code>æ‰§è¡Œçš„æŒ‡ä»¤ï¼ŒæŸ¥çœ‹<a href="#interact">ARGå’ŒFROMçš„äº¤äº’</a></li>
<li>dockerfileä¸­ä»¥<code>#</code>æ¥æ ‡ç¤ºæ³¨é‡Šï¼Œæ³¨é‡Šä¼šåœ¨dockerfileè¢«æ‰§è¡Œå‰ç§»é™¤æ‰ï¼Œä»¥å…å¯¹å‘½ä»¤äº§ç”Ÿå½±å“</li>
</ul>
<h3 id="è§£æå™¨æŒ‡ä»¤">è§£æå™¨æŒ‡ä»¤</h3>
<p>è§£æå™¨æŒ‡ä»¤æ”¾åœ¨æœ€ä¸Šé¢ï¼Œä»¥<code># directive=value</code>çš„å½¢å¼æ¥å£°æ˜ï¼Œä¸€æ—¦æ³¨é‡Š ç©ºè¡Œæˆ–è€…builderæŒ‡ä»¤æ‰§è¡Œï¼Œdockerå°±ä¸ä¼šå†å»æ‹›è§£æå™¨æŒ‡ä»¤ï¼Œè€Œæ˜¯æŠŠå®ƒå½“æˆæ³¨é‡Šã€‚<br>
ä¸‹é¢å‡ ç§æ˜¯ä¸ç¬¦åˆè§„èŒƒçš„åœºæ™¯ï¼š</p>
<pre><code># direc \  
 tive=value
</code></pre>
<p>â–³ æ¢è¡Œä¸ç¬¦åˆè§„èŒƒ</p>
<pre><code># directive=value1
# directive=value2
FROM ImageName
</code></pre>
<p>â–³ å‡ºç°ä¸¤æ¬¡</p>
<pre><code>FROM ImageName
# directive=value
</code></pre>
<p>â–³ åœ¨builderæŒ‡ä»¤åé¢ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š</p>
<pre><code># About my dockerfile
# directive=value
FROM ImageName
</code></pre>
<p>â–³ åœ¨æ³¨é‡Šåé¢ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š</p>
<pre><code># unknowndirective=value
# knowndirective=value
</code></pre>
<p>â–³ æœªçŸ¥çš„è§£é‡Šå™¨æŒ‡ä»¤ï¼Œä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Šï¼Œç¬¬äºŒè¡ŒåŒæ ·ä¼šè¢«è®¤ä¸ºæ˜¯æ³¨é‡Š</p>
<pre><code>#directive=value
# directive =value
#	directive= value
# directive = value
#	  dIrEcTiVe=value
</code></pre>
<p>â–³ ä¸Šé¢å‡ ç§å†™æ³•ä¼šè¢«è®¤ä¸ºæ˜¯åŒä¸€ç§å†™æ³•ï¼Œå³æ— è§†ç©ºæ ¼ï¼Œä¸åŒºåˆ†å¤§å°å†™</p>
<p>æ”¯æŒçš„è§£é‡Šå™¨æŒ‡ä»¤</p>
<ul>
<li>syntax<br>
# syntax=[remote image reference]<br>
è¿™æ˜¯ç”¨buldkitæ‰ä¼šä½¿ç”¨åˆ°çš„ï¼Œä¸ºäº†æŒ‡å®šæ„å»ºå½“å‰dokcerfileçš„dokcerfileæ„å»ºå™¨çš„ä½ç½®</li>
<li>escape<br>
# escape=\ (backslash) || # escape=` (backtick)<br>
escapeå®šä¹‰è½¬ä¹‰å­—ç¬¦ï¼Œè½¬ä¹‰å­—ç¬¦ä¸ä¼šåœ¨<code>RUN</code>æŒ‡ä»¤ä¸­æ‰§è¡Œ<br>
ä¾‹å¦‚åœ¨windowsä¸­å°†è½¬ä¹‰å­—ç¬¦è®¾ç½®æˆ`  å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºwindowsç›®å½•æ ¼å¼æ˜¯<code>C:\\</code>ï¼Œä½†æ˜¯åœ¨dockerfileé‡Œé¢ä¼šè§£ææˆ<code>C:\</code>ï¼Œå°±ä¼šæ‰¾ä¸åˆ°å¯¹åº”ç›®å½•</li>
</ul>
<h3 id="ç¯å¢ƒå˜é‡">ç¯å¢ƒå˜é‡</h3>
<p>ç¯å¢ƒå˜é‡ä»¥$variable_name æˆ–è€… ${variable_name}æ ¼å¼ï¼ŒåŒæ ·æ”¯æŒä»¥ä¸‹bashé£æ ¼çš„æ ¼å¼ï¼š</p>
<ul>
<li>${variable:-word}  å¦‚æœ<code>veriable</code>è®¾ç½®äº†å€¼ï¼Œç»“æœå°±æ˜¯è¿™ä¸ªå€¼ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±æ˜¯<code>word</code>ç»“æœï¼Œ<code>word</code>å¯ä»¥æ˜¯å®šå€¼ä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å˜é‡</li>
<li>${variable:+word}  å¦‚æœ<code>veriable</code>è®¾ç½®äº†å€¼ï¼Œç»“æœå°±æ˜¯<code>word</code>ã€‚å¦‚æœæ²¡æœ‰ï¼Œå°±æ˜¯ç©º<br>
å¦‚ä¸‹ç¤ºä¾‹ï¼š</li>
</ul>
<pre><code>ENV abc=hello
ENV abc=bye def=$abc
ENV ghi=$abc
</code></pre>
<p><code>def</code>çš„å€¼ä¸º<code>hello</code>ï¼Œè€Œ <code>ghi</code>å€¼ä¸º<code>bye</code>å®˜æ–¹æ˜¯å¦‚ä¸‹è§£é‡Šçš„</p>
<blockquote>
<p>Environment variable substitution will use the same value for each variable throughout the entire instruction. In other words</p>
</blockquote>
<p>è®²é“ç†æ²¡çœ‹ç‰¹æ˜ç™½ï¼Œä½†æ˜¯ä¸ªäººåœŸå‘³ç†è§£åº”è¯¥æ˜¯è¯´æ¯è¡Œç®—ä¸€ä¸ª<code>entire instruction</code>,è¿™è¡Œçš„å€¼éƒ½æ˜¯ä¸ä¼šå˜åŒ–çš„ï¼Œæ‰€ä»¥<code>def</code>è¿˜æ˜¯ç”¨çš„ä¸Šä¸€è¡Œçš„<code>hello</code>å€¼ï¼Œè€Œ<code>ghi</code> åˆ™å¯ä»¥å–åˆ°ä¸Šä¸€è¡Œæ‰§è¡Œåçš„ç»“æœ</p>
<h3 id="dockerignore-file">.dockerignore file</h3>
<p><code>.dockerignore</code> fileå…¶å®å’Œgité‡Œé¢çš„.<code>gitignore</code>æ–‡ä»¶ç±»ä¼¼ï¼Œdocker CLIåœ¨å‘é€contextçš„æ—¶å€™ä¼šå…ˆå¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªæ–‡ä»¶å’Œæ–‡ä»¶é‡Œé¢çš„æŒ‡å®šæ¨¡å¼çš„æ–‡ä»¶å»é™¤æ‰ï¼Œä¸å‘é€ç»™docker daemonã€‚éœ€è¦æ³¨æ„çš„æ˜¯<code>!</code>è¿™ä¸ªç¬¦å·çš„ç”¨æ³•ï¼š</p>
<pre><code>*.md                       //å»æ‰æ‰€æœ‰mdç»“å°¾çš„æ–‡ä»¶
!README*.md          //READMEå¼€å¤´çš„mdæ–‡ä»¶ä¸å»é™¤
README-secret.md  // README-secret.mdä½œä¸ºç‰¹ä¾‹è¦å»é™¤
</code></pre>
<p>è¿™é‡Œè¡¨ç¤ºå»æ‰æ‰€æœ‰markdownæ–‡ä»¶ã€‚ä½†æ˜¯ä¸å»é™¤READMEç›¸å…³çš„æ–‡ä»¶ï¼Œé™¤äº†README-secret.mdè¿™ä¸ªæ–‡ä»¶</p>
<h3 id="from">FROM</h3>
<p>ä¸‰ç§æ ¼å¼ï¼š</p>
<pre><code>FROM [--platform=&lt;platform&gt;] &lt;image&gt; [AS &lt;name&gt;]
</code></pre>
<pre><code>FROM [--platform=&lt;platform&gt;] &lt;image&gt;[:&lt;tag&gt;] [AS &lt;name&gt;]
</code></pre>
<pre><code>FROM [--platform=&lt;platform&gt;] &lt;image&gt;[@&lt;digest&gt;] [AS &lt;name&gt;]
</code></pre>
<p><code>FROM</code>å¼€å§‹ä¸€ä¸ªæ„å»ºé˜¶æ®µï¼Œå¹¶ä¸”æŒ‡å®šåé¢åˆšå¥½æ„å»ºæŒ‡ä»¤çš„åŸºç¡€é•œåƒ</p>
<ul>
<li><code>FROM</code>å¯ä»¥åœ¨ä¸€ä¸ªdokcerfileé‡Œé¢å‡ºç°å¤šæ¬¡ï¼Œæ„å»ºå¤šä¸ªæ„å»ºé•œåƒã€‚åªè¦åœ¨ä¸‹ä¸€æ¬¡<code>FROM</code>æŒ‡ä»¤ä¹‹å‰è®°ä½ä¸Šä¸€æ¬¡image IDï¼Œä¸¤æ¬¡æ„å»ºå°±å¯ä»¥ç›¸äº’ç”¨æ¥ã€‚æ¯æ¬¡<code>FROM</code>æŒ‡ä»¤å¼€å§‹ä¼šæ¸…é™¤ä¸Šä¸€æ¬¡çš„æŒ‡ä»¤</li>
<li><code>AS name</code>æ˜¯å¯é€‰çš„ï¼Œå¦‚æœä½¿ç”¨äº†ï¼Œå¯ä»¥åœ¨ä¸‹ä¸€æ¬¡çš„<code>FROM</code>ä½¿ç”¨ <code>COPY --from=&lt;name&gt;</code>æ¥å…³è”ä¸Šä¸€æ¬¡çš„æ„å»ºé•œåƒ</li>
<li><code>tag</code>å’Œ<code>digest</code>ä¹Ÿæ˜¯å¯é€‰çš„ï¼Œé»˜è®¤ä¸º<code>latest</code></li>
</ul>
<h4 id="a-nameinteractargå’Œfromçš„äº¤äº’a"><a name="interact">ARGå’ŒFROMçš„äº¤äº’</a></h4>
<p>FROMçš„å˜é‡æ˜¯é€šè¿‡ARGæ¥å®šä¹‰çš„ï¼Œæ‰€ä»¥ARGæ˜¯æœ‰å¯èƒ½å…ˆäºFROMæ‰§è¡Œçš„ï¼Œä½†æ˜¯æ­¤æ—¶ARGæ˜¯åœ¨æ„å»ºé˜¶æ®µä¹‹å¤–å®šä¹‰çš„ï¼Œåªèƒ½åœ¨FROMæŒ‡ä»¤é‡Œé¢ä½¿ç”¨ï¼Œåœ¨å…¶ä»–æŒ‡ä»¤ä½¿ç”¨éœ€è¦åœ¨æ‰§è¡Œä¸€æ¬¡æ²¡æœ‰å€¼çš„ARG</p>
<pre><code>ARG VERSION=latest
FROM busybox:$VERSION
ARG VERSION     //ç©ºå€¼ARGå–ä¸Šä¸€æ¬¡ARGçš„å€¼
RUN echo $VERSION &gt; image_version
</code></pre>
<h3 id="run">RUN</h3>
<p>ä¸¤ç§æ ¼å¼ï¼š</p>
<pre><code>RUN &lt;command&gt;(shell form,the command is run in a shell, which by default is /bin/sh -c on Linux or cmd /S /C on Windows))
</code></pre>
<pre><code>RUN [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (exec form)
</code></pre>
<p>RUNæŒ‡ä»¤å°†åœ¨å½“å‰layeré¡¶éƒ¨çš„æ–°layeræ‰§è¡Œå‘½ä»¤ï¼Œæäº¤ç»“æœï¼Œç”Ÿæˆçš„é•œåƒå°†ç”¨äºdockerfileä¸‹ä¸€æ­¥<br>
ä¾‹ï¼š</p>
<pre><code>RUN /bin/bash -c 'source $HOME/.bashrc; echo $HOME'
</code></pre>
<pre><code>RUN [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo hello&quot;]  //execform æ˜¯è§£æç§°jsonæ•°ç»„çš„ï¼Œæ‰€ä»¥åªèƒ½ç”¨&quot;ï¼Œä¸èƒ½ç”¨'
</code></pre>
<p>execformä¸ä¼šè°ƒç”¨shellï¼Œå¦‚RUN[&quot;echo,&quot;<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi><mi>O</mi><mi>M</mi><mi>E</mi><mi mathvariant="normal">&quot;</mi><mo>]</mo><mo separator="true">,</mo><mi mathvariant="normal">ä¸</mi><mi mathvariant="normal">ä¼š</mi><mi mathvariant="normal">åœ¨</mi></mrow><annotation encoding="application/x-tex">HOME&quot;],ä¸ä¼šåœ¨</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault" style="margin-right:0.08125em;">H</span><span class="mord mathdefault" style="margin-right:0.02778em;">O</span><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="mord mathdefault" style="margin-right:0.05764em;">E</span><span class="mord">&quot;</span><span class="mclose">]</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord cjk_fallback">ä¸</span><span class="mord cjk_fallback">ä¼š</span><span class="mord cjk_fallback">åœ¨</span></span></span></span>HOMEä¸Šè¿›è¡Œå˜é‡æ›¿æ¢ã€‚è¦æ‰§è¡Œshellï¼Œéœ€è¦è¿™æ ·ï¼šRUN [ &quot;sh&quot;, &quot;-c&quot;, &quot;echo $HOME&quot; ]ã€‚å½“ä½¿ç”¨execformå¹¶ç›´æ¥æ‰§è¡Œshellæ—¶ï¼ˆä¾‹å¦‚åœ¨shellè¡¨å•ä¸­ï¼‰ï¼Œæ˜¯ç”±shellè¿›è¡Œç¯å¢ƒå˜é‡æ‰©å±•ï¼Œè€Œä¸æ˜¯dockerã€‚<br>
RUNæŒ‡ä»¤çš„ç¼“å­˜ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆã€‚ è¯¸å¦‚RUN apt-get dist-upgrade -yä¹‹ç±»çš„æŒ‡ä»¤çš„å­˜å°†åœ¨ä¸‹ä¸€ä¸ªæ„å»ºæœŸé—´é‡ç”¨ã€‚ å¯ä»¥ä½¿ç”¨--no-cacheæ ‡å¿—ä½¿RUNæŒ‡ä»¤çš„ç¼“å­˜æ— æ•ˆï¼Œä¾‹å¦‚docker build --no-cache</p>
<h3 id="cmd">CMD</h3>
<p>ä¸‰ç§æ ¼å¼ï¼š</p>
<pre><code>CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;] (exec form, this is the preferred form)
</code></pre>
<pre><code>CMD [&quot;param1&quot;,&quot;param2&quot;] (as default parameters to ENTRYPOINT) //ä½¿ç”¨JSONæ•°ç»„æ ¼å¼æŒ‡å®šï¼Œå³åªèƒ½ä½¿ç”¨ &quot;,ä¸èƒ½ä½¿ç”¨'
</code></pre>
<pre><code>CMD command param1 param2 (shell form)   //åœ¨/ bin / sh -cä¸­æ‰§è¡Œ
</code></pre>
<p>CMDæŒ‡ä»¤çš„é¦–è¦ç›®çš„åœ¨äºä¸ºå¯åŠ¨çš„å®¹å™¨æŒ‡å®šé»˜è®¤è¦è¿è¡Œçš„ç¨‹åºï¼Œä¸”å…¶è¿è¡Œç»“æŸåï¼Œå®¹å™¨ä¹Ÿå°†ç»ˆæ­¢ï¼›ä¸è¿‡ï¼Œ CMDæŒ‡å®šçš„å‘½ä»¤å…¶å¯ä»¥è¢« docker runçš„å‘½ä»¤è¡Œé€‰é¡¹æ‰€è¦†ç›– .åœ¨Dockerfileä¸­å¯ä»¥å­˜åœ¨å¤šä¸ª CMDæŒ‡ä»¤ï¼Œä½†ä»…æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆ<br>
å¦‚æœç”¨æˆ·ä¸ºdocker runæŒ‡å®šäº†å‚æ•°ï¼Œåˆ™å®ƒä»¬å°†è¦†ç›–CMDä¸­æŒ‡å®šçš„é»˜è®¤å€¼</p>
<h4 id="runå’Œcmdçš„åŒºåˆ«">RUNå’ŒCMDçš„åŒºåˆ«</h4>
<blockquote>
<p>Do not confuse RUN with CMD. RUN actually runs a command and commits the result; CMD does not execute anything at build time, but specifies the intended command for the image.<br>
RUNæ‰§è¡Œäº†å‘½ä»¤å¹¶æäº¤äº†ç»“æœï¼Œä½†æ˜¯CMDåœ¨buildæœŸé—´æ²¡æœ‰æ‰§è¡Œçƒ­æ²³ä¸œè¥¿ï¼Œä½†æ˜¯ä¸ºé•œåƒæŒ‡å®šäº†é¢„æœŸçš„å‘½ä»¤</p>
</blockquote>
<h3 id="entrypoint">ENTRYPOINT</h3>
<p>ä¸¤ç§æ ¼å¼ï¼š</p>
<pre><code>ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;] (exec form)
</code></pre>
<pre><code>ENTRYPOINT command param1 param2 (shell form)
</code></pre>
<p>ç±»ä¼¼ CMDæŒ‡ä»¤çš„åŠŸèƒ½ï¼Œç”¨äºä¸ºå®¹å™¨æŒ‡å®šé»˜è®¤è¿è¡Œç¨‹åºï¼Œä»è€Œä½¿å¾—å®¹å™¨åƒæ˜¯ä¸€ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œç¨‹åº</p>
<p>ä¸CMDä¸åŒçš„æ˜¯ï¼Œç”± ENTRYPOINTå¯åŠ¨çš„ç¨‹åºä¸ä¼šè¢« docker runå‘½ä»¤è¡ŒæŒ‡å®šçš„å‚æ•°æ‰€è¦†ç›–ï¼Œè€Œä¸”ï¼Œè¿™äº›å‘½ä»¤è¡Œå‚æ•°ä¼šè¢«å½“ä½œå‚æ•°ä¼ é€’ç»™ ENTRYPOINTæŒ‡å®šæŒ‡å®šçš„ç¨‹åº ,ocker run å‘½ä»¤ä¼ å…¥çš„å‘½ä»¤å‚æ•°ä¼šè¦†ç›–CMDæŒ‡ä»¤çš„å†…å®¹å¹¶ä¸”é™„åŠ åˆ°ENTRYPOINTå‘½ä»¤æœ€ååšä¸ºå…¶å‚æ•°ä½¿ç”¨, docker runå‘½ä»¤çš„ --entrypointé€‰é¡¹çš„å‚æ•°å¯è¦†ç›–ENTRYPOINTæŒ‡ä»¤æŒ‡å®šçš„ç¨‹åº<br>
Dockerfileæ–‡ä»¶ä¸­ä¹Ÿå¯ä»¥å­˜åœ¨å¤šä¸ª ENTRYPOINTæŒ‡ä»¤ï¼Œä½†ä»…æœ‰æœ€åä¸€ä¸ªä¼šç”Ÿæ•ˆ</p>
<h4 id="cmdå’Œentyypointäº¤äº’">CMDå’ŒENTYYPOINTäº¤äº’</h4>
<p>Dockerfileåº”è¯¥æŒ‡å®šCMDæˆ–ENTRYPOINTå‘½ä»¤ä¸­çš„è‡³å°‘ä¸€ä¸ªã€‚<br>
ä½¿ç”¨å®¹å™¨ä½œä¸ºå¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œåº”å®šä¹‰ENTRYPOINTã€‚<br>
CMDåº”è¯¥ç”¨ä½œå®šä¹‰ENTRYPOINTå‘½ä»¤æˆ–åœ¨å®¹å™¨ä¸­æ‰§è¡Œä¸´æ—¶å‘½ä»¤çš„é»˜è®¤å‚æ•°çš„æ–¹å¼ã€‚<br>
ä¸‹è¡¨æ˜¾ç¤ºäº†é’ˆå¯¹ä¸åŒENTRYPOINT / CMDç»„åˆæ‰§è¡Œçš„å‘½ä»¤ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>No ENTRYPOINT</th>
<th>ENTRYPOINT exec_entry p1_entry</th>
<th>ENTRYPOINT [â€œexec_entryâ€, â€œp1_entryâ€]</th>
</tr>
</thead>
<tbody>
<tr>
<td>No CMD</td>
<td>error, not allowed</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry</td>
</tr>
<tr>
<td>CMD [â€œexec_cmdâ€, â€œp1_cmdâ€]</td>
<td>exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry exec_cmd p1_cmd</td>
</tr>
<tr>
<td>CMD [â€œp1_cmdâ€, â€œp2_cmdâ€]</td>
<td>p1_cmd p2_cmd</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry p1_cmd p2_cmd</td>
</tr>
<tr>
<td>CMD exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_cmd p1_cmd</td>
<td>/bin/sh -c exec_entry p1_entry</td>
<td>exec_entry p1_entry /bin/sh -c exec_cmd p1_cmd</td>
</tr>
</tbody>
</table>
<h3 id="copy">COPY</h3>
<p>ä¸¤ç§å½¢å¼</p>
<pre><code>COPY [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;
COPY [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]  //åœ¨è·¯å¾„ä¸­æœ‰ç©ºç™½å­—ç¬¦æ—¶é€šå¸¸ä½¿ç”¨æ­¤å½¢å¼
</code></pre>
<p><code>--chown</code>ä»…æ”¯æŒç”¨æˆ·æ„å»ºlinuxå®¹å™¨çš„dockerfile<br>
&lt;src&gt;ï¼šè¦å¤åˆ¶çš„æºæ–‡ä»¶æˆ–ç›®å½•ï¼Œæ”¯æŒä½¿ç”¨é€šé…ç¬¦<br>
&lt;dest&gt;ï¼šç›®æ ‡è·¯å¾„ï¼Œå³æ­£åœ¨åˆ›å»ºçš„ imageçš„æ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼›å»ºè®®ä¸º &lt;dest&gt;ä½¿ç”¨ç»å¯¹è·¯å¾„ï¼Œ&lt;dest&gt;ç»å¯¹è·¯å¾„ä¸ºé•œåƒä¸­çš„è·¯å¾„ï¼Œè€Œä¸æ˜¯å®¿ä¸»æœºçš„è·¯å¾„ã€‚å¦åˆ™ï¼Œ <code>COPY</code>æŒ‡å®šåˆ™ä»¥ <code>WORKDIR</code>ä¸ºå…¶èµ·å§‹è·¯å¾„</p>
<ul>
<li>æ–‡ä»¶å¤åˆ¶å‡†åˆ™
<ol>
<li>&lt;src&gt;å¿…é¡»æ˜¯buildä¸Šä¸‹æ–‡ä¸­çš„è·¯å¾„ï¼Œå³åªèƒ½æ”¾åœ¨workshopè¿™ä¸ªå·¥ä½œç›®å½•ä¸‹ï¼Œä¸èƒ½æ˜¯å…¶çˆ¶ç›®å½•ä¸­çš„æ–‡ä»¶</li>
<li>å¦‚æœ&lt;src&gt;æ˜¯ç›®å½•ï¼Œå…¶å†…éƒ¨æ–‡ä»¶æˆ–è€…å­ç›®å½•ä¼šè¢«é€’å½’å¤åˆ¶ï¼Œä½†&lt;src&gt;ç›®å½•è‡ªèº«ä¸ä¼šè¢«å¤åˆ¶</li>
<li>å¦‚æœæŒ‡å®šäº†å¤šä¸ª&lt;src&gt;ï¼Œæˆ–åœ¨&lt;src&gt;ä¸­ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œåˆ™&lt;dest&gt;å¿…é¡»æ˜¯ä¸€ä¸ªç›®å½•ï¼Œä¸”&lt;dest&gt;ç›®å½•å¿…é¡»ä»¥<code>/</code>ç»“å°¾</li>
<li>å¦‚æœ&lt;dest&gt;äº‹å…ˆä¸å­˜åœ¨ï¼Œå®ƒå°†ä¼šè¢«è‡ªåŠ¨åˆ›å»ºï¼Œè¿™åŒ…æ‹¬å…¶çˆ¶ç›®å½•è·¯å¾„<br>
ä¾‹ï¼š</li>
</ol>
</li>
</ul>
<pre><code>
[root@node1 ~]# mkdir img1/
[root@node1 ~]# cd img1/
[root@node1 img1]# ls
[root@node1 img1]# vim index.html
&lt;h1&gt;twfr.github.io &lt;/h1&gt;
[root@node1 img1]# vim Dockerfile
# Description: test image
FROM busybox:latest
MAINTAINER &quot;tanxin &lt;lovegood.xin@gmail.com&gt;&quot;
COPY index.html /data/web/html/
</code></pre>
<h3 id="add">ADD</h3>
<p>ä¸¤ç§å½¢å¼ï¼š</p>
<pre><code>ADD [--chown=&lt;user&gt;:&lt;group&gt;] &lt;src&gt;... &lt;dest&gt;
ADD [--chown=&lt;user&gt;:&lt;group&gt;] [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]
</code></pre>
<p><code>ADD</code>æŒ‡ä»¤ç±»ä¼¼äº<code>COPY</code>æŒ‡ä»¤ï¼Œ <code>ADD</code>æ”¯æŒä½¿ç”¨ TARæ–‡ä»¶å’Œ URLè·¯å¾„</p>
<ul>
<li>æ–‡ä»¶æ“ä½œå‡†åˆ™ï¼ŒåŒ<code>COPY</code>ï¼Œå¦å¤–ï¼š
<ol>
<li>å¦‚æœ&lt;src&gt;ä¸ºURLä¸”&lt;dest&gt;ä¸ä»¥/ç»“å°¾ï¼Œåˆ™&lt;src&gt;æŒ‡å®šçš„æ–‡ä»¶å°†è¢«ä¸‹è½½å¹¶ç›´æ¥è¢«åˆ›å»ºä¸º&lt;dest&gt;ï¼›å¦‚æœ&lt;dest&gt;ä»¥/ç»“å°¾ï¼Œåˆ™æ–‡ä»¶åURLæŒ‡å®šçš„æ–‡ä»¶å°†è¢«ç›´æ¥ä¸‹è½½ï¼Œå¹¶ä¿å­˜ä¸º&lt;dest&gt;/&lt;filename&gt;ï¼Œæ³¨æ„ï¼ŒURLä¸èƒ½æ˜¯ftpæ ¼å¼çš„url</li>
<li>å¦‚æœ&lt;src&gt;æ˜¯ä¸€ä¸ªæœ¬åœ°ç³»ç»Ÿä¸Šçš„å‹ç¼©æ ¼å¼çš„taræ–‡ä»¶ï¼Œå®ƒå°†è¢«å±•å¼€ä¸ºä¸€ä¸ªç›®å½•ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äºâ€œtar -xâ€å‘½ä»¤ï¼Œç„¶åï¼Œé€šè¿‡URLè·å–åˆ°çš„taræ–‡ä»¶å°†ä¸ä¼šè‡ªåŠ¨å±•å¼€</li>
<li>å¦‚æœ&lt;src&gt;æœ‰å¤šä¸ªï¼Œæˆ–å…¶é—´æ¥æˆ–ç›´æ¥ä½¿ç”¨äº†é€šé…ç¬¦ï¼Œåˆ™&lt;dest&gt;å¿…é¡»æ˜¯ä¸€ä¸ªä»¥/ç»“å°¾çš„ç›®å½•è·¯å¾„ï¼›å¦‚æœ&lt;dest&gt;ä¸ä»¥<code>/</code>ç»“å°¾ï¼Œåˆ™å…¶è¢«è§†ä½œä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œ&lt;src&gt;çš„å†…å®¹å°†è¢«ç›´æ¥å†™å…¥åˆ°&lt;dest&gt;</li>
</ol>
</li>
</ul>
<h4 id="copyä¸addçš„åŒºåˆ«">COPYä¸ADDçš„åŒºåˆ«</h4>
<p><code>ADD</code>æ”¯æŒä½¿ç”¨ TARæ–‡ä»¶å’Œ URLè·¯å¾„,æ”¯æŒå°†taræ ¼å¼çš„å‹ç¼©æ–‡ä»¶è§£å‹åˆ°æŒ‡å®šçš„ç›®å½•</p>
<h3 id="label">LABEL</h3>
<pre><code>LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...

LABEL version=&quot;1.0&quot; description=&quot;è¿™æ˜¯ä¸€ä¸ªgithub pages&quot; by=&quot;blog&quot;
</code></pre>
<h3 id="workdir">WORKDIR</h3>
<pre><code>WORKDIR /path/to/workdir
</code></pre>
<p>WORKDIRä¸ºå·¥ä½œç›®å½•ï¼Œå¯ä»¥å‡ºç°å¤šæ¬¡ï¼Œè·¯å¾„ä¹Ÿå¯ä»¥ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä¸è¿‡ï¼Œå…¶æ˜¯ç›¸å¯¹æ­¤å‰ä¸€ä¸ª WORKDIRæŒ‡ä»¤æŒ‡å®šçš„è·¯å¾„ï¼Œè¿˜å¯ä»¥ç”¨ç”±ENVå®šä¹‰çš„å˜é‡</p>
<h3 id="volume">VOLUME</h3>
<pre><code>VOLUME [&quot;/data&quot;]
</code></pre>
<p>å®šä¹‰å·ï¼Œåªèƒ½æ˜¯dockerç®¡ç†çš„å·ï¼Œï¼ŒVOLUMEä¸ºå®¹å™¨ä¸Šçš„ç›®å½•ï¼Œç”¨äºåœ¨ imageä¸­åˆ›å»ºä¸€ä¸ªæŒ‚è½½ç‚¹ç›®å½•ï¼Œä»¥æŒ‚è½½ Docker hostä¸Šçš„å·æˆ–å…¶å®ƒå®¹å™¨ä¸Šçš„å·</p>
<h3 id="expose">EXPOSE</h3>
<pre><code>EXPOSE &lt;port&gt; [&lt;port&gt;/&lt;protocol&gt;...]
</code></pre>
<p>æš´éœ²æŒ‡å®šç«¯å£ï¼Œç”¨äºä¸ºå®¹å™¨æ‰“å¼€æŒ‡å®šè¦ç›‘å¬çš„ç«¯å£ä»¥å®ç°ä¸å¤–éƒ¨é€šä¿¡</p>
<p>&lt;protocol&gt;ç”¨äºæŒ‡å®šä¼ è¾“å±‚åè®®ï¼Œå¯ä¸º tcpæˆ–udpäºŒè€…ä¹‹ä¸€ï¼Œé»˜è®¤ä¸º TCPåè®®</p>
<p>EXPOSEæŒ‡ä»¤å¯ä¸€æ¬¡æŒ‡å®šå¤šä¸ªç«¯å£ï¼Œä½†æ˜¯ä¸èƒ½æŒ‡å®šæš´éœ²ä¸ºå®¿ä¸»æœºçš„æŒ‡å®šç«¯å£ï¼Œå› ä¸ºæŒ‡å®šçš„å®¿ä¸»æœºç«¯å£å¯èƒ½å·²ç»è¢«å ç”¨ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨éšæœºç«¯å£</p>
<pre><code>[root@node1 img1]# vim Dockerfile 
EXPOSE 80/tcp
[root@node1 ~]# docker run --name tinyweb1 --rm tinyhttpd:v0.1-6 /bin/httpd -f -h data/web/html

[root@node1 ~]# docker inspect tinyweb1                                                                                                                                         &quot;IPAddress&quot;: &quot;172.17.0.2&quot;,  

[root@node1 ~]# curl 172.17.0.2
&lt;h1&gt;twfr.github.io &lt;/h1&gt;
[root@node1 ~]# docker port tinyweb1   //æ²¡æœ‰ç«¯å£ä¿¡æ¯   å³æ²¡æœ‰æ­£çœŸæš´éœ²å‡ºæ¥
</code></pre>
<p>å¯åŠ¨å¹¶æš´éœ²ç«¯å£ï¼Œæ³¨æ„ï¼Œå¯åŠ¨å®¹å™¨è¦è·Ÿå¤§å†™Pé€‰é¡¹-Pæ¥æš´éœ²</p>
<pre><code>[root@node1 ~]# docker run --name tinyweb1 --rm -P  tinyhttpd:v0.1-6 /bin/httpd -f -h /data/web/html

[root@node1 ~]# curl 172.17.0.2
&lt;h1&gt;twfr.github.io&lt;/h1&gt;
[root@node1 ~]# docker port tinyweb1
80/tcp -&gt; 0.0.0.0:32768
</code></pre>
<h3 id="env">ENV</h3>
<pre><code>ENV &lt;key&gt;=&lt;value&gt; ...
</code></pre>
<p>æœ‰äº›å˜é‡åœ¨è¿è¡Œä¸ºå®¹å™¨æ—¶ä¾ç„¶æœ‰ç”¨ï¼Œå› æ­¤éœ€è¦æŠŠé‚£äº›å˜é‡åœ¨è¿è¡Œä¸ºå®¹å™¨æ—¶é‡æ–°å®šä¹‰ä¸ºä¸€ä¸ªæ–°çš„å€¼ï¼Œå¦‚æœå˜é‡å¾ˆå¤šï¼Œå¯ä»¥æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œå®šä¹‰ï¼Œä½¿ç”¨å‚æ•° --env-list(docker run --help )å®ç°ï¼Œé€šè¿‡æ–‡ä»¶æ¥åŠ è½½ç¯å¢ƒå˜é‡</p>
<pre><code>[root@node1 ~]# docker run --name tinyweb1 --rm -P -e WEB_SERVER_PACKAGE=&quot;nginx-1.15-6&quot; tinyhttpd:v0.1-7 printenv
WEB_SERVER_PACKAGE=nginx-1.15-6
</code></pre>
<h3 id="arg">ARG</h3>
<pre><code>ARG &lt;name&gt;[=&lt;default value&gt;]
</code></pre>
<p>ARGç”¨äºæŒ‡å®šä¼ é€’ç»™æ„å»ºè¿è¡Œæ—¶çš„å˜é‡</p>
<pre><code>FROM ubuntu
ARG CONT_IMG_VER
ENV CONT_IMG_VER=${CONT_IMG_VER:-v1.0.0}
RUN echo $CONT_IMG_VER
</code></pre>
<pre><code>docker build --build-arg CONT_IMG_VER=v2.0.1 .
</code></pre>
<h3 id="stopsignal">STOPSIGNAL</h3>
<pre><code>STOPSIGNAL signal
</code></pre>
<p>STOPSIGNALç”¨äºè®¾ç½®åœæ­¢å®¹å™¨æ‰€è¦å‘é€çš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ï¼š<br>
æ‰€ä½¿ç”¨çš„ä¿¡å·å¿…é¡»æ˜¯å†…æ ¸ç³»ç»Ÿè°ƒç”¨è¡¨ä¸­çš„åˆæ³•çš„å€¼ï¼Œå¦‚ï¼šSIGKILL</p>
<h3 id="user">USER</h3>
<p>USERç”¨äºæŒ‡å®šè¿è¡Œ imageæ—¶çš„æˆ–è¿è¡Œ Dockerfileä¸­ä»»ä½• RUNã€CMDæˆ– ENTRYPOINTæŒ‡ä»¤æŒ‡å®šçš„ç¨‹åºæ—¶çš„ç”¨æˆ·åæˆ– UID ï¼Œå³æ”¹å˜å®¹å™¨ä¸­è¿è¡Œç¨‹åºçš„èº«ä»½<br>
é»˜è®¤æƒ…å†µä¸‹ï¼Œ containerçš„è¿è¡Œèº«ä»½ä¸º rootç”¨æˆ·<br>
ä»¥ä¸‹å½¢å¼éƒ½æ˜¯okçš„ï¼š</p>
<pre><code>USER user
USER user:group
USER uid
USER uid:gid
USER user:gid
USER uid:group
</code></pre>
<h3 id="onbuild">ONBUILD</h3>
<pre><code>ONBUILD &lt;INSTRUCTION&gt;
</code></pre>
<p>å½“å°†æ˜ åƒç”¨ä½œå¦ä¸€ä¸ªæ„å»ºçš„åŸºç¡€æ—¶ï¼ŒONBUILDæŒ‡ä»¤ä¼šå°†è§¦å‘æŒ‡ä»¤æ·»åŠ åˆ°æ˜ åƒä¸­ï¼Œä»¥ä¾¿ç¨åæ‰§è¡Œã€‚è§¦å‘å™¨å°†åœ¨ä¸‹æ¸¸æ„å»ºçš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œï¼Œå°±åƒå®ƒå·²è¢«æ’å…¥åˆ°ä¸‹æ¸¸Dockerfileä¸­çš„FROMæŒ‡ä»¤ä¹‹åä¸€æ ·ã€‚</p>
<h3 id="dockerfileåŸåˆ™å’Œå»ºè®®">dockerfileåŸåˆ™å’Œå»ºè®®</h3>
<ol>
<li>å®¹å™¨è½»é‡åŒ–ã€‚ä»é•œåƒä¸­äº§ç”Ÿçš„å®¹å™¨åº”è¯¥å°½é‡è½»é‡åŒ–ï¼Œèƒ½åœ¨è¶³å¤ŸçŸ­çš„æ—¶é—´å†…åœæ­¢ã€é”€æ¯ã€é‡æ–°ç”Ÿæˆå¹¶æ›¿æ¢åŸæ¥çš„å®¹å™¨ã€‚</li>
<li>ä½¿ç”¨ .gitignoreã€‚åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼ŒDockerfile ä¼šå’Œæ„å»ºæ‰€éœ€çš„æ–‡ä»¶æ”¾åœ¨åŒä¸€ä¸ªç›®å½•ä¸­ï¼Œä¸ºäº†æé«˜æ„å»ºçš„æ€§èƒ½ï¼Œåº”è¯¥ä½¿ç”¨ .gitignore æ¥è¿‡æ»¤æ‰ä¸éœ€è¦çš„æ–‡ä»¶å’Œç›®å½•ã€‚</li>
<li>ä¸ºäº†å‡å°‘é•œåƒçš„å¤§å°ï¼Œå‡å°‘ä¾èµ–ï¼Œä»…å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ…ã€‚</li>
<li>ä¸€ä¸ªå®¹å™¨åªåšä¸€ä»¶äº‹ã€‚è§£è€¦å¤æ‚çš„åº”ç”¨ï¼Œåˆ†æˆå¤šä¸ªå®¹å™¨ï¼Œè€Œä¸æ˜¯æ‰€æœ‰ä¸œè¥¿éƒ½æ”¾åœ¨ä¸€ä¸ªå®¹å™¨å†…è¿è¡Œã€‚å¦‚ä¸€ä¸ª Python Web åº”ç”¨ï¼Œå¯èƒ½éœ€è¦ Serverã€DBã€Cacheã€MQã€Log ç­‰å‡ ä¸ªå®¹å™¨ã€‚ä¸€ä¸ªæ›´åŠ æç«¯çš„è¯´æ³•ï¼šOne process per containerã€‚</li>
<li>å‡å°‘é•œåƒçš„å›¾å±‚ã€‚ä¸è¦å¤šä¸ª Labelã€ENV ç­‰æ ‡ç­¾ã€‚</li>
<li>å¯¹ç»­è¡Œçš„å‚æ•°æŒ‰ç…§å­—æ¯è¡¨æ’åºï¼Œç‰¹åˆ«æ˜¯ä½¿ç”¨apt-get install -yå®‰è£…åŒ…çš„æ—¶å€™ã€‚</li>
<li>ä½¿ç”¨æ„å»ºç¼“å­˜ã€‚å¦‚æœä¸æƒ³ä½¿ç”¨ç¼“å­˜ï¼Œå¯ä»¥åœ¨æ„å»ºçš„æ—¶å€™ä½¿ç”¨å‚æ•°--no-cache=trueæ¥å¼ºåˆ¶é‡æ–°ç”Ÿæˆä¸­é—´é•œåƒã€‚</li>
</ol>
<h2 id="dockerç”Ÿå‘½å‘¨æœŸ">dockerç”Ÿå‘½å‘¨æœŸ</h2>
<h3 id="é•œåƒ">é•œåƒ</h3>
<p>Docker é•œåƒå¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿï¼Œé™¤äº†æä¾›å®¹å™¨è¿è¡Œæ—¶æ‰€éœ€çš„ç¨‹åºã€åº“ã€èµ„æºã€é…ç½®ç­‰æ–‡ä»¶å¤–ï¼Œè¿˜åŒ…å«äº†ä¸€äº›ä¸ºè¿è¡Œæ—¶å‡†å¤‡çš„ä¸€äº›é…ç½®å‚æ•°ï¼ˆå¦‚åŒ¿åå·ã€ç¯å¢ƒå˜é‡ã€ç”¨æˆ·ç­‰ï¼‰ã€‚é•œåƒä¸åŒ…å«ä»»ä½•åŠ¨æ€æ•°æ®ï¼Œå…¶å†…å®¹åœ¨æ„å»ºä¹‹åä¹Ÿä¸ä¼šè¢«æ”¹å˜ã€‚<br>
é•œåƒï¼ˆImageï¼‰å°±æ˜¯ä¸€å †åªè¯»å±‚ï¼ˆread-only layerï¼‰çš„ç»Ÿä¸€è§†è§’ï¼Œè¿™äº›å±‚æ˜¯Docker å†…éƒ¨çš„å®ç°ç»†èŠ‚ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿä¸Šè®¿é—®åˆ°ã€‚ç»Ÿä¸€æ–‡ä»¶ç³»ç»Ÿ (union file system) æŠ€æœ¯èƒ½å¤Ÿå°†ä¸åŒçš„å±‚æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºè¿™äº›å±‚æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è§†è§’ï¼Œè¿™æ ·å°±éšè—äº†å¤šå±‚çš„å­˜åœ¨ï¼Œåœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ¥ï¼Œåªå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚</p>
<h3 id="å®¹å™¨">å®¹å™¨</h3>
<p>å®¹å™¨ (container) çš„å®šä¹‰å’Œé•œåƒ (image) å‡ ä¹ä¸€æ¨¡ä¸€æ ·ï¼Œä¹Ÿæ˜¯ä¸€å †å±‚çš„ç»Ÿä¸€è§†è§’ï¼Œå”¯ä¸€åŒºåˆ«åœ¨äºå®¹å™¨çš„æœ€ä¸Šé¢é‚£ä¸€å±‚æ˜¯å¯è¯»å¯å†™çš„ã€‚<br>
ç”±äºå®¹å™¨çš„å®šä¹‰å¹¶æ²¡æœ‰æåŠæ˜¯å¦è¦è¿è¡Œå®¹å™¨ï¼Œæ‰€ä»¥å®é™…ä¸Šï¼Œå®¹å™¨ = é•œåƒ + è¯»å†™å±‚ã€‚</p>
<h3 id="ä»“åº“">ä»“åº“</h3>
<p>å­˜æ”¾é•œåƒçš„åœ°æ–¹</p>
<h2 id="dockeræ¶æ„">dockeræ¶æ„</h2>
<p>æ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š</p>
<ul>
<li>Docker Client<br>
å®¢æˆ·ç«¯å¯ä»¥æ„å»ºï¼Œè¿è¡Œå’Œåœæ­¢åº”ç”¨ç¨‹åºï¼Œè¿˜å¯ä»¥è¿œç¨‹ä¸Docker_Hostè¿›è¡Œäº¤äº’ã€‚æœ€å¸¸ç”¨çš„ Docker å®¢æˆ·ç«¯å°±æ˜¯ docker å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker å‘½ä»¤å¾ˆæ–¹ä¾¿åœ°åœ¨ host ä¸Šæ„å»ºå’Œè¿è¡Œ docker å®¹å™¨ã€‚</li>
<li>Docker daemon<br>
Docker daemon æ˜¯æœåŠ¡å™¨ç»„ä»¶ï¼Œä»¥ Linux åå°æœåŠ¡çš„æ–¹å¼è¿è¡Œï¼Œæ˜¯ Docker æœ€æ ¸å¿ƒçš„åå°è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¹ŸæŠŠå®ƒç§°ä¸ºå®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒè´Ÿè´£å“åº”æ¥è‡ª Docker Client çš„è¯·æ±‚ï¼Œç„¶åå°†è¿™äº›è¯·æ±‚ç¿»è¯‘æˆç³»ç»Ÿè°ƒç”¨å®Œæˆå®¹å™¨ç®¡ç†æ“ä½œã€‚è¯¥è¿›ç¨‹ä¼šåœ¨åå°å¯åŠ¨ä¸€ä¸ª API Server ï¼Œè´Ÿè´£æ¥æ”¶ç”± Docker Client å‘é€çš„è¯·æ±‚ï¼Œæ¥æ”¶åˆ°çš„è¯·æ±‚å°†é€šè¿‡Docker daemon å†…éƒ¨çš„ä¸€ä¸ªè·¯ç”±åˆ†å‘è°ƒåº¦ï¼Œç”±å…·ä½“çš„å‡½æ•°æ¥æ‰§è¡Œè¯·æ±‚ã€‚<br>
docker daemonåˆå¯ä»¥åˆ†ä¸ºdocker server engineå’Œjobä¸‰éƒ¨åˆ†<br>
ocker Daemon å¯ä»¥è®¤ä¸ºæ˜¯é€šè¿‡ Docker Server æ¨¡å—æ¥å— Docker Client çš„è¯·æ±‚ï¼Œå¹¶åœ¨ Engine ä¸­å¤„ç†è¯·æ±‚ï¼Œç„¶åæ ¹æ®è¯·æ±‚ç±»å‹ï¼Œåˆ›å»ºå‡ºæŒ‡å®šçš„ Job å¹¶è¿è¡Œã€‚ Docker Daemon è¿è¡Œåœ¨ Docker host ä¸Šï¼Œè´Ÿè´£åˆ›å»ºã€è¿è¡Œã€ç›‘æ§å®¹å™¨ï¼Œæ„å»ºã€å­˜å‚¨é•œåƒã€‚</li>
<li>Docker Image</li>
<li>Docker Registry</li>
<li>Docker Container<br>
å®¹å™¨å¯åŠ¨çš„è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š</li>
</ul>
<ol>
<li>Docker å®¢æˆ·ç«¯æ‰§è¡Œ docker run å‘½ä»¤</li>
<li>Docker daemon å‘ç°æœ¬åœ°æ²¡æœ‰æˆ‘ä»¬éœ€è¦çš„é•œåƒ</li>
<li>daemon ä»æŒ‡å®šçš„é•œåƒä»“åº“ä¸‹è½½é•œåƒ</li>
<li>ä¸‹è½½å®Œæˆåï¼Œé•œåƒè¢«ä¿å­˜åˆ°æœ¬åœ°</li>
<li>Docker daemon å¯åŠ¨å®¹å™¨</li>
</ol>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ k8s summary]]></title>
        <id>https://twFR.github.io/post/k8s-summary/</id>
        <link href="https://twFR.github.io/post/k8s-summary/">
        </link>
        <updated>2020-03-14T13:57:21.000Z</updated>
        <content type="html"><![CDATA[<p>Kubernetes æä¾›äº†ä¸€ä¸ªå¯å¼¹æ€§è¿è¡Œåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ¡†æ¶ã€‚ Kubernetes ä¼šæ»¡è¶³æ‰©å±•è¦æ±‚ã€æ•…éšœè½¬ç§»ã€éƒ¨ç½²æ¨¡å¼ç­‰ï¼Œæä¾›ä»¥ä¸‹æœåŠ¡</p>
<ul>
<li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</li>
<li>å­˜å‚¨ç¼–æ’</li>
<li>è‡ªåŠ¨éƒ¨ç½²å’Œå›æ»š</li>
<li>è‡ªåŠ¨å®Œæˆè£…ç®±è®¡ç®—</li>
<li>è‡ªæˆ‘ä¿®å¤</li>
<li>å¯†é’¥ä¸é…ç½®ç®¡ç†</li>
</ul>
<h2 id="ç»„ä»¶">ç»„ä»¶</h2>
<ul>
<li>
<p>æ§åˆ¶é¢ç»„ä»¶ï¼ˆç®¡ç†é¢ï¼‰</p>
<ol>
<li>kube-apiserver  æœåŠ¡å™¨ï¼Œæä¾›API</li>
<li>kube- controler-manager
<ul>
<li>node controllerï¼šè´Ÿè´£èŠ‚ç‚¹å‡ºç°æ•…éšœæ—¶è¿›è¡Œé€šçŸ¥å’Œå“åº”</li>
<li>replication controllerï¼šè´Ÿè´£ä¸ºç³»ç»Ÿä¸­æ¯ä¸ªå‰¯æœ¬æ§åˆ¶å™¨å¯¹è±¡ç»´æŠ¤æ­£ç¡®æ•°é‡çš„pod</li>
<li>endpoint controllerï¼šå¡«å……endpointså¯¹è±¡ï¼ˆå³åŠ å…¥serviceä¸podï¼‰</li>
<li>service account&amp; token contolersï¼šä¸ºæ–°çš„å‘½åç©ºé—´ä¼ å®¶é»˜è®¤è´¦æˆ·å’ŒAPIè®¿é—®ä»¤ç‰Œ</li>
</ul>
</li>
<li>kube-scheduler ç›‘è§†æ–°åˆ›å»º  æœªæŒ‡å®šnodeçš„podsï¼Œé€‰æ‹©nodeè®©podè¿è¡Œ</li>
<li>etcd  ä¿å­˜é›†ç¾¤æ•°æ®</li>
</ol>
</li>
<li>
<p>Nodeç»„ä»¶ï¼ˆæ•°æ®é¢ï¼‰</p>
<ol>
<li>kubelet  æ¯ä¸ªnodeä¸Šçš„ä»£ç†ã€‚ä¿è¯containerséƒ½è¿è¡Œåœ¨podä¸­ã€‚æ¥æ”¶ä¸€ç»„æä¾›ç»™kubeletçš„PodSpecsï¼Œç¡®ä¿PodSpecsæè¿°çš„å®¹å™¨å¤„äºè¿è¡ŒçŠ¶æ€ä¸”å¥åº·ã€‚ä¸ä¼šç®¡ç†ä¸æ˜¯kubernetsåˆ›å»ºçš„å®¹å™¨</li>
<li>kube-proxy æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ç½‘ç»œä»£ç†ï¼Œç»´æŠ¤èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™</li>
</ol>
</li>
<li>
<p>Container Runtime è´Ÿè´£è¿è¡Œå®¹å™¨çš„è½¯ä»¶ï¼ˆdocker containers CRI-Oï¼‰</p>
</li>
<li>
<p>æ’ä»¶ï¼ˆAddonsï¼‰</p>
<p>æ’ä»¶ä½¿ç”¨ Kubernetes èµ„æºï¼ˆ<a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/daemonset/">DaemonSet</a>ã€ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/">Deployment</a>ç­‰ï¼‰å®ç°é›†ç¾¤åŠŸèƒ½ã€‚å¦‚DNSï¼ŒDashboard</p>
</li>
</ul>
<h2 id="æ¶æ„">æ¶æ„</h2>
<h3 id="èŠ‚ç‚¹">èŠ‚ç‚¹</h3>
<ul>
<li>
<p>å¯ç”¨èŠ‚ç‚¹ä¸Šéƒ½åŒ…æ‹¬kubeletï¼ŒContainer RuntimeåŠkube-proxy</p>
</li>
<li>
<p>å‘APIæœåŠ¡å™¨æ·»åŠ èŠ‚ç‚¹çš„æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼š</p>
<ol>
<li>
<p>èŠ‚ç‚¹ä¸Šçš„kubeletå‘æ§åˆ¶é¢æ‰§è¡Œè‡ªæ³¨å†Œ</p>
<p>å½“ kubelet æ ‡å¿— <code>--register-node</code> ä¸º trueï¼ˆé»˜è®¤ï¼‰æ—¶ï¼Œå®ƒä¼šå°è¯•å‘ API æœåŠ¡æ³¨å†Œè‡ªå·±</p>
</li>
<li>
<p>æ‰‹åŠ¨æ³¨å†Œ<br>
æ‰§è¡Œæ“ä½œåï¼Œæ§åˆ¶é¢ä¼šæ£€æŸ¥æ–°çš„nodeå¯¹è±¡æ˜¯å¦åˆæ³•ã€‚ å¦‚æœèŠ‚ç‚¹æ˜¯å¥åº·çš„ï¼ˆå³æ‰€æœ‰å¿…è¦çš„æœåŠ¡éƒ½åœ¨è¿è¡Œä¸­ï¼‰ï¼Œåˆ™è¯¥èŠ‚ç‚¹å¯ä»¥ç”¨æ¥è¿è¡Œ Podã€‚ å¦åˆ™ï¼Œç›´åˆ°è¯¥èŠ‚ç‚¹å˜ä¸ºå¥åº·ä¹‹å‰ï¼Œæ‰€æœ‰çš„é›†ç¾¤æ´»åŠ¨éƒ½ä¼šå¿½ç•¥è¯¥èŠ‚ç‚¹ã€‚</p>
</li>
</ol>
</li>
</ul>
<h3 id="æ§åˆ¶é¢èŠ‚ç‚¹é€šä¿¡">æ§åˆ¶é¢èŠ‚ç‚¹é€šä¿¡</h3>
<ul>
<li>
<p>èŠ‚ç‚¹åˆ°æ§åˆ¶é¢<br>
Kubernetes é‡‡ç”¨çš„æ˜¯ä¸­å¿ƒè¾å°„å‹ï¼ˆHub-and-Spokeï¼‰API æ¨¡å¼ã€‚ æ‰€æœ‰ä»é›†ç¾¤ï¼ˆæˆ–æ‰€è¿è¡Œçš„ Podsï¼‰å‘å‡ºçš„ API è°ƒç”¨éƒ½ç»ˆæ­¢äº apiserverï¼ˆå…¶å®ƒæ§åˆ¶é¢ç»„ä»¶éƒ½æ²¡æœ‰è¢«è®¾è®¡ä¸ºå¯æš´éœ²è¿œç¨‹æœåŠ¡ï¼‰ã€‚ apiserver è¢«é…ç½®ä¸ºåœ¨ä¸€ä¸ªå®‰å…¨çš„ HTTPS ç«¯å£ï¼ˆ443ï¼‰ä¸Šç›‘å¬è¿œç¨‹è¿æ¥è¯·æ±‚ã€‚åº”è¯¥ä½¿ç”¨é›†ç¾¤çš„å…¬å…±æ ¹è¯ä¹¦å¼€é€šèŠ‚ç‚¹ï¼Œè¿™æ ·å®ƒä»¬å°±èƒ½å¤ŸåŸºäºæœ‰æ•ˆçš„å®¢æˆ·ç«¯å‡­æ®å®‰å…¨åœ°è¿æ¥ apiserverã€‚<br>
å½“ Pod è¢«å®ä¾‹åŒ–æ—¶ï¼ŒKubernetes è‡ªåŠ¨æŠŠå…¬å…±æ ¹è¯ä¹¦å’Œä¸€ä¸ªæœ‰æ•ˆçš„æŒæœ‰è€…ä»¤ç‰Œæ³¨å…¥åˆ° Pod é‡Œã€‚kubernetes æœåŠ¡ï¼ˆä½äºæ‰€æœ‰åå­—ç©ºé—´ä¸­ï¼‰é…ç½®äº†ä¸€ä¸ªè™šæ‹Ÿ IP åœ°å€ï¼Œç”¨äºï¼ˆé€šè¿‡ kube-proxyï¼‰è½¬å‘ è¯·æ±‚åˆ° apiserver çš„ HTTPS æœ«ç«¯ã€‚<br>
æ§åˆ¶é¢ç»„ä»¶ä¹Ÿé€šè¿‡å®‰å…¨ç«¯å£ä¸é›†ç¾¤çš„ apiserver é€šä¿¡ã€‚<br>
é›†ç¾¤èŠ‚ç‚¹å’ŒèŠ‚ç‚¹ä¸Šè¿è¡Œçš„ Pod åˆ°æ§åˆ¶é¢çš„è¿æ¥çš„ç¼ºçœæ“ä½œæ¨¡å¼å³æ˜¯å®‰å…¨çš„ï¼Œ èƒ½å¤Ÿåœ¨ä¸å¯ä¿¡çš„ç½‘ç»œæˆ–å…¬ç½‘ä¸Šè¿è¡Œã€‚</p>
</li>
<li>
<p>æ§åˆ¶é¢åˆ°èŠ‚ç‚¹</p>
<ol>
<li>
<p>APIæœåŠ¡å™¨åˆ°kubelet</p>
<p>ä»apiserveråˆ°kubeletçš„è¿æ¥ç”¨äºï¼š</p>
<ul>
<li>è·å–podæ—¥å¿—</li>
<li>æŒ‚æ¥ï¼ˆé€šè¿‡kubectlï¼‰åˆ°è¿è¡Œä¸­çš„pod</li>
<li>é€šè¿‡kubeletçš„ç«¯å£è½¬å‘åŠŸèƒ½<br>
è¿™äº›è¿æ¥ç»ˆæ­¢äº kubelet çš„ HTTPS æœ«ç«¯ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œapiserver ä¸æ£€æŸ¥ kubelet çš„æœåŠ¡è¯ä¹¦ã€‚è¿™ä½¿å¾—æ­¤ç±»è¿æ¥å®¹æ˜“å—åˆ°ä¸­é—´äººæ”»å‡»ï¼Œ åœ¨éå—ä¿¡ç½‘ç»œæˆ–å…¬å¼€ç½‘ç»œä¸Šè¿è¡Œä¹Ÿæ˜¯ ä¸å®‰å…¨çš„ã€‚</li>
</ul>
</li>
<li>
<p>apiserveråˆ°èŠ‚ç‚¹ï¼Œpodå’ŒæœåŠ¡</p>
<p>ä» apiserver åˆ°èŠ‚ç‚¹ã€Pod æˆ–æœåŠ¡çš„è¿æ¥é»˜è®¤ä¸ºçº¯ HTTP æ–¹å¼ï¼Œå› æ­¤æ—¢æ²¡æœ‰è®¤è¯ï¼Œä¹Ÿæ²¡æœ‰åŠ å¯†ï¼Œè¿™äº›è¿æ¥ <strong>ç›®å‰è¿˜ä¸èƒ½å®‰å…¨åœ°</strong> åœ¨éå—ä¿¡ç½‘ç»œæˆ–å…¬å…±ç½‘ç»œä¸Šè¿è¡Œã€‚</p>
</li>
</ol>
</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[k8s Installation and deployment]]></title>
        <id>https://twFR.github.io/post/k8s-installation-and-deployment/</id>
        <link href="https://twFR.github.io/post/k8s-installation-and-deployment/">
        </link>
        <updated>2019-11-19T16:30:24.000Z</updated>
        <content type="html"><![CDATA[<h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<ul>
<li>Macos/windowsç³»ç»Ÿç”µè„‘</li>
<li>vmwareè™šæ‹Ÿæœº</li>
<li><a href="http://old-releases.ubuntu.com/releases/18.10/ubuntu-18.10-live-server-amd64.iso">Ubuntu18.10</a></li>
<li><a href="http://m6.pc6.com/xuh6/scrt854.zip">secureCRT</a>ï¼ˆç”¨æ¥ç®¡ç†è™šæ‹Ÿæœºçš„ï¼Œæ¯”ç›´æ¥ç”¨vmwareå¥½ç”¨å¤šäº†ï¼‰</li>
<li><a href="https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/docker-ce_18.06.1~ce~3-0~ubuntu_amd64.deb">docker-ce 18.06</a></li>
</ul>
<p>ç”±äºæˆ‘æœ‰ä½ ä»¬æ‡‚å¾—çš„ä¸œè¥¿ï¼Œå¯ä»¥å»å›½å¤–ä¸‹è½½å¯¹åº”çš„é•œåƒç»„ä»¶ç­‰ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¦‚æœæ˜¯æ²¡æœ‰çš„è¯ï¼Œå¯èƒ½è¿˜å¾—é…ç½®ç½‘ç»œæºç­‰ä¸œè¥¿ä¼šæ¯”è¾ƒéº»çƒ¦</p>
<h2 id="å®‰è£…ubuntu">å®‰è£…ubuntu</h2>
<p>æˆ‘æ˜¯ç”¨çš„macè£…çš„vnwareï¼Œåœ¨è™šæ‹Ÿæœºé‡Œé¢è£…çš„ubuntuï¼Œè¿˜æ˜¯è›®ç®€å•çš„ï¼Œæ³¨æ„çš„æ˜¯éœ€è¦è‡³å°‘ç»™è™šæ‹Ÿæœºcpuåˆ†é…ä¸¤æ ¸ï¼Œk8sè‡³å°‘è¦ä¸¤æ ¸æ‰èƒ½å®‰è£…</p>
<h4 id="å®‰è£…éœ€è¦çš„è½¯ä»¶">å®‰è£…éœ€è¦çš„è½¯ä»¶</h4>
<p>å®‰è£…ä¸€äº›åŸºç¡€å·¥å…·</p>
<blockquote>
<p>sudo apt-get update &amp;&amp; apt-get install -y curl telnet wget man \</p>
</blockquote>
<blockquote>
<p>apt-transport-https ca-certificates software-properties-common vim</p>
</blockquote>
<h2 id="å®‰è£…docker">å®‰è£…docker</h2>
<ul>
<li>
<p>ä¸‹è½½docker18.06çš„ç¦»çº¿å®‰è£…åŒ…  [18.06]</p>
</li>
<li>
<p>scpåˆ°è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šé¢å»</p>
<p>å…ˆæŸ¥çœ‹è‡ªå·±è™šæ‹Ÿæœºçš„ipåœ°å€ï¼šifconfig<br>
ç„¶å scp docker-ce_18.06.1_ce_3-0_ubuntu_amd64.deb tan@172.16.234.132:/home/tan/package</p>
</li>
</ul>
<p>æå®š</p>
<ul>
<li>
<p>ç¦»çº¿å®‰è£…è™šæ‹Ÿæœº</p>
<blockquote>
<p>sudo dpkg -i  docker-ce_18.06.1_ce_3-0_ubuntu_amd64.deb</p>
</blockquote>
<p>æˆ‘å®‰è£…é‡åˆ°äº†é”™è¯¯ æç¤ºæˆ‘ä¾èµ–ç¼ºå¤± ç„¶åæˆ‘å°±å®‰è£…ä¾èµ–</p>
<blockquote>
<p>sudo apt-get install -y libltd17</p>
</blockquote>
<p>ç„¶ååˆæç¤ºæˆ‘æ‰¾ä¸åˆ°åŒ…ï¼Œåº”è¯¥å°±æ˜¯æºæ–‡ä»¶çš„é—®é¢˜ï¼Œæ›´æ–°ä¸‹æºæ–‡ä»¶</p>
<blockquote>
<p>#ä»…æ£€æŸ¥ï¼Œä¸æ›´æ–°</p>
<p>sudo apt update</p>
<p>#æ›´æ–°å·²å®‰è£…çš„è½¯ä»¶åŒ…</p>
<p>sudo apt upsade</p>
</blockquote>
<p>è§£å†³ä¹‹åé‡æ–°å®‰è£…dockerï¼Œæå®š</p>
</li>
<li>
<p>å…è®¸å¼€æœºå¯åŠ¨docker</p>
<blockquote>
<p>sudo systemctl enable docker</p>
<p>sudo systemctl start docker</p>
</blockquote>
</li>
<li>
<p>å¯åŠ¨ä¸€ä¸ªç²¾ç®€çš„æ“ä½œç³»ç»Ÿå®¹å™¨æµ‹è¯•</p>
<blockquote>
<p>sudo docker run -ti alpine:latest sh</p>
</blockquote>
</li>
<li>
<p>å°†å½“å‰çš„æ™®é€šç”¨æˆ·æ·»åŠ åˆ°å½“å‰çš„dockerç”¨æˆ·ç»„é‡Œé¢å»</p>
<blockquote>
<p>sudo groupadd docker</p>
<p>sudo usermod -aG docker $USER</p>
</blockquote>
</li>
</ul>
<h2 id="kuberneteså®‰è£…">kuberneteså®‰è£…</h2>
<ul>
<li>
<p>å…è´¹çš„é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨</p>
<p>https://ozcouvlb.mirror.aliyuncs.com</p>
</li>
<li>
<p>é…ç½®å›½å†…é•œåƒåŠ é€Ÿå™¨</p>
<blockquote>
<p>vim /etc/docker/daemon.json</p>
<p>#æ–‡ä»¶é‡Œçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<p># {</p>
<p>#	&quot;registry-mirrors&quot;:  [https://ozcouvlb.mirror.aliyuncs.com]</p>
<p>#}</p>
</blockquote>
</li>
<li>
<p>é‡å¯dockeræœåŠ¡</p>
<blockquote>
<p>sudo systemctl daemon-reload</p>
<p>sudo systemctl restart docker</p>
</blockquote>
</li>
<li>
<p>é…ç½®å¹¶å®‰è£…k8sæº</p>
</li>
<li>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>sudo vim /etc/apt/sources.list.d/kubernetes.list</p>
<p>#æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<p>#deb https://mirrors.ustc.edu.cn/kubernetes/apt kubernets-xenial main</p>
<p>sudo chmod 640 /etc/apt/sources.list.d/kubernetes.list</p>
</blockquote>
</li>
<li>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ›´æ–°æ“ä½œç³»ç»Ÿæº</p>
</li>
</ul>
<pre><code>&gt; sudo apt update
</code></pre>
<ul>
<li>
<p>æœ‰å¯èƒ½é‡åˆ°çš„é—®é¢˜ NO_PUBKEY,è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>#æ·»åŠ è®¤è¯ ä¸€å®šè¦ç”¨è‡ªå·±çš„è´¦æˆ·æ‰§è¡Œï¼Œä¸èƒ½ç”¨root</p>
</blockquote>
<blockquote>
<p>sudo gpg --keyserver keyserver.ubuntu.com --recv-keys BA07F4FB(å›æ˜¾NO_PUBKEYçš„å8ä½)</p>
<p>sudo gpg --export --armor BA07F4FB</p>
<p>#å°†å›æ˜¾çš„keyä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œé¢</p>
<p>vim pubkey</p>
<p>#å°†leyæ·»åŠ åˆ°æœ¬åœ°çš„truestedæ•°æ®åº“ä¸­</p>
<p>sudo apt-key add pubkey</p>
</blockquote>
</li>
<li>
<p>è§£å†³åå†æ¬¡æ›´æ–°ï¼Œå®Œç¾æå®š</p>
</li>
<li>
<p>ç¦æ­¢åŸºç¡€è®¾æ–½</p>
<ul>
<li>å…³é—­é˜²ç«å¢™ï¼ˆå®¹å™¨ä¹‹é—´é€šè®¯ä¸éœ€è¦è¿™äº›é™åˆ¶,è¯è¯´æˆ‘ä¹‹å‰ç”¨winä¸€ç›´ä¹Ÿéƒ½æ˜¯å…³é—­çš„ï¼‰</li>
</ul>
<blockquote>
<p>sudo ufw disable</p>
</blockquote>
<ul>
<li>
<p>å…³é—­swap(k8sä¸å¸Œæœ›ä½¿ç”¨swap)</p>
<blockquote>
<p>sudo swapoff -a</p>
<p>æ°¸ä¹…å…³é—­</p>
<p>sudo sed -i 's/.*swap.*/#$/' /etc/fstab</p>
</blockquote>
</li>
<li>
<p>ç¦æ­¢selinuxï¼ˆubuntué»˜è®¤å®‰è£…çš„å®‰å…¨ç»„ä»¶ï¼‰</p>
<blockquote>
<p>#å®‰è£…æ“æ§selinuxçš„ç»„ä»¶</p>
<p>sudo apt install -y selinux-utils</p>
<p>#ç¦æ­¢selinux</p>
<p>setenforce 0</p>
<p>#é‡å¯</p>
<p>shutdown -r now</p>
<p>#æŸ¥çœ‹æ˜¯å¦å…³é—­</p>
<p>sudo getenforce</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>k8sç³»ç»Ÿç½‘ç»œé…ç½®</p>
<ol>
<li>é…ç½®å†…æ ¸å‚æ•°ï¼Œå°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾</li>
</ol>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>sudo vim /etc/sysctl.d/k8s.conf</p>
</blockquote>
<p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<blockquote>
<p>net.bridge.bridge-nf-call-ip6tables = 1</p>
<p>net.bridge.bridge-nf-call-iptables = 1</p>
<p>vm.swappiness = 0</p>
</blockquote>
<ol start="2">
<li>
<p>ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</p>
<blockquote>
<p>sudo modprobe br_netfilter</p>
</blockquote>
<blockquote>
<p>sudo sysctl -p /etc/sysctl.d/k8s.conf</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>å®‰è£…k8s</p>
<blockquote>
<p>sudo apt update &amp;&amp; apt-get install -y kubelet=1.13.1-00 kubernetes-cni=0.6.0-00 kubeadm=1.13.1-00 kubectl=1.13.1-00</p>
</blockquote>
<ul>
<li>kubelet æ°¸ä¹…çš„åç«¯æœåŠ¡</li>
<li>kubectl å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œç”¨æˆ·å’Œå¼€å‘è€…ä½¿ç”¨kubectlå¯ä»¥è¿ç»´ç»´æŠ¤k8s</li>
<li>kubeadm ä¹Ÿæ˜¯å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œæƒé™å¾ˆé«˜ï¼Œç›¸å½“äºç®¡ç†å‘˜ï¼Œç”¨çš„å¾ˆå°‘</li>
</ul>
</li>
<li>
<p>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p>
<blockquote>
<p>sudo systemctl enable kubelet &amp;&amp; systemctl start kubelet</p>
<p>sudo shutdown -r now</p>
</blockquote>
</li>
<li>
<p>éªŒè¯k8s</p>
<blockquote>
<p>kubectl get nodes</p>
<p>kubectl version</p>
</blockquote>
</li>
</ul>
<h2 id="åˆ›å»ºå¤šèŠ‚ç‚¹">åˆ›å»ºå¤šèŠ‚ç‚¹</h2>
<ul>
<li>
<p>å°†å·²ç»æ­å»ºå¥½çš„ç¯å¢ƒçš„è™šæ‹Ÿæœºå¤åˆ¶ä¸¤ä»½å‡ºæ¥ï¼Œæ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é›†ç¾¤</p>
<p>å°†å·²ç»æ­å»ºå¥½å¼€å‘ç¯å¢ƒçš„è™šæ‹Ÿæœºå…³æœºï¼Œç„¶ååˆ›å»ºå®Œæ•´å…‹éš†</p>
</li>
<li>
<p>ä¹‹åå†ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹æ–°èŠ‚ç‚¹çš„ipï¼Œç”¨secureCRTç™»å½•èŠ‚ç‚¹</p>
</li>
<li>
<p>ç»™nodeé…ç½®hostname</p>
<blockquote>
<p>su</p>
<p>vim /etc/hostname</p>
<p>#åˆ†åˆ«æ”¹ä¸ºmaster/node1/node2</p>
</blockquote>
</li>
<li>
<p>é…ç½®ipåœ°å€</p>
<blockquote>
<p>vim /etc/netplan/50-cloud-init.yaml</p>
</blockquote>
</li>
</ul>
<p>network:</p>
<p>â€‹	 ethernets:</p>
<p>â€‹			ens33:</p>
<p>â€‹					addresses: [172.16.234.134/24]</p>
<p>â€‹					dhcp4: false</p>
<p>â€‹					gateway4: 172.16.234.2</p>
<p>â€‹					nameservers:</p>
<p>â€‹									addresses: [172.16.234.2]</p>
<p>â€‹					optional: true</p>
<p>â€‹			version: 2</p>
<p>æŒ‰ç…§è‡ªå·±èŠ‚ç‚¹çš„ipé…ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¸ºè¿ç»­çš„ipï¼Œæ–¹ä¾¿æ“ä½œï¼Œdhcpæ”¹æˆfalseé˜²æ­¢æ¯æ¬¡é‡å¯ipå˜æ‰</p>
<p>â€‹	&gt; netplan apply</p>
<p>ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<ul>
<li>
<p>ä¿®æ”¹hostsæ–‡ä»¶</p>
<blockquote>
<p>vim /etc/hosts</p>
<p>#è¾“å…¥ä»¥ä¸‹å†…å®¹</p>
<p>#172.16.234.132 master</p>
<p>#172.16.234.133 node1</p>
<p>#172.16.234.134 node2</p>
</blockquote>
</li>
</ul>
<p>ä¸‰ä¸ªèŠ‚ç‚¹å‡éœ€è¦é…ç½®,é€šè¿‡pingæ¥æ£€éªŒæ˜¯å¦é…ç½®æˆåŠŸ</p>
<h2 id="éƒ¨ç½²k8sé›†ç¾¤">éƒ¨ç½²k8sé›†ç¾¤</h2>
<ul>
<li>
<p>---------<font color=red><strong>masterèŠ‚ç‚¹ä¸Šé…ç½®</strong></font> --------</p>
</li>
<li>
<p>åˆ›å»ºk8sçš„ç®¡ç†å·¥å…·kubeadmå¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå€™é€‰æ“ä½œåœ¨/home/itcast/working/ ç›®å½•ä¸‹</p>
</li>
<li>
<p>ä½¿ç”¨kubeadmé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šdockeré•œåƒåœ°å€éƒ¨ç½²</p>
<p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>kubeadm config print init-defaults ClusterConfiguration &gt; kubeadm.conf</p>
</blockquote>
</li>
<li>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶é‡Œé¢çš„ä¸‹é¢é¡¹</p>
<blockquote>
<p>vim kubeadm.conf</p>
<p>#ä¿®æ”¹k8sç‰ˆæœ¬å·ä¸ºv1.13.1</p>
<p>kubernetesVersion: v1.13.1</p>
<p>#ä¿®æ”¹hostnameä¸ºmaster</p>
<p>name: master</p>
<p>#ä¿®æ”¹kubeadm.confä¸­çš„APIæœåŠ¡å™¨åœ°å€</p>
<p>localAPIEndpoint:</p>
<p>â€‹    advertiseAddress: 172.16.234.132    # masterçš„IP</p>
<p>â€‹    bindPortï¼š6443</p>
<p>#é…ç½®å­ç½‘ç½‘ç»œ</p>
<p>networking:</p>
<p>â€‹    dnsDomian: cluster.local</p>
<p>â€‹    podSubnet: &quot;10.244.0.0/16&quot;         #  k8så†…éƒ¨podç½‘ç»œ,å®˜æ–¹æ¨è</p>
<p>â€‹    servicesSubnet: 10.96.0.0/12    # k8sæœåŠ¡ç½‘ç»œ,å®˜æ–¹æ¨è</p>
<p>scheduler: {}</p>
</blockquote>
</li>
<li>
<p>æ‹‰å–k8så¿…å¤‡çš„æ¨¡å—é•œåƒ</p>
<blockquote>
<p>#æŸ¥çœ‹éœ€è¦å“ªäº›é•œåƒæ–‡ä»¶éœ€è¦æ‹‰å–</p>
<p>kubeadm config images list --config kubeadm.conf</p>
<p>#k8s.gcr.io/kube-apiserver:v1.13.1.                   å¯¹å¤–ç«¯å£ï¼Œæä¾›å…¥å£è®©å¤–éƒ¨è®¿é—®é›†ç¾¤<br>
#k8s.gcr.io/kube-controller-manager:v1.13.1     å†…éƒ¨ç®¡ç†å™¨<br>
#k8s.gcr.io/kube-scheduler:v1.13.1                   å†…éƒ¨ä»»åŠ¡è°ƒåº¦å™¨<br>
#k8s.gcr.io/kube-proxy:v1.13.1                         è´Ÿè½½å‡è¡¡<br>
#k8s.gcr.io/pause:3.1                                     ä¸šåŠ¡å®¹å™¨å…±äº«Pauseå®¹å™¨çš„ç½‘ç»œæ ˆå’ŒVolumeæŒ‚è½½å·ï¼Œå› æ­¤ä»–ä»¬ä¹‹é—´é€šä¿¡å’Œæ•°æ®äº¤æ¢æ›´ä¸ºé«˜æ•ˆ<br>
#k8s.gcr.io/etcd:3.2.24                                  æ•°æ®ä¸€è‡´æ€§<br>
#k8s.gcr.io/coredns:1.2.6</p>
<p>#æ‹‰å–å…¨éƒ¨å½“å‰ç‰ˆæœ¬k8så…³è”çš„é•œåƒ</p>
<p>kubeadm config images pull --config ./kubeadm.conf</p>
<p>#å¦‚æœæ— æ³•ä¸‹è½½ï¼Œåªèƒ½å»docker.ioä»“åº“æ‰‹åŠ¨æ‹‰é•œåƒç„¶åæ”¹tagï¼ˆæˆ–è€…registry.cn-hangzhou.aliyuncs.com/google_containersï¼‰</p>
<p>docker pull mirrorgooglecontainers/kube-apiserver:v1.13.1</p>
<p>docker tag mirrorgooglecontainers/kube-apiserver:v1.13.1 k8s.gcr.io/kube-apiserver:v1.13.1 #æ‰“tagï¼Œå’Œéœ€è¦çš„é•œåƒåä¿æŒä¸€è‡´</p>
<p>docker rmi mirrorgooglecontainers/kube-apiserver:v1.13.1    #åˆ é™¤æ‰å¤šä½™çš„é•œåƒ</p>
<p>#å…¶ä»–æ‰€æœ‰é•œåƒç±»ä¼¼,k8s.gcr.io/coredns:1.2.6ç‰¹ä¾‹</p>
<p>docker pull coredns/coredns:1.1.3</p>
<p>root@tan:/home/tan/package# docker images<br>
REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE<br>
k8s.gcr.io/kube-proxy                v1.13.1             fdb321fd30a0        11 months ago       80.2MB<br>
k8s.gcr.io/kube-apiserver            v1.13.1             40a63db91ef8        11 months ago       181MB<br>
k8s.gcr.io/kube-controller-manager   v1.13.1             26e6f1db2a52        11 months ago       146MB<br>
k8s.gcr.io/kube-scheduler            v1.13.1             ab81d7360408        11 months ago       79.6MB<br>
k8s.gcr.io/etcd                      3.2.24              3cab8e1b9802        14 months ago       220MB<br>
k8s.gcr.io/coredns                   1.2.6               b3b94275d97c        18 months ago       45.6MB<br>
k8s.gcr.io/pause                     3.1                 da86e6ba6ca1        23 months ago       742kB</p>
</blockquote>
</li>
<li>
<p>åˆå§‹åŒ–k8sç¯å¢ƒ</p>
<blockquote>
<p>sudo kubeadm init --config ./kubeadm.conf</p>
</blockquote>
</li>
</ul>
<p>å›æ˜¾å¦‚ä¸‹ï¼š</p>
<pre><code>	 &gt; Your Kubernetes master has initialized successfully!
	 &gt;
	 &gt; To start using your cluster, you need to run the following as a regular user:
	 &gt;
	 &gt; â€‹    mkdir -p $HOME/.kube
	 &gt;
	 &gt; â€‹	sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
	 &gt;
	 &gt; â€‹	sudo chown $(id -u):$(id -g) $HOME/.kube/config
	 &gt;
	 &gt; You should now deploy a pod network to the cluster.
	 &gt; Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
	 &gt;   https://kubernetes.io/docs/concepts/cluster-administration/addons/
	 &gt;
	 &gt; You can now join any number of machines by running the following on each node
	 &gt; as root:
	 &gt;
	 &gt;   kubeadm join 172.16.234.132:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:ebc50ff8588c35917f9c6f84f2bd8048352b82bfb9ef06cf5b63934cb9862f49
</code></pre>
<p>æ ¹æ®æç¤ºï¼Œåšå¦‚ä¸‹æ“ä½œ</p>
<blockquote>
<p>#masterèŠ‚ç‚¹åŸºæœ¬æ–‡ä»¶å¤¹é…ç½®</p>
</blockquote>
<blockquote>
<p>mkdir -p $HOME/.kube</p>
<p>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</p>
<p>sudo chown <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>i</mi><mi>d</mi><mo>âˆ’</mo><mi>u</mi><mo>)</mo><mo>:</mo></mrow><annotation encoding="application/x-tex">(id -u):</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span>(id -g) $HOME/.kube/config</p>
</blockquote>
<p>åŒæ—¶ï¼Œå¦‚æœnodeèŠ‚ç‚¹æƒ³è¦åŠ å…¥masteré›†ç¾¤ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<blockquote>
<p>kubeadm join 172.16.234.132:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:ebc50ff8588c35917f9c6f84f2bd8048352b82bfb9ef06cf5b63934cb9862f49</p>
</blockquote>
<ul>
<li>
<p>å¯åŠ¨k8s</p>
<blockquote>
<p>sudo systemctl enable kubelet</p>
<p>sudo systemctl start kubelet</p>
</blockquote>
</li>
<li>
<p>éªŒè¯k8så¯åŠ¨ç»“æœ</p>
<blockquote>
<p>kubectl get node</p>
</blockquote>
</li>
</ul>
<p>å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª <a href="https://stackoverflow.com/questions/52720380/kubernetes-api-server-is-not-starting-on-a-single-kubeadm-cluster">æ‹‰å–æœ€æ–°ç‰ˆæœ¬</a>ç„¶åé‡æ–°æ¥ä¸€éï¼Œæˆ‘å°±æ˜¯è¿™ä¸ªèŠ±äº†ä¸€ä¸‹åˆï¼ˆå¾®ç¬‘è„¸ï¼‰</p>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[fibobacci]]></title>
        <id>https://twFR.github.io/post/fibobacci/</id>
        <link href="https://twFR.github.io/post/fibobacci/">
        </link>
        <updated>2019-11-18T15:49:09.000Z</updated>
        <content type="html"><![CDATA[<p>ä»Šå¤©ç®€å•åšä¸€ä¸ªé¢˜ï¼Œè¿™ä¸ªç‚¹äº†ï¼Œå¤ªç´¯äº†ï¼Œæ‰“å¡æ»´</p>
<h2 id="éœ€æ±‚">éœ€æ±‚</h2>
<p>ç»™ä¸€ä¸ªæ•°Nï¼Œçœ‹èƒ½é€šè¿‡å¤šå°‘æ­¥N+1æˆ–è€…N-1ä½¿å®ƒæˆä¸ºfibobacciæ•°<br>
0&lt; N &lt;1000000<br>
fibobacciéƒ½æ¸…æ¥š 0 1 1 2 3 5 8 13 ... ä¸èµ˜è¿°</p>
<h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2>
<p>è¾“å…¥ï¼š</p>
<blockquote>
<p>5<br>
15</p>
</blockquote>
<p>è¾“å‡ºï¼š</p>
<blockquote>
<p>0<br>
2</p>
</blockquote>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>è¿™ä¸ªå°±å¾ˆç®€å•ï¼Œä¸ç”¨è¯´äº†<br>
çœ‹æˆ‘æç®€ä»£ç é£æ ¼ï¼Œå“ˆå“ˆå“ˆğŸ˜‚</p>
<h2 id="æç®€ä»£ç ">æç®€ä»£ç </h2>
<pre><code>package main

import &quot;fmt&quot;

func main() {
	var number int
	for {
		if num, err := fmt.Scanf(&quot;%d&quot;, &amp;number); num != 1 || err != nil {
			return
		}
		begin, next := 0, 1
		for begin+next &lt; number {
			begin, next = next, begin+next
		}
		if number-next &lt; begin+next-number {
			fmt.Println(number - next)
		} else {
			fmt.Println(begin + next - number)
		}
	}
}

</code></pre>
<p>å½“ç„¶ä¸æ¨èï¼Œå®¹æ˜“è¢«æ‰“æ­»</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[binary search]]></title>
        <id>https://twFR.github.io/post/binary-search/</id>
        <link href="https://twFR.github.io/post/binary-search/">
        </link>
        <updated>2019-11-17T12:43:15.000Z</updated>
        <content type="html"><![CDATA[<h2 id="éœ€æ±‚">éœ€æ±‚</h2>
<p>å°Qçš„çˆ¶æ¯è¦å‡ºå·®Nå¤©ï¼Œèµ°ä¹‹å‰ç»™å°Qç•™ä¸‹äº†Må—å·§å…‹åŠ›ã€‚å°Qå†³å®šæ¯å¤©åƒçš„å·§å…‹åŠ›æ•°é‡ä¸å°‘äºå‰ä¸€å¤©çš„ä¸€åŠï¼Œä½†æ˜¯ä»–åˆä¸æƒ³åœ¨çˆ¶æ¯å›æ¥ä¹‹å‰æŠŠå·§å…‹åŠ›åƒå®Œï¼Œè¯·é—®ä»–<font color=red>ç¬¬</font>ä¸€å¤©<font color=red>æœ€å¤š</font>èƒ½åƒå¤šå°‘å—è›‹ç³•<br>
N&lt;=50000,N&lt;M&lt;100000</p>
<h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2>
<p>è¾“å…¥ï¼š</p>
<blockquote>
<p>3 7<br>
4 7</p>
</blockquote>
<p>è¾“å‡ºï¼š</p>
<blockquote>
<p>4<br>
3</p>
</blockquote>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<ul>
<li>æœ¬é¢˜å¯ä»¥æƒ³æˆï¼Œæˆ‘ä»1ï½Må—å·§å…‹åŠ›ä¸­é€‰å‡ºä¸€å—æ¥ï¼Œè¿™å—å·§å…‹åŠ›å°±æ˜¯æˆ‘ç¬¬ä¸€å¤©æœ€å¤šèƒ½åƒçš„å·§å…‹åŠ›</li>
<li>é‚£è¿™ä¸ªé€‰å‡ºæ¥çš„æœ‰ä»€ä¹ˆæ¡ä»¶éœ€è¦æ»¡è¶³å‘¢ï¼šè¦æ»¡è¶³æˆ‘é€‰å‡ºæ¥çš„è¿™ä¸ªæ˜¯ç¬¬ä¸€å¤©æœ€å¤šèƒ½åƒçš„ï¼Œé‚£ä¹ˆå°±æ˜¯æœ€åå‡ å¤©éƒ½è¦åƒæœ€å°‘çš„ï¼Œä½†åˆè¦æ»¡è¶³ä¸å°‘äºå‰ä¸€å¤©çš„ä¸€åŠï¼Œæ‰€ä»¥å°±æ˜¯åˆšå¥½åƒå‰ä¸€å¤©çš„ä¸€åŠã€‚æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¦åƒå°±æ˜¯ä¸€æ•´å—ï¼Œä¸å­˜åœ¨æ˜¯åƒå‡ åˆ†ä¹‹ä¸€å—ï¼Œå¼ºè¿«ç—‡å¾ˆèˆ’æœ</li>
<li>é‚£å°±æ˜¯æˆ‘ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•å»é€‰ä¸€ä¸ªå·§å…‹åŠ›æ•°å‡ºæ¥ï¼Œå»çœ‹æ˜¯å¦æ»¡è¶³æ¡ä»¶</li>
<li>è¿™ä¸ªæ¡ä»¶å‘¢å°±æ˜¯ä½ æ¯å¤©åƒçš„åŠ èµ·æ¥åˆšå¥½æˆ–è€…è¯´å°äºä½ çš„æ€»å·§å…‹åŠ›æ•°ï¼Œä¸èƒ½é¥¿æ­»å˜›ï¼Œä¿è¯æ¯å¤©éƒ½æœ‰åƒçš„</li>
</ul>
<h2 id="ä»£ç å®ç°">ä»£ç å®ç°</h2>
<pre><code>package main

import (
	&quot;fmt&quot;
	&quot;math&quot;
	&quot;os&quot;
)

// å‡ºå·®å¤©æ•°
var N int

// å·§å…‹åŠ›ä¸ªæ•°
var M int

func main() {
	for {
		num, err := fmt.Scanf(&quot;%d %d&quot;, &amp;N, &amp;M)
		if num != 2 || err != nil {
			fmt.Println(err)
			os.Exit(1)
		}
		search()
	}
}

// å‡å¦‚ç¬¬ä¸€å¤©åƒnä¸ª,è®¡ç®—æ€»å…±åƒäº†å¤šå°‘ä¸ª
func sum(n int) (m int) {
	for i := 0; i &lt; N; i++ {
		m =m + n
		n = int(math.Ceil(float64 (n) / 2))
	}
	return m
}

// äºŒåˆ†æŸ¥æ‰¾æ»¡è¶³çš„æ¡ä»¶
func search() {
	begin := 1
	end := M
	mid := 0
	if N == 1 {
		fmt.Println(M)
		return
	}
	for i := 0; i &lt; M; i++ {

		if begin &gt; end {
			break
		}
		// å‘ä¸Šå–æ•´ï¼Œè¦åƒå°±è¦åƒä¸€æ•´ä¸ª
		mid = int(math.Ceil(float64(end+begin) / 2))
		if sum(mid) == M {
			fmt.Println(mid)
			return
		}
		if sum(mid) &lt; M {
			// å–ç­‰äºæ˜¯å› ä¸ºé˜²æ­¢æ²¡æœ‰æ­£å¥½åƒå®Œçš„æƒ…å†µï¼Œéœ€è¦å–midçš„å€¼
			begin = mid
		} else {
			end = mid - 1
		}
	}
	// è¿™æ˜¯æœ‰å‰©ä½™å·§å…‹åŠ›çš„æƒ…å†µ
	fmt.Println(mid)
}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Insert sort]]></title>
        <id>https://twFR.github.io/post/insert-sort/</id>
        <link href="https://twFR.github.io/post/insert-sort/">
        </link>
        <updated>2019-11-15T15:36:02.000Z</updated>
        <content type="html"><![CDATA[<h2 id="éœ€æ±‚">éœ€æ±‚</h2>
<p>è¾“å…¥nä¸ªæ•°å­—ï¼Œï¼ˆç¬¬ä¸€è¡Œæ•°å­—è¡¨ç¤ºå°†è¦è¾“å…¥æ•°å­—çš„ä¸ªæ•°ï¼‰<br>
æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºæ’åºåä¸€è¡Œè¾“å‡º</p>
<h2 id="ç¤ºä¾‹">ç¤ºä¾‹</h2>
<p>è¾“å…¥ï¼š</p>
<blockquote>
<p>5<br>
12<br>
45<br>
2<br>
14<br>
1</p>
</blockquote>
<p>è¾“å‡ºï¼š</p>
<blockquote>
<p>1 2 12 14 45</p>
</blockquote>
<h2 id="è§£é¢˜æ€è·¯">è§£é¢˜æ€è·¯</h2>
<p>ä»Šå¤©ä½¿ç”¨æ’å…¥æ’åºæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p>
<ul>
<li>å¾ªç¯éœ€è¦æ’åºçš„æ•°ç»„</li>
<li>ä»ç¬¬äºŒä¸ªæ•°å­—å¼€å§‹ï¼Œå’Œå‰ä¸€ä¸ªæ¯”è¾ƒï¼Œå¦‚æœæ¯”å‰ä¸€ä¸ªå°ï¼Œå°±è¯´æ˜è¿™ç¬¬iä¸ªæ•°å­—néœ€è¦é‡æ–°æ’åº</li>
<li>å°†è¿™ä¸ªæ•°å­—å’Œå‰é¢çš„æ‰€æœ‰æ•°å­—æ¯”è¾ƒï¼Œå½“næ¯”ç¬¬jä¸ªæ•°å­—ä½ç½®å°çš„æ—¶å€™ï¼ˆj&lt;iï¼‰ï¼Œåˆ™è¯´æ˜è¿™ä¸ªjä½ç½®å°±æ˜¯néœ€è¦æ’å…¥çš„ä½ç½®</li>
<li>å°†jä½ç½®åˆ°i-1ä½ç½®çš„æ•°å­—å…¨éƒ¨é¡ºåºå‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå³å°†ã€i-1ã€‘èµ‹ç»™ã€iã€‘ï¼Œæœ€åå°†æœ€å¼€å§‹çš„ã€iã€‘èµ‹ç»™ã€jã€‘</li>
<li>å¾ªç¯å®Œæ•°ç»„åˆ™æ’åºå®Œæ¯•ï¼Œover</li>
</ul>
<pre><code>func insertSort(disorderNumber []int) []int {
	for i := 1; i &lt; len(disorderNumber); i++ {
		if disorderNumber[i] &lt; disorderNumber[i-1] {
			for j := 0; j &lt; i; j++ {
				if disorderNumber[j] &gt; disorderNumber[i] {
					// æ’å…¥ä½ç½®
					temp := disorderNumber[i]
					// å°†æ’å…¥ä½ç½®åé¢çš„æ•°åˆ°éœ€è¦æ’å…¥çš„æ•°æ•´ä½“åç§»ä¸€ä½
					for k := i; k &gt; j; k-- {
						disorderNumber[k] = disorderNumber[k-1]
					}
					disorderNumber[j] = temp
				}
				// å¦‚æœæ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œåˆ™ä¸éœ€è¦å†å‘åé¢å¾ªç¯
				break
			}
		}
	}
	return disorderNumber
}
</code></pre>
<h2 id="å®Œæ•´ä»£ç ">å®Œæ•´ä»£ç </h2>
<pre><code>package main

import (
	&quot;fmt&quot;
	&quot;os&quot;
	&quot;strconv&quot;
)

func main() {
	var num int
	n, err := fmt.Scanf(&quot;%d&quot;, &amp;num)
	if n != 1 || err != nil {
		os.Exit(1)
	}
	disorderNumber := make([]int, num)
	for i := 0; i &lt; num; i++ {
		n, err := fmt.Scanf(&quot;%d&quot;, &amp;disorderNumber[i])
		if n != 1 || err != nil {
			fmt.Println(n,err)
			os.Exit(1)
		}
	}
	orderNumber := insertSort(disorderNumber)
	for i := 0; i &lt; len(orderNumber); i++ {
		fmt.Print(strconv.Itoa(orderNumber[i]) + &quot; &quot;)
	}
}

func insertSort(disorderNumber []int) []int {
	for i := 1; i &lt; len(disorderNumber); i++ {
		if disorderNumber[i] &lt; disorderNumber[i-1] {
			for j := 0; j &lt; i; j++ {
				if disorderNumber[j] &gt; disorderNumber[i] {
					// æ’å…¥ä½ç½®
					temp := disorderNumber[i]
					// å°†æ’å…¥ä½ç½®åé¢çš„æ•°åˆ°éœ€è¦æ’å…¥çš„æ•°æ•´ä½“åç§»ä¸€ä½
					for k := i; k &gt; j; k-- {
						disorderNumber[k] = disorderNumber[k-1]
					}
					disorderNumber[j] = temp
				}
				// å¦‚æœæ‰¾åˆ°æ’å…¥ä½ç½®ï¼Œåˆ™ä¸éœ€è¦å†å‘åé¢å¾ªç¯
				break
			}
		}
	}
	return disorderNumber
}
</code></pre>
]]></content>
    </entry>
</feed>