<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>golang summary | ğŸŒŸè°­å…ˆç”Ÿâœ¨</title>
<link rel="shortcut icon" href="https://twFR.github.io/favicon.ico?v=1610643249270">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://twFR.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://twFR.github.io">
  <img class="avatar" src="https://twFR.github.io/images/avatar.png?v=1610643249270" alt="">
  </a>
  <h1 class="site-title">
    ğŸŒŸè°­å…ˆç”Ÿâœ¨
  </h1>
  <p class="site-description">
    æ•²ä¸å‡ºä»£ç çš„ç¨‹åºçŒ¿çš„ğŸ 
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
        <a href="https://www.facebook.com/xin.tan.106902" target="_blank">
          <i class="fab fa-facebook"></i>
        </a>
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              golang summary
            </h2>
            <div class="post-info">
              <time class="post-time">
                Â· 2019-05-26 Â·
              </time>
              
                <a href="https://twFR.github.io/tag/Z7--HtZrc/" class="post-tag">
                  # golang
                </a>
              
            </div>
            
            <div class="post-content">
              <h2 id="æ•°ç»„">æ•°ç»„</h2>
<ul>
<li>æ•°ç»„å˜é‡å³è¡¨ç¤ºæ•´ä¸ªæ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªå®Œæ•´çš„å€¼ã€‚å½“iä¸ªæ•°ç»„å˜é‡<font color=red ><strong>è¢«èµ‹å€¼</strong></font> æˆ–è€…<font color=red ><strong>è¢«ä¼ é€’</strong></font>çš„æ—¶å€™ï¼Œå®é™…ä¸Šä¼šå¤åˆ¶æ•´ä¸ªæ•°ç»„ã€‚ä¸ºäº†é¿å…å¤åˆ¶æ•°ç»„å¸¦æ¥çš„å¼€é”€ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œä½†æ˜¯æ•°ç»„æŒ‡é’ˆå¹¶ä¸æ˜¯æ•°ç»„</li>
<li>æ•°ç»„çš„å®šä¹‰æ–¹å¼ï¼š<pre><code>var a [3]int                    // å®šä¹‰é•¿åº¦ä¸º3çš„intå‹æ•°ç»„, å…ƒç´ å…¨éƒ¨ä¸º0
var b = [...]int{1, 2, 3}       // å®šä¹‰é•¿åº¦ä¸º3çš„intå‹æ•°ç»„, å…ƒç´ ä¸º 1, 2, 3
var c = [...]int{2: 3, 1: 2}    // å®šä¹‰é•¿åº¦ä¸º3çš„intå‹æ•°ç»„, å…ƒç´ ä¸º 0, 2, 3
var d = [...]int{1, 2, 4: 5, 6} // å®šä¹‰é•¿åº¦ä¸º6çš„intå‹æ•°ç»„, å…ƒç´ ä¸º 1, 2, 0, 0, 5, 6
</code></pre>
</li>
</ul>
<h2 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h2>
<ul>
<li>Goå­—ç¬¦ä¸²åº•å±‚ç»“æ„ <code>reflect.StringHeader</code>:<pre><code>type StringHeader struct {
    Data uintptr
    Len   int
}
</code></pre>
å­—ç¬¦ä¸²ç»“æ„æœ‰ä¸¤ä¸ªä¿¡æ¯æ„æˆï¼šç¬¬ä¸€ä¸ªæ˜¯å­—ç¬¦ä¸²æŒ‡å‘çš„åº•å±‚å­—èŠ‚æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯å­—ç¬¦ä¸²çš„å­—èŠ‚é•¿åº¦ã€‚å­—ç¬¦ä¸²   å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ã€‚å› æ­¤å­—ç¬¦ä¸²çš„èµ‹å€¼æ“ä½œä¹Ÿå°±æ˜¯reflect.StringHeaderç»“æ„ä½“çš„å¤åˆ¶è¿‡ç¨‹ï¼Œå¹¶ä¸ä¼šæ¶‰   åŠåº•å±‚å­—èŠ‚æ•°ç»„çš„å¤åˆ¶</li>
<li>å­—ç¬¦ä¸²è™½ç„¶ä¸æ˜¯åˆ‡ç‰‡ï¼Œä½†æ˜¯æ”¯æŒåˆ‡ç‰‡æ“ä½œï¼Œå› ä¸ºå­—ç¬¦ä¸²æ˜¯åªè¯»çš„ï¼Œç›¸åŒçš„å­—ç¬¦ä¸²é¢å€¼å¸¸é‡é€šå¸¸å¯¹åº”åŒä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡</li>
</ul>
<h2 id="åˆ‡ç‰‡">åˆ‡ç‰‡</h2>
<ul>
<li>
<p>Goåˆ‡ç‰‡çš„åº•å±‚ç»“æ„ï¼Œ<code>reflect.SliceHeader</code>:</p>
<pre><code>type SliceHeader struct {
  Data uintptr
  Len  int
  Cap  int
}
</code></pre>
</li>
<li>
<p>åˆ‡ç‰‡çš„å®šä¹‰æ–¹å¼</p>
<pre><code>var (
    a []int               // nilåˆ‡ç‰‡, å’Œ nil ç›¸ç­‰, ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªä¸å­˜åœ¨çš„åˆ‡ç‰‡
    b = []int{}           // ç©ºåˆ‡ç‰‡, å’Œ nil ä¸ç›¸ç­‰, ä¸€èˆ¬ç”¨æ¥è¡¨ç¤ºä¸€ä¸ªç©ºçš„é›†åˆ
    c = []int{1, 2, 3}    // æœ‰3ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenå’Œcapéƒ½ä¸º3
    d = c[:2]             // æœ‰2ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenä¸º2, capä¸º3
    e = c[0:2:cap(c)]     // æœ‰2ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenä¸º2, capä¸º3
    f = c[:0]             // æœ‰0ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenä¸º0, capä¸º3
    g = make([]int, 3)    // æœ‰3ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenå’Œcapéƒ½ä¸º3
    h = make([]int, 2, 3) // æœ‰2ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenä¸º2, capä¸º3
    i = make([]int, 0, 3) // æœ‰0ä¸ªå…ƒç´ çš„åˆ‡ç‰‡, lenä¸º0, capä¸º3
)
</code></pre>
</li>
<li>
<p>æ·»åŠ åˆ‡ç‰‡å…ƒç´ </p>
<p>å†…ç½®çš„æ³›å‹å‡½æ•°appendå¯ä»¥åœ¨åˆ‡ç‰‡çš„å°¾éƒ¨è¿½åŠ Nä¸ªå…ƒç´ ï¼š</p>
<pre><code>var a []int
a = append(a, 1)               // è¿½åŠ 1ä¸ªå…ƒç´ 
a = append(a, 1, 2, 3)         // è¿½åŠ å¤šä¸ªå…ƒç´ , æ‰‹å†™è§£åŒ…æ–¹å¼
a = append(a, []int{1,2,3}...) // è¿½åŠ ä¸€ä¸ªåˆ‡ç‰‡, åˆ‡ç‰‡éœ€è¦è§£åŒ…
</code></pre>
<p>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®¹é‡ä¸è¶³çš„æƒ…å†µä¸‹ï¼Œappendçš„æ“ä½œä¼šå¯¼è‡´é‡æ–°åˆ†é…å†…å­˜ï¼Œå¯èƒ½å¯¼è‡´å·¨å¤§çš„å†…å­˜åˆ†é…å’Œ   å¤åˆ¶æ•°æ®ä»£ä»·ã€‚å³ä½¿å®¹é‡è¶³å¤Ÿï¼Œä¾ç„¶éœ€è¦ç”¨appendå‡½æ•°çš„è¿”å›å€¼æ¥æ›´æ–°åˆ‡ç‰‡æœ¬èº«ï¼Œå› ä¸ºæ–°åˆ‡ç‰‡çš„é•¿åº¦å·²ç»   å‘ç”Ÿäº†å˜åŒ–ã€‚</p>
<p>é™¤äº†åœ¨åˆ‡ç‰‡çš„å°¾éƒ¨è¿½åŠ ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨åˆ‡ç‰‡çš„å¼€å¤´æ·»åŠ å…ƒç´ ï¼š</p>
<pre><code>var a = []int{1,2,3}
a = append([]int{0}, a...)        // åœ¨å¼€å¤´æ·»åŠ 1ä¸ªå…ƒç´ 
a = append([]int{-3,-2,-1}, a...) // åœ¨å¼€å¤´æ·»åŠ 1ä¸ªåˆ‡ç‰‡
</code></pre>
<p>åœ¨å¼€å¤´ä¸€èˆ¬éƒ½ä¼šå¯¼è‡´å†…å­˜çš„é‡æ–°åˆ†é…ï¼Œè€Œä¸”ä¼šå¯¼è‡´å·²æœ‰çš„å…ƒç´ å…¨éƒ¨å¤åˆ¶1æ¬¡ã€‚å› æ­¤ï¼Œä»åˆ‡ç‰‡çš„å¼€å¤´æ·»åŠ å…ƒ    ç´ çš„æ€§èƒ½ä¸€èˆ¬è¦æ¯”ä»å°¾éƒ¨è¿½åŠ å…ƒç´ çš„æ€§èƒ½å·®å¾ˆå¤šã€‚</p>
<p>ç”±äºappendå‡½æ•°è¿”å›æ–°çš„åˆ‡ç‰‡ï¼Œä¹Ÿå°±æ˜¯å®ƒæ”¯æŒé“¾å¼æ“ä½œã€‚æˆ‘ä»¬å¯ä»¥å°†å¤šä¸ªappendæ“ä½œç»„åˆèµ·æ¥ï¼Œå®ç°åœ¨    åˆ‡ç‰‡ä¸­é—´æ’å…¥å…ƒç´ ï¼š</p>
<pre><code>var a []int
a = append(a[:i], append([]int{x}, a[i:]...)...)     // åœ¨ç¬¬iä¸ªä½ç½®æ’å…¥x
a = append(a[:i], append([]int{1,2,3}, a[i:]...)...) // åœ¨ç¬¬iä¸ªä½ç½®æ’å…¥åˆ‡ç‰‡
</code></pre>
<p>æ¯ä¸ªæ·»åŠ æ“ä½œä¸­çš„ç¬¬äºŒä¸ªappendè°ƒç”¨éƒ½ä¼šåˆ›å»ºä¸€ä¸ªä¸´æ—¶åˆ‡ç‰‡ï¼Œå¹¶å°†a[i:]çš„å†…å®¹å¤åˆ¶åˆ°æ–°åˆ›å»ºçš„åˆ‡ç‰‡ä¸­,<br>
ç„¶åå°†ä¸´æ—¶åˆ›å»ºçš„åˆ‡ç‰‡å†è¿½åŠ åˆ°a[:i]ã€‚</p>
<p>å¯ä»¥ç”¨copyå’Œappendç»„åˆå¯ä»¥é¿å…åˆ›å»ºä¸­é—´çš„ä¸´æ—¶åˆ‡ç‰‡ï¼ŒåŒæ ·æ˜¯å®Œæˆæ·»åŠ å…ƒç´ çš„æ“ä½œï¼š</p>
<pre><code>a = append(a, 0)     // åˆ‡ç‰‡æ‰©å±•1ä¸ªç©ºé—´
copy(a[i+1:], a[i:]) // a[i:]å‘åç§»åŠ¨1ä¸ªä½ç½®
a[i] = x             // è®¾ç½®æ–°æ·»åŠ çš„å…ƒç´ 
</code></pre>
<p>ç¬¬ä¸€å¥appendç”¨äºæ‰©å±•åˆ‡ç‰‡çš„é•¿åº¦ï¼Œä¸ºè¦æ’å…¥çš„å…ƒç´ ç•™å‡ºç©ºé—´ã€‚ç¬¬äºŒå¥copyæ“ä½œå°†è¦æ’å…¥ä½ç½®å¼€å§‹ä¹‹å    çš„å…ƒç´ å‘åæŒªåŠ¨ä¸€ä¸ªä½ç½®ã€‚ç¬¬ä¸‰å¥çœŸå®åœ°å°†æ–°æ·»åŠ çš„å…ƒç´ èµ‹å€¼åˆ°å¯¹åº”çš„ä½ç½®ã€‚æ“ä½œè¯­å¥è™½ç„¶å†—é•¿äº†ä¸€ç‚¹ï¼Œ   ä½†æ˜¯ç›¸æ¯”å‰é¢çš„æ–¹æ³•ï¼Œå¯ä»¥å‡å°‘ä¸­é—´åˆ›å»ºçš„ä¸´æ—¶åˆ‡ç‰‡ã€‚</p>
<p>ç”¨copyå’Œappendç»„åˆä¹Ÿå¯ä»¥å®ç°åœ¨ä¸­é—´ä½ç½®æ’å…¥å¤šä¸ªå…ƒç´ (ä¹Ÿå°±æ˜¯æ’å…¥ä¸€ä¸ªåˆ‡ç‰‡):</p>
<pre><code>a = append(a, x...)       // ä¸ºxåˆ‡ç‰‡æ‰©å±•è¶³å¤Ÿçš„ç©ºé—´
copy(a[i+len(x):], a[i:]) // a[i:]å‘åç§»åŠ¨len(x)ä¸ªä½ç½®
copy(a[i:], x)            // å¤åˆ¶æ–°æ·»åŠ çš„åˆ‡ç‰‡
</code></pre>
<p>ç¨æ˜¾ä¸è¶³çš„æ˜¯ï¼Œåœ¨ç¬¬ä¸€å¥æ‰©å±•åˆ‡ç‰‡å®¹é‡çš„æ—¶å€™ï¼Œæ‰©å±•ç©ºé—´éƒ¨åˆ†çš„å…ƒç´ å¤åˆ¶æ˜¯æ²¡æœ‰å¿…è¦çš„ã€‚æ²¡æœ‰ä¸“é—¨çš„å†…ç½®   å‡½æ•°ç”¨äºæ‰©å±•åˆ‡ç‰‡çš„å®¹é‡ï¼Œappendæœ¬è´¨æ˜¯ç”¨äºè¿½åŠ å…ƒç´ è€Œä¸æ˜¯æ‰©å±•å®¹é‡ï¼Œæ‰©å±•åˆ‡ç‰‡å®¹é‡åªæ˜¯appendçš„ä¸€    ä¸ªå‰¯ä½œç”¨ã€‚</p>
</li>
<li>
<p>åˆ é™¤åˆ‡ç‰‡å…ƒç´ </p>
<p>æ ¹æ®è¦åˆ é™¤å…ƒç´ çš„ä½ç½®æœ‰ä¸‰ç§æƒ…å†µï¼šä»å¼€å¤´ä½ç½®åˆ é™¤ï¼Œä»ä¸­é—´ä½ç½®åˆ é™¤ï¼Œä»å°¾éƒ¨åˆ é™¤ã€‚å…¶ä¸­åˆ é™¤åˆ‡ç‰‡å°¾éƒ¨   çš„å…ƒç´ æœ€å¿«ï¼š</p>
<pre><code>a = []int{1, 2, 3}
a = a[:len(a)-1]   // åˆ é™¤å°¾éƒ¨1ä¸ªå…ƒç´ 
a = a[:len(a)-N]   // åˆ é™¤å°¾éƒ¨Nä¸ªå…ƒç´ 
</code></pre>
<p>åˆ é™¤å¼€å¤´çš„å…ƒç´ å¯ä»¥ç›´æ¥ç§»åŠ¨æ•°æ®æŒ‡é’ˆï¼š</p>
<pre><code>a = []int{1, 2, 3}
a = a[1:] // åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´ 
a = a[N:] // åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´ 
</code></pre>
<p>åˆ é™¤å¼€å¤´çš„å…ƒç´ ä¹Ÿå¯ä»¥ä¸ç§»åŠ¨æ•°æ®æŒ‡é’ˆï¼Œä½†æ˜¯å°†åé¢çš„æ•°æ®å‘å¼€å¤´ç§»åŠ¨ã€‚å¯ä»¥ç”¨appendåŸåœ°å®Œæˆï¼ˆæ‰€è°“åŸ   åœ°å®Œæˆæ˜¯æŒ‡åœ¨åŸæœ‰çš„åˆ‡ç‰‡æ•°æ®å¯¹åº”çš„å†…å­˜åŒºé—´å†…å®Œæˆï¼Œä¸ä¼šå¯¼è‡´å†…å­˜ç©ºé—´ç»“æ„çš„å˜åŒ–ï¼‰ï¼š</p>
<pre><code>a = []int{1, 2, 3}
a = append(a[:0], a[1:]...) // åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´ 
a = append(a[:0], a[N:]...) // åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´ 
</code></pre>
<blockquote>
<p>å‡è®¾åˆ‡ç‰‡é‡Œå­˜æ”¾çš„æ˜¯æŒ‡é’ˆå¯¹è±¡ï¼Œé‚£ä¹ˆä¸‹é¢åˆ é™¤æœ«å°¾çš„å…ƒç´ åï¼Œè¢«åˆ é™¤çš„å…ƒç´ ä¾ç„¶è¢«åˆ‡ç‰‡åº•å±‚æ•°ç»„å¼•ç”¨ï¼Œ<br>
ä»è€Œå¯¼è‡´ä¸èƒ½åŠæ—¶è¢«è‡ªåŠ¨åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼ˆè¿™è¦ä¾èµ–å›æ”¶å™¨çš„å®ç°æ–¹å¼ï¼‰ï¼š</p>
<pre><code>var a []*int{ ... }
a = a[:len(a)-1]    // è¢«åˆ é™¤çš„æœ€åä¸€ä¸ªå…ƒç´ ä¾ç„¶è¢«å¼•ç”¨, å¯èƒ½å¯¼è‡´GCæ“ä½œè¢«é˜»ç¢
</code></pre>
<p>ä¿é™©çš„æ–¹å¼æ˜¯å…ˆå°†éœ€è¦è‡ªåŠ¨å†…å­˜å›æ”¶çš„å…ƒç´ è®¾ç½®ä¸ºnilï¼Œä¿è¯è‡ªåŠ¨å›æ”¶å™¨å¯ä»¥å‘ç°éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åå†è¿›è¡Œåˆ‡ç‰‡çš„åˆ é™¤æ“ä½œï¼š</p>
<pre><code>var a []*int{ ... }
a[len(a)-1] = nil // GCå›æ”¶æœ€åä¸€ä¸ªå…ƒç´ å†…å­˜
a = a[:len(a)-1]  // ä»åˆ‡ç‰‡åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ 
</code></pre>
<p>å½“ç„¶ï¼Œå¦‚æœåˆ‡ç‰‡å­˜åœ¨çš„å‘¨æœŸå¾ˆçŸ­çš„è¯ï¼Œå¯ä»¥ä¸ç”¨åˆ»æ„å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚å› ä¸ºå¦‚æœåˆ‡ç‰‡æœ¬èº«å·²ç»å¯ä»¥è¢«GCå›æ”¶çš„è¯ï¼Œåˆ‡ç‰‡å¯¹åº”çš„æ¯ä¸ªå…ƒç´ è‡ªç„¶ä¹Ÿå°±æ˜¯å¯ä»¥è¢«å›æ”¶çš„äº†ã€‚</p>
</blockquote>
<p>ä¹Ÿå¯ä»¥ç”¨copyå®Œæˆåˆ é™¤å¼€å¤´çš„å…ƒç´ ï¼š</p>
<pre><code>a = []int{1, 2, 3}
a = a[:copy(a, a[1:])] // åˆ é™¤å¼€å¤´1ä¸ªå…ƒç´ 
a = a[:copy(a, a[N:])] // åˆ é™¤å¼€å¤´Nä¸ªå…ƒç´ 
</code></pre>
<p>å¯¹äºåˆ é™¤ä¸­é—´çš„å…ƒç´ ï¼Œéœ€è¦å¯¹å‰©ä½™çš„å…ƒç´ è¿›è¡Œä¸€æ¬¡æ•´ä½“æŒªåŠ¨ï¼ŒåŒæ ·å¯ä»¥ç”¨appendæˆ–copyåŸåœ°å®Œæˆï¼š</p>
<pre><code>a = []int{1, 2, 3, ...}

a = append(a[:i], a[i+1:]...) // åˆ é™¤ä¸­é—´1ä¸ªå…ƒç´ 
a = append(a[:i], a[i+N:]...) // åˆ é™¤ä¸­é—´Nä¸ªå…ƒç´ 

a = a[:i+copy(a[i:], a[i+1:])]  // åˆ é™¤ä¸­é—´1ä¸ªå…ƒç´ 
a = a[:i+copy(a[i:], a[i+N:])]  // åˆ é™¤ä¸­é—´Nä¸ªå…ƒç´ 
</code></pre>
<p>åˆ é™¤å¼€å¤´çš„å…ƒç´ å’Œåˆ é™¤å°¾éƒ¨çš„å…ƒç´ éƒ½å¯ä»¥è®¤ä¸ºæ˜¯åˆ é™¤ä¸­é—´å…ƒç´ æ“ä½œçš„ç‰¹æ®Šæƒ…å†µã€‚</p>
</li>
</ul>
<h2 id="å‡½æ•°">å‡½æ•°</h2>
<ul>
<li>
<p>å½“å¯å˜å‚æ•°æ˜¯ä¸€ä¸ªç©ºæ¥å£ç±»å‹æ—¶ï¼Œè°ƒç”¨è€…æ˜¯å¦è§£åŒ…å¯å˜å‚æ•°ä¼šå¯¼è‡´ä¸åŒçš„ç»“æœï¼š</p>
<pre><code>func main() {
   var a = []interface{}{123, &quot;abc&quot;}

   Print(a...) // [123 abc]
   Print(a)    // [[123 abc]]
}

func Print(a ...interface{}) {
   fmt.Println(a...)
}
</code></pre>
<p>ç¬¬ä¸€ä¸ªPrintè°ƒç”¨æ—¶ä¼ å…¥çš„å‚æ•°æ˜¯a...ï¼Œç­‰ä»·äºç›´æ¥è°ƒç”¨Print(123, &quot;abc&quot;)ã€‚ç¬¬äºŒä¸ªPrintè°ƒç”¨ä¼ å…¥çš„   æ˜¯æœªè§£åŒ…çš„aï¼Œç­‰ä»·äºç›´æ¥è°ƒç”¨Print([]interface{}{123, &quot;abc&quot;})</p>
</li>
<li>
<p>deferè¯­å¥å»¶è¿Ÿæ‰§è¡Œäº†ä¸€ä¸ªåŒ¿åå‡½æ•°ï¼Œå› ä¸ºè¿™ä¸ªåŒ¿åå‡½æ•°æ•è·äº†å¤–éƒ¨å‡½æ•°çš„å±€éƒ¨å˜é‡vï¼Œè¿™ç§å‡½æ•°æˆ‘ä»¬ä¸€èˆ¬å«é—­åŒ…ã€‚é—­åŒ…å¯¹æ•è·çš„å¤–éƒ¨å˜é‡å¹¶ä¸æ˜¯ä¼ å€¼æ–¹å¼è®¿é—®ï¼Œè€Œæ˜¯ä»¥<font color=red><strong>å¼•ç”¨</strong></font>çš„æ–¹å¼è®¿é—®</p>
<p>é—­åŒ…çš„è¿™ç§å¼•ç”¨æ–¹å¼è®¿é—®å¤–éƒ¨å˜é‡çš„è¡Œä¸ºå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›éšå«çš„é—®é¢˜ï¼š</p>
<pre><code>func main() {
    for i := 0; i &lt; 3; i++ {
        defer func(){ println(i) } ()
    }
}
// Output:
// 3
// 3
// 3
</code></pre>
<p>å› ä¸ºæ˜¯é—­åŒ…ï¼Œåœ¨forè¿­ä»£è¯­å¥ä¸­ï¼Œæ¯ä¸ªdeferè¯­å¥å»¶è¿Ÿæ‰§è¡Œçš„å‡½æ•°å¼•ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªiè¿­ä»£å˜é‡ï¼Œåœ¨å¾ªç¯ç»“æŸåè¿™ä¸ªå˜é‡çš„å€¼ä¸º3ï¼Œå› æ­¤æœ€ç»ˆè¾“å‡ºçš„éƒ½æ˜¯3ã€‚</p>
<p>ä¿®å¤çš„æ€è·¯æ˜¯åœ¨æ¯è½®è¿­ä»£ä¸­ä¸ºæ¯ä¸ªdeferå‡½æ•°ç”Ÿæˆç‹¬æœ‰çš„å˜é‡ã€‚å¯ä»¥ç”¨ä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š</p>
<pre><code>func main() {
    for i := 0; i &lt; 3; i++ {
        i := i // å®šä¹‰ä¸€ä¸ªå¾ªç¯ä½“å†…å±€éƒ¨å˜é‡i
        defer func(){ println(i) } () //å› ä¸ºæ˜¯å¼•ç”¨ï¼Œæ‰€ä»¥è¿™é‡Œçš„å±€éƒ¨å˜é‡iæ¯æ¬¡å¾ªç¯åœ°å€å‡ä¸åŒ
    }
}

func main() {
    for i := 0; i &lt; 3; i++ {
        // é€šè¿‡å‡½æ•°ä¼ å…¥i
        // defer è¯­å¥ä¼šé©¬ä¸Šå¯¹è°ƒç”¨å‚æ•°æ±‚å€¼
        defer func(i int){ println(i) } (i)
    }
}
</code></pre>
</li>
</ul>
<h2 id="æ–¹æ³•">æ–¹æ³•</h2>
<ul>
<li>Goè¯­è¨€ä¸­ï¼Œé€šè¿‡åœ¨ç»“æ„ä½“å†…ç½®åŒ¿åçš„æˆå‘˜æ¥å®ç°ç»§æ‰¿ï¼š</li>
</ul>
<pre><code>type Cache struct {
    m map[string]string
     sync.Mutex
     }
     
 func (p *Cache) Lookup(key string) string {
     p.Lock()
     defer p.Unlock()
     
     return p.m[key]
     }
</code></pre>
<p>Cacheç»“æ„ä½“ç±»å‹é€šè¿‡åµŒå…¥ä¸€ä¸ªåŒ¿åçš„sync.Mutexæ¥ç»§æ‰¿å®ƒçš„Lockå’ŒUnlockæ–¹æ³•. ä½†æ˜¯åœ¨è°ƒç”¨           p.Lock()å’Œp.Unlock()æ—¶, på¹¶ä¸æ˜¯Lockå’ŒUnlockæ–¹æ³•çš„çœŸæ­£æ¥æ”¶è€…, è€Œæ˜¯ä¼šå°†å®ƒä»¬å±•å¼€ä¸º           p.Mutex.Lock()å’Œp.Mutex.Unlock()è°ƒç”¨. è¿™ç§å±•å¼€æ˜¯ç¼–è¯‘æœŸå®Œæˆçš„, å¹¶æ²¡æœ‰è¿è¡Œæ—¶ä»£ä»·.</p>
<h2 id="æ¥å£">æ¥å£</h2>
<ul>
<li>æœ‰æ—¶å€™å¯¹è±¡å’Œæ¥å£ä¹‹é—´å¤ªçµæ´»äº†ï¼Œå¯¼è‡´æˆ‘ä»¬éœ€è¦äººä¸ºåœ°é™åˆ¶è¿™ç§æ— æ„ä¹‹é—´çš„é€‚é…
<ul>
<li>å¸¸è§çš„åšæ³•æ˜¯å®šä¹‰ä¸€ä¸ªå«ç‰¹æ®Šæ–¹æ³•æ¥åŒºåˆ†æ¥å£ã€‚</li>
<li>å†ä¸¥æ ¼ä¸€ç‚¹çš„åšæ³•æ˜¯ç»™æ¥å£å®šä¹‰ä¸€ä¸ªç§æœ‰æ–¹æ³•ã€‚åªæœ‰æ»¡è¶³äº†è¿™ä¸ªç§æœ‰æ–¹æ³•çš„å¯¹è±¡æ‰å¯èƒ½æ»¡è¶³è¿™ä¸ªæ¥å£ï¼Œè€Œç§æœ‰æ–¹æ³•çš„åå­—æ˜¯åŒ…å«åŒ…çš„ç»å¯¹è·¯å¾„åçš„ï¼Œå› æ­¤åªèƒ½åœ¨åŒ…å†…éƒ¨å®ç°è¿™ä¸ªç§æœ‰æ–¹æ³•æ‰èƒ½æ»¡è¶³è¿™ä¸ªæ¥å£ã€‚</li>
</ul>
<pre><code>type testing.TB interface {
Error(args ...interface{})
Errorf(format string, args ...interface{})
...

// A private method to prevent users implementing the
// interface and so future additions to it will not
// violate Go 1 compatibility.
private()
}
</code></pre>
</li>
</ul>
<p>ä¸è¿‡è¿™ç§é€šè¿‡ç§æœ‰æ–¹æ³•ç¦æ­¢å¤–éƒ¨å¯¹è±¡å®ç°æ¥å£çš„åšæ³•ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ï¼šé¦–å…ˆæ˜¯è¿™ä¸ªæ¥å£åªèƒ½åŒ…å†…éƒ¨ä½¿ç”¨ï¼Œå¤–éƒ¨åŒ…æ­£å¸¸æƒ…å†µä¸‹æ˜¯æ— æ³•ç›´æ¥åˆ›å»ºæ»¡è¶³è¯¥æ¥å£å¯¹è±¡çš„ï¼›å…¶æ¬¡ï¼Œè¿™ç§é˜²æŠ¤æªæ–½ä¹Ÿä¸æ˜¯ç»å¯¹çš„ï¼Œæ¶æ„çš„ç”¨æˆ·ä¾ç„¶å¯ä»¥ç»•è¿‡è¿™ç§ä¿æŠ¤æœºåˆ¶,å¦‚ä¸‹</p>
<pre><code>package main

import (
    &quot;fmt&quot;
    &quot;testing&quot;
)

type TB struct {
    testing.TB  //éšå¼è½¬æ¢äº†TBæ¥å£ä¸ºtesting.TB
}

func (p *TB) Fatal(args ...interface{}) {
    fmt.Println(&quot;TB.Fatal disabled!&quot;)
}

func main() {
    var tb testing.TB = new(TB)
    tb.Fatal(&quot;Hello, playground&quot;)
}
</code></pre>
<p>è¿™ç§é€šè¿‡åµŒå…¥åŒ¿åæ¥å£æˆ–åµŒå…¥åŒ¿åæŒ‡é’ˆå¯¹è±¡æ¥å®ç°ç»§æ‰¿çš„åšæ³•å…¶å®æ˜¯ä¸€ç§çº¯è™šç»§æ‰¿ï¼Œæˆ‘ä»¬ç»§æ‰¿çš„åªæ˜¯æ¥å£æŒ‡å®šçš„è§„èŒƒï¼ŒçœŸæ­£çš„å®ç°åœ¨è¿è¡Œçš„æ—¶å€™æ‰è¢«æ³¨å…¥ã€‚</p>
<h2 id="å¹¶å‘">å¹¶å‘</h2>
<ul>
<li>
<p>åœ¨Goè¯­è¨€ä¸­ï¼ŒåŒä¸€ä¸ªGoroutineçº¿ç¨‹å†…éƒ¨ï¼Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯å¾—åˆ°ä¿è¯çš„ã€‚ä½†æ˜¯ä¸åŒçš„Goroutineä¹‹é—´ï¼Œå¹¶ä¸æ»¡è¶³é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ï¼Œéœ€è¦é€šè¿‡æ˜ç¡®å®šä¹‰çš„åŒæ­¥äº‹ä»¶æ¥ä½œä¸ºåŒæ­¥çš„å‚è€ƒã€‚å¦‚æœä¸¤ä¸ªäº‹ä»¶ä¸å¯æ’åºï¼Œé‚£ä¹ˆå°±è¯´è¿™ä¸¤ä¸ªäº‹ä»¶æ˜¯å¹¶å‘çš„ã€‚ä¸ºäº†æœ€å¤§åŒ–å¹¶è¡Œï¼ŒGoè¯­è¨€çš„ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åœ¨ä¸å½±å“ä¸Šè¿°è§„å®šçš„å‰æä¸‹å¯èƒ½ä¼šå¯¹æ‰§è¡Œè¯­å¥é‡æ–°æ’åºï¼ˆCPUä¹Ÿä¼šå¯¹ä¸€äº›æŒ‡ä»¤è¿›è¡Œä¹±åºæ‰§è¡Œï¼‰ã€‚</p>
<pre><code>package main

import (
  &quot;fmt&quot;
)

var d string
var b bool


func setup() {
  d = &quot;hello world&quot;
  fmt.Println(d)
  b = true
}

func main() {
  done := make(chan int)

  go func() {
  	setup()
  	done &lt;- 1   //ä¼ å…¥ä¿¡å·è¯´æ˜setupæ‰§è¡Œå®Œæ¯•
  }()
  &lt;- done        //æ¥æ”¶åˆ°ä¿¡å·è¯´æ˜bçš„å€¼å·²ç»åˆ·æ–°å®Œæ¯•ï¼Œä¸»è¿›ç¨‹èƒ½æ­£ç¡®ç›‘å¬åˆ°bçš„å€¼
  if !b {}
  print(d)
}
</code></pre>
<pre><code>var d string
var b bool


func setup() {
    d = &quot;hello world&quot;
    fmt.Println(d)
    b = true
}

 func main() {
     var wg sync.WaitGroup
     wg.Add(1)       //1è¡¨ç¤º1æ¬¡doneä¹‹åå…³é—­wait
     go func() {
         setup()
         wg.Done()
 }()

 
wg.Wait()     //èƒ½å¦æ¥å—åˆ°æ•°æ®
   if !b {}
   print(d)
}
</code></pre>
<blockquote>
<p>channelå°±æ˜¯ä¸ºäº†è®©ç¨‹åºæ»¡è¶³é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹</p>
</blockquote>
<pre><code>var limit = make(chan int, 3)
var work =[]func()time.Time {time.Now}

func main() {
    for _, w := range work {
        go func(w func()time.Time) {
            limit &lt;- 1
            w()
            }(w)                       // ä¼ å…¥wä»¥é˜²åªå–forå¾ªç¯æœ€åä¸€ä¸ªw
 }

 for{                                // æ­»å¾ªç¯åˆ¤æ–­limitæ˜¯å¦æœ‰ä¿¡å·
 	select {
 	case &lt;-limit:              // æ¥æ”¶åˆ°ä¿¡å·è¿›å…¥case
 		fmt.Println(&quot;done&quot;)
 		return
 	default:
 		fmt.Println(&quot;not done&quot;)
 	}
 }
}
</code></pre>
</li>
</ul>
<h2 id="å¹¶å‘æ¨¡å‹">å¹¶å‘æ¨¡å‹</h2>
<ul>
<li>ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</li>
</ul>
<pre><code>  package main 
  
  import (
	&quot;fmt&quot;
	&quot;time&quot;
    )
  func main() {
	
    var ch = make(chan int,100)
	go producer(1,ch)                   // ç”Ÿæˆ1çš„å€æ•°åºåˆ—
	go producer(2,ch)                  // ç”Ÿæˆ2çš„å€æ•°åºåˆ—
	go consumer(ch)                   //æ¶ˆè´¹ç”Ÿæˆçš„é˜Ÿåˆ—

	time.Sleep(time.Millisecond)
  }
  func producer(factor int, out chan&lt;- int) {
	for i := 0; ; i++ {
		out &lt;- i * factor
	}
  }

  func consumer(in &lt;-chan int) {
	for v := range in {
		fmt.Println(v)
	}
    }
</code></pre>
<ul>
<li>å‘å¸ƒè®¢é˜…æ¨¡å‹<br>
å‘å¸ƒè€…</li>
</ul>
<pre><code>// Package pubsub implements a simple multi-topic pub-sub library.
package pubsub

import (
&quot;sync&quot;
&quot;time&quot;
)

type (
    subscriber chan interface{}         // è®¢é˜…è€…ä¸ºä¸€ä¸ªç®¡é“
    topicFunc  func(v interface{}) bool // ä¸»é¢˜ä¸ºä¸€ä¸ªè¿‡æ»¤å™¨
)

// å‘å¸ƒè€…å¯¹è±¡
type Publisher struct {
	m           sync.RWMutex             // è¯»å†™é”
	buffer      int                      // è®¢é˜…é˜Ÿåˆ—çš„ç¼“å­˜å¤§å°
	timeout     time.Duration            // å‘å¸ƒè¶…æ—¶æ—¶é—´
  subscribers map[subscriber]topicFunc // è®¢é˜…è€…ä¿¡æ¯
}

// æ„å»ºä¸€ä¸ªå‘å¸ƒè€…å¯¹è±¡, å¯ä»¥è®¾ç½®å‘å¸ƒè¶…æ—¶æ—¶é—´å’Œç¼“å­˜é˜Ÿåˆ—çš„é•¿åº¦
func NewPublisher(publishTimeout time.Duration, buffer int) *Publisher {
  return &amp;Publisher{
  	buffer:      buffer,
  	timeout:     publishTimeout,
  	subscribers: make(map[subscriber]topicFunc),
  }
}

// æ·»åŠ ä¸€ä¸ªæ–°çš„è®¢é˜…è€…ï¼Œè®¢é˜…å…¨éƒ¨ä¸»é¢˜
func (p *Publisher) Subscribe() chan interface{} {
  return p.SubscribeTopic(nil)
}

// æ·»åŠ ä¸€ä¸ªæ–°çš„è®¢é˜…è€…ï¼Œè®¢é˜…è¿‡æ»¤å™¨ç­›é€‰åçš„ä¸»é¢˜
func (p *Publisher) SubscribeTopic(topic topicFunc) chan interface{} {
  ch := make(chan interface{}, p.buffer)
  p.m.Lock()
  p.subscribers[ch] = topic
  p.m.Unlock()
  return ch
}

// é€€å‡ºè®¢é˜…
func (p *Publisher) Evict(sub chan interface{}) {
  p.m.Lock()
  defer p.m.Unlock()

  delete(p.subscribers, sub)
  close(sub)
}

// å‘å¸ƒä¸€ä¸ªä¸»é¢˜
func (p *Publisher) Publish(v interface{}) {
  p.m.RLock()
  defer p.m.RUnlock()

  var wg sync.WaitGroup
  for sub, topic := range p.subscribers {
  	wg.Add(1)
  	go p.sendTopic(sub, topic, v, &amp;wg)  // wgä¸æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸€å®šè¦ä¼ æŒ‡é’ˆ
  }
  wg.Wait()
}

// å…³é—­å‘å¸ƒè€…å¯¹è±¡ï¼ŒåŒæ—¶å…³é—­æ‰€æœ‰çš„è®¢é˜…è€…ç®¡é“ã€‚
func (p *Publisher) Close() {
	p.m.Lock()
	defer p.m.Unlock()

	for sub := range p.subscribers {
  	delete(p.subscribers, sub)
  	close(sub)
  }
}

// å‘é€ä¸»é¢˜ï¼Œå¯ä»¥å®¹å¿ä¸€å®šçš„è¶…æ—¶
func (p *Publisher) sendTopic(
	sub subscriber, topic topicFunc, v interface{}, wg *sync.WaitGroup,
) {
  defer wg.Done()
  if topic != nil &amp;&amp; !topic(v) {    //å¦‚æœtopicæ˜¯ç©ºï¼Œä¼šå°†æ‰€æœ‰v ä¼ åˆ°subé‡Œé¢å»ï¼Œå¦‚æœä¸ä¸ºç©ºå¹¶ä¸”topicfuncå°†vä¼ å…¥åçš„è¿”å›å€¼ä¸ºtrueæ—¶æ‰ä¼šæŠŠvä¼ åˆ°sub
  	return
  }

  select {
  case sub &lt;- v:
  case &lt;-time.After(p.timeout):
  }
}
</code></pre>
<p>è®¢é˜…è€…ï¼š</p>
<pre><code>package main

import (
	&quot;demo/demo2/pub&quot;
	&quot;fmt&quot;
	&quot;strings&quot;
	&quot;time&quot;
)


func main() {
	pub := pubsub.NewPublisher(100*time.Millisecond,3)
	defer pub.Close()


	all := pub.Subscribe()

	golang := pub.SubscribeTopic(func(v interface{}) bool{
		if s,ok := v.(string);ok {
			return strings.Contains(s,&quot;golang&quot;)
		}
		return false
	})

	pub.Publish(&quot;hello world&quot;)
	pub.Publish(&quot;hello tanxin&quot;)
	pub.Publish(&quot;hello golang&quot;)
	a:= &lt;-all
	b:= &lt;- golang
	fmt.Println(a)
	fmt.Println(b)

	go func() {
		for msg := range all{
			fmt.Println(&quot;all:&quot;,msg)
		}
	}()

	go func() {
		for msg := range golang{
			fmt.Println(&quot;golang:&quot;,msg)
		}
	}()

	time.Sleep(1* time.Second)
}

</code></pre>
<h2 id="å¹¶å‘çš„å®‰å…¨é€€å‡º">å¹¶å‘çš„å®‰å…¨é€€å‡º</h2>
<ul>
<li>ä½¿ç”¨selectå®‰å…¨é€€å‡º</li>
</ul>
<pre><code>package main

import (
	&quot;fmt&quot;
	&quot;sync&quot;
	&quot;time&quot;
)

func worker(wg *sync.WaitGroup, cannel chan bool) {
	defer wg.Done()

	for {
		select {
		default:
			fmt.Println(&quot;hello&quot;)
		case &lt;-cannel:
			return
		}
	}
}

func main() {
	cancel := make(chan bool)

	var wg sync.WaitGroup
	for i := 0; i &lt; 10; i++ {
		wg.Add(1)
		go worker(&amp;wg, cancel)
	}

	time.Sleep(time.Second)
	close(cancel)
	wg.Wait()
}
</code></pre>
<ul>
<li>ä½¿ç”¨contextåŒ…æ¥å®‰å…¨é€€å‡º<br>
åœ¨Go1.7å‘å¸ƒæ—¶ï¼Œæ ‡å‡†åº“å¢åŠ äº†ä¸€ä¸ªcontextåŒ…ï¼Œç”¨æ¥ç®€åŒ–å¯¹äºå¤„ç†å•ä¸ªè¯·æ±‚çš„å¤šä¸ªGoroutineä¹‹é—´ä¸è¯·æ±‚åŸŸçš„æ•°æ®ã€è¶…æ—¶å’Œé€€å‡ºç­‰æ“ä½œ</li>
</ul>
<pre><code>func worker(ctx context.Context, wg *sync.WaitGroup) error {
    defer wg.Done()

    for {
        select {
        default:
            fmt.Println(&quot;hello&quot;)
        case &lt;-ctx.Done():
            return ctx.Err()
        }
    }
}

func main() {
    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)

    var wg sync.WaitGroup
    for i := 0; i &lt; 10; i++ {
        wg.Add(1)
        go worker(ctx, &amp;wg)
    }

    time.Sleep(time.Second)
    cancel()                               

    wg.Wait()
}
</code></pre>
<h2 id="å¼‚å¸¸">å¼‚å¸¸</h2>
<p>Goè¯­è¨€å‡½æ•°è°ƒç”¨çš„æ­£å¸¸æµç¨‹æ˜¯å‡½æ•°æ‰§è¡Œè¿”å›è¯­å¥è¿”å›ç»“æœï¼Œåœ¨è¿™ä¸ªæµç¨‹ä¸­æ˜¯æ²¡æœ‰å¼‚å¸¸çš„ï¼Œå› æ­¤åœ¨è¿™ä¸ªæµç¨‹ä¸­æ‰§è¡Œrecoverå¼‚å¸¸æ•è·å‡½æ•°å§‹ç»ˆæ˜¯è¿”å›nilã€‚å¦ä¸€ç§æ˜¯å¼‚å¸¸æµç¨‹: å½“å‡½æ•°è°ƒç”¨panicæŠ›å‡ºå¼‚å¸¸ï¼Œå‡½æ•°å°†åœæ­¢æ‰§è¡Œåç»­çš„æ™®é€šè¯­å¥ï¼Œä½†æ˜¯ä¹‹å‰æ³¨å†Œçš„deferå‡½æ•°è°ƒç”¨ä»ç„¶ä¿è¯ä¼šè¢«æ­£å¸¸æ‰§è¡Œï¼Œç„¶åå†è¿”å›åˆ°è°ƒç”¨è€…ã€‚å¯¹äºå½“å‰å‡½æ•°çš„è°ƒç”¨è€…ï¼Œå› ä¸ºå¤„ç†å¼‚å¸¸çŠ¶æ€è¿˜æ²¡æœ‰è¢«æ•è·ï¼Œå’Œç›´æ¥è°ƒç”¨panicå‡½æ•°çš„è¡Œä¸ºç±»ä¼¼ã€‚åœ¨å¼‚å¸¸å‘ç”Ÿæ—¶ï¼Œå¦‚æœåœ¨deferä¸­æ‰§è¡Œrecoverè°ƒç”¨ï¼Œå®ƒå¯ä»¥æ•è·è§¦å‘panicæ—¶çš„å‚æ•°ï¼Œå¹¶ä¸”æ¢å¤åˆ°æ­£å¸¸çš„æ‰§è¡Œæµç¨‹ã€‚</p>
<pre><code>func main() {
    if r := recover(); r != nil {
        log.Fatal(r)
    }

    panic(123)

    if r := recover(); r != nil {
        log.Fatal(r)
    }
}
</code></pre>
<p>ä¸Šé¢ç¨‹åºä¸­ä¸¤ä¸ªrecoverè°ƒç”¨éƒ½ä¸èƒ½æ•è·ä»»ä½•å¼‚å¸¸ã€‚åœ¨ç¬¬ä¸€ä¸ªrecoverè°ƒç”¨æ‰§è¡Œæ—¶ï¼Œå‡½æ•°å¿…ç„¶æ˜¯åœ¨æ­£å¸¸çš„éå¼‚å¸¸æ‰§è¡Œæµç¨‹ä¸­ï¼Œè¿™æ—¶å€™recoverè°ƒç”¨å°†è¿”å›nilã€‚å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œç¬¬äºŒä¸ªrecoverè°ƒç”¨å°†æ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œåˆ°ï¼Œå› ä¸ºpanicè°ƒç”¨ä¼šå¯¼è‡´å‡½æ•°é©¬ä¸Šæ‰§è¡Œå·²ç»æ³¨å†Œdeferçš„å‡½æ•°åè¿”å›ã€‚</p>
<p>å…¶å®recoverå‡½æ•°è°ƒç”¨æœ‰ç€æ›´ä¸¥æ ¼çš„è¦æ±‚ï¼šæˆ‘ä»¬å¿…é¡»åœ¨deferå‡½æ•°ä¸­ç›´æ¥è°ƒç”¨recoverã€‚å¦‚æœdeferä¸­è°ƒç”¨çš„æ˜¯recoverå‡½æ•°çš„åŒ…è£…å‡½æ•°çš„è¯ï¼Œå¼‚å¸¸çš„æ•è·å·¥ä½œå°†å¤±è´¥ï¼</p>
<p>åœ¨åµŒå¥—çš„deferå‡½æ•°ä¸­è°ƒç”¨recoverä¹Ÿå°†å¯¼è‡´æ— æ³•æ•è·å¼‚å¸¸ï¼š</p>
<pre><code>func main() {
    defer func() {
        defer func() {
            // æ— æ³•æ•è·å¼‚å¸¸
            if r := recover(); r != nil {
                fmt.Println(r)
            }
        }()
    }()
    panic(1)
}
</code></pre>
<p>2å±‚åµŒå¥—çš„deferå‡½æ•°ä¸­ç›´æ¥è°ƒç”¨recoverå’Œ1å±‚deferå‡½æ•°ä¸­è°ƒç”¨åŒ…è£…çš„MyRecoverå‡½æ•°ä¸€æ ·ï¼Œéƒ½æ˜¯ç»è¿‡äº†2ä¸ªå‡½æ•°å¸§æ‰åˆ°è¾¾çœŸæ­£çš„recoverå‡½æ•°ï¼Œè¿™ä¸ªæ—¶å€™Goroutineçš„å¯¹åº”ä¸Šä¸€çº§æ ˆå¸§ä¸­å·²ç»æ²¡æœ‰å¼‚å¸¸ä¿¡æ¯ã€‚</p>
<p>ç›´æ¥åœ¨deferè¯­å¥ä¸­è°ƒç”¨MyRecoverå‡½æ•°åˆå¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼š</p>
<pre><code>func MyRecover() interface{} {
    return recover()
}

func main() {
    // å¯ä»¥æ­£å¸¸æ•è·å¼‚å¸¸
    defer MyRecover()
    panic(1)
}
</code></pre>
<p>ä½†æ˜¯ï¼Œå¦‚æœdeferè¯­å¥ç›´æ¥è°ƒç”¨recoverå‡½æ•°ï¼Œä¾ç„¶ä¸èƒ½æ­£å¸¸æ•è·å¼‚å¸¸ï¼š</p>
<pre><code>func main() {
    // æ— æ³•æ•è·å¼‚å¸¸
    defer recover()
    panic(1)
}
</code></pre>
<p>å¿…é¡»è¦å’Œæœ‰å¼‚å¸¸çš„æ ˆå¸§åªéš”ä¸€ä¸ªæ ˆå¸§ï¼Œrecoverå‡½æ•°æ‰èƒ½æ­£å¸¸æ•è·å¼‚å¸¸ã€‚æ¢è¨€ä¹‹ï¼Œrecoverå‡½æ•°æ•è·çš„æ˜¯ç¥–çˆ¶ä¸€çº§è°ƒç”¨å‡½æ•°æ ˆå¸§çš„å¼‚å¸¸ï¼ˆåˆšå¥½å¯ä»¥è·¨è¶Šä¸€å±‚deferå‡½æ•°ï¼‰ï¼</p>
<p>å½“å¸Œæœ›å°†æ•è·åˆ°çš„å¼‚å¸¸è½¬ä¸ºé”™è¯¯æ—¶ï¼Œå¦‚æœå¸Œæœ›å¿ å®è¿”å›åŸå§‹çš„ä¿¡æ¯ï¼Œéœ€è¦é’ˆå¯¹ä¸åŒçš„ç±»å‹åˆ†åˆ«å¤„ç†ï¼š</p>
<pre><code>func foo() (err error) {
    defer func() {
        if r := recover(); r != nil {
            switch x := r.(type) {
            case string:
                err = errors.New(x)
            case error:
                err = x
            default:
                err = fmt.Errorf(&quot;Unknown panic: %v&quot;, r)
            }
        }
    }()

    panic(&quot;TODO&quot;)
}
</code></pre>
<p><font size=100><strong>æŒç»­å­¦ä¹ .....</strong></font></p>

            </div>
          </article>
        </div>

        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'db306bd8ac595ee09a0e',
    clientSecret: '7e169f0897298c132e7c038d4d53e8fece891efb',
    repo: 'twFR.github.io',
    owner: 'twFR',
    admin: ['twFR'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  çœŸæœ‰æ„æ€ ç»æ— å¯èƒ½
ä¸è¦æ…Œ é—®é¢˜ä¸å¤§â˜˜
 | 
  <a class="rss" href="https://twFR.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
