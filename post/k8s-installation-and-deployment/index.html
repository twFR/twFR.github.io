<html>
  <head>
    <meta charset="utf-8" />
<meta name="description" content="" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>k8s Installation and deployment | ğŸŒŸè°­å…ˆç”Ÿâœ¨</title>
<link rel="shortcut icon" href="https://twFR.github.io/favicon.ico?v=1610685303140">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
<link rel="stylesheet" href="https://twFR.github.io/styles/main.css">

<script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>



  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://twFR.github.io">
  <img class="avatar" src="https://twFR.github.io/images/avatar.png?v=1610685303140" alt="">
  </a>
  <h1 class="site-title">
    ğŸŒŸè°­å…ˆç”Ÿâœ¨
  </h1>
  <p class="site-description">
    æ•²ä¸å‡ºä»£ç çš„ç¨‹åºçŒ¿çš„ğŸ 
  </p>
  <div class="menu-container">
    
      
        <a href="/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
        <a href="https://www.facebook.com/xin.tan.106902" target="_blank">
          <i class="fab fa-facebook"></i>
        </a>
      
    
  </div>
</div>


        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              k8s Installation and deployment
            </h2>
            <div class="post-info">
              <time class="post-time">
                Â· 2019-11-20 Â·
              </time>
              
                <a href="https://twFR.github.io/tag/Z7--HtZrc/" class="post-tag">
                  # golang
                </a>
              
            </div>
            
            <div class="post-content">
              <h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<ul>
<li>Macos/windowsç³»ç»Ÿç”µè„‘</li>
<li>vmwareè™šæ‹Ÿæœº</li>
<li><a href="http://old-releases.ubuntu.com/releases/18.10/ubuntu-18.10-live-server-amd64.iso">Ubuntu18.10</a></li>
<li><a href="http://m6.pc6.com/xuh6/scrt854.zip">secureCRT</a>ï¼ˆç”¨æ¥ç®¡ç†è™šæ‹Ÿæœºçš„ï¼Œæ¯”ç›´æ¥ç”¨vmwareå¥½ç”¨å¤šäº†ï¼‰</li>
<li><a href="https://download.docker.com/linux/ubuntu/dists/bionic/pool/stable/amd64/docker-ce_18.06.1~ce~3-0~ubuntu_amd64.deb">docker-ce 18.06</a></li>
</ul>
<p>ç”±äºæˆ‘æœ‰ä½ ä»¬æ‡‚å¾—çš„ä¸œè¥¿ï¼Œå¯ä»¥å»å›½å¤–ä¸‹è½½å¯¹åº”çš„é•œåƒç»„ä»¶ç­‰ï¼Œè¿˜æ˜¯æ¯”è¾ƒæ–¹ä¾¿ï¼Œå¦‚æœæ˜¯æ²¡æœ‰çš„è¯ï¼Œå¯èƒ½è¿˜å¾—é…ç½®ç½‘ç»œæºç­‰ä¸œè¥¿ä¼šæ¯”è¾ƒéº»çƒ¦</p>
<h2 id="å®‰è£…ubuntu">å®‰è£…ubuntu</h2>
<p>æˆ‘æ˜¯ç”¨çš„macè£…çš„vnwareï¼Œåœ¨è™šæ‹Ÿæœºé‡Œé¢è£…çš„ubuntuï¼Œè¿˜æ˜¯è›®ç®€å•çš„ï¼Œæ³¨æ„çš„æ˜¯éœ€è¦è‡³å°‘ç»™è™šæ‹Ÿæœºcpuåˆ†é…ä¸¤æ ¸ï¼Œk8sè‡³å°‘è¦ä¸¤æ ¸æ‰èƒ½å®‰è£…</p>
<h4 id="å®‰è£…éœ€è¦çš„è½¯ä»¶">å®‰è£…éœ€è¦çš„è½¯ä»¶</h4>
<p>å®‰è£…ä¸€äº›åŸºç¡€å·¥å…·</p>
<blockquote>
<p>sudo apt-get update &amp;&amp; apt-get install -y curl telnet wget man \</p>
</blockquote>
<blockquote>
<p>apt-transport-https ca-certificates software-properties-common vim</p>
</blockquote>
<h2 id="å®‰è£…docker">å®‰è£…docker</h2>
<ul>
<li>
<p>ä¸‹è½½docker18.06çš„ç¦»çº¿å®‰è£…åŒ…  [18.06]</p>
</li>
<li>
<p>scpåˆ°è‡ªå·±çš„è™šæ‹Ÿæœºä¸Šé¢å»</p>
<p>å…ˆæŸ¥çœ‹è‡ªå·±è™šæ‹Ÿæœºçš„ipåœ°å€ï¼šifconfig<br>
ç„¶å scp docker-ce_18.06.1_ce_3-0_ubuntu_amd64.deb tan@172.16.234.132:/home/tan/package</p>
</li>
</ul>
<p>æå®š</p>
<ul>
<li>
<p>ç¦»çº¿å®‰è£…è™šæ‹Ÿæœº</p>
<blockquote>
<p>sudo dpkg -i  docker-ce_18.06.1_ce_3-0_ubuntu_amd64.deb</p>
</blockquote>
<p>æˆ‘å®‰è£…é‡åˆ°äº†é”™è¯¯ æç¤ºæˆ‘ä¾èµ–ç¼ºå¤± ç„¶åæˆ‘å°±å®‰è£…ä¾èµ–</p>
<blockquote>
<p>sudo apt-get install -y libltd17</p>
</blockquote>
<p>ç„¶ååˆæç¤ºæˆ‘æ‰¾ä¸åˆ°åŒ…ï¼Œåº”è¯¥å°±æ˜¯æºæ–‡ä»¶çš„é—®é¢˜ï¼Œæ›´æ–°ä¸‹æºæ–‡ä»¶</p>
<blockquote>
<p>#ä»…æ£€æŸ¥ï¼Œä¸æ›´æ–°</p>
<p>sudo apt update</p>
<p>#æ›´æ–°å·²å®‰è£…çš„è½¯ä»¶åŒ…</p>
<p>sudo apt upsade</p>
</blockquote>
<p>è§£å†³ä¹‹åé‡æ–°å®‰è£…dockerï¼Œæå®š</p>
</li>
<li>
<p>å…è®¸å¼€æœºå¯åŠ¨docker</p>
<blockquote>
<p>sudo systemctl enable docker</p>
<p>sudo systemctl start docker</p>
</blockquote>
</li>
<li>
<p>å¯åŠ¨ä¸€ä¸ªç²¾ç®€çš„æ“ä½œç³»ç»Ÿå®¹å™¨æµ‹è¯•</p>
<blockquote>
<p>sudo docker run -ti alpine:latest sh</p>
</blockquote>
</li>
<li>
<p>å°†å½“å‰çš„æ™®é€šç”¨æˆ·æ·»åŠ åˆ°å½“å‰çš„dockerç”¨æˆ·ç»„é‡Œé¢å»</p>
<blockquote>
<p>sudo groupadd docker</p>
<p>sudo usermod -aG docker $USER</p>
</blockquote>
</li>
</ul>
<h2 id="kuberneteså®‰è£…">kuberneteså®‰è£…</h2>
<ul>
<li>
<p>å…è´¹çš„é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿå™¨</p>
<p>https://ozcouvlb.mirror.aliyuncs.com</p>
</li>
<li>
<p>é…ç½®å›½å†…é•œåƒåŠ é€Ÿå™¨</p>
<blockquote>
<p>vim /etc/docker/daemon.json</p>
<p>#æ–‡ä»¶é‡Œçš„å†…å®¹å¦‚ä¸‹ï¼š</p>
<p># {</p>
<p>#	&quot;registry-mirrors&quot;:  [https://ozcouvlb.mirror.aliyuncs.com]</p>
<p>#}</p>
</blockquote>
</li>
<li>
<p>é‡å¯dockeræœåŠ¡</p>
<blockquote>
<p>sudo systemctl daemon-reload</p>
<p>sudo systemctl restart docker</p>
</blockquote>
</li>
<li>
<p>é…ç½®å¹¶å®‰è£…k8sæº</p>
</li>
<li>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>sudo vim /etc/apt/sources.list.d/kubernetes.list</p>
<p>#æ·»åŠ ä»¥ä¸‹å†…å®¹</p>
<p>#deb https://mirrors.ustc.edu.cn/kubernetes/apt kubernets-xenial main</p>
<p>sudo chmod 640 /etc/apt/sources.list.d/kubernetes.list</p>
</blockquote>
</li>
<li>
<p>æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ›´æ–°æ“ä½œç³»ç»Ÿæº</p>
</li>
</ul>
<pre><code>&gt; sudo apt update
</code></pre>
<ul>
<li>
<p>æœ‰å¯èƒ½é‡åˆ°çš„é—®é¢˜ NO_PUBKEY,è§£å†³æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>#æ·»åŠ è®¤è¯ ä¸€å®šè¦ç”¨è‡ªå·±çš„è´¦æˆ·æ‰§è¡Œï¼Œä¸èƒ½ç”¨root</p>
</blockquote>
<blockquote>
<p>sudo gpg --keyserver keyserver.ubuntu.com --recv-keys BA07F4FB(å›æ˜¾NO_PUBKEYçš„å8ä½)</p>
<p>sudo gpg --export --armor BA07F4FB</p>
<p>#å°†å›æ˜¾çš„keyä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œé¢</p>
<p>vim pubkey</p>
<p>#å°†leyæ·»åŠ åˆ°æœ¬åœ°çš„truestedæ•°æ®åº“ä¸­</p>
<p>sudo apt-key add pubkey</p>
</blockquote>
</li>
<li>
<p>è§£å†³åå†æ¬¡æ›´æ–°ï¼Œå®Œç¾æå®š</p>
</li>
<li>
<p>ç¦æ­¢åŸºç¡€è®¾æ–½</p>
<ul>
<li>å…³é—­é˜²ç«å¢™ï¼ˆå®¹å™¨ä¹‹é—´é€šè®¯ä¸éœ€è¦è¿™äº›é™åˆ¶,è¯è¯´æˆ‘ä¹‹å‰ç”¨winä¸€ç›´ä¹Ÿéƒ½æ˜¯å…³é—­çš„ï¼‰</li>
</ul>
<blockquote>
<p>sudo ufw disable</p>
</blockquote>
<ul>
<li>
<p>å…³é—­swap(k8sä¸å¸Œæœ›ä½¿ç”¨swap)</p>
<blockquote>
<p>sudo swapoff -a</p>
<p>æ°¸ä¹…å…³é—­</p>
<p>sudo sed -i 's/.*swap.*/#$/' /etc/fstab</p>
</blockquote>
</li>
<li>
<p>ç¦æ­¢selinuxï¼ˆubuntué»˜è®¤å®‰è£…çš„å®‰å…¨ç»„ä»¶ï¼‰</p>
<blockquote>
<p>#å®‰è£…æ“æ§selinuxçš„ç»„ä»¶</p>
<p>sudo apt install -y selinux-utils</p>
<p>#ç¦æ­¢selinux</p>
<p>setenforce 0</p>
<p>#é‡å¯</p>
<p>shutdown -r now</p>
<p>#æŸ¥çœ‹æ˜¯å¦å…³é—­</p>
<p>sudo getenforce</p>
</blockquote>
</li>
</ul>
</li>
<li>
<p>k8sç³»ç»Ÿç½‘ç»œé…ç½®</p>
<ol>
<li>é…ç½®å†…æ ¸å‚æ•°ï¼Œå°†æ¡¥æ¥çš„IPv4æµé‡ä¼ é€’åˆ°iptablesçš„é“¾</li>
</ol>
<p>åˆ›å»ºé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>sudo vim /etc/sysctl.d/k8s.conf</p>
</blockquote>
<p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š</p>
<blockquote>
<p>net.bridge.bridge-nf-call-ip6tables = 1</p>
<p>net.bridge.bridge-nf-call-iptables = 1</p>
<p>vm.swappiness = 0</p>
</blockquote>
<ol start="2">
<li>
<p>ä½¿é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ</p>
<blockquote>
<p>sudo modprobe br_netfilter</p>
</blockquote>
<blockquote>
<p>sudo sysctl -p /etc/sysctl.d/k8s.conf</p>
</blockquote>
</li>
</ol>
</li>
<li>
<p>å®‰è£…k8s</p>
<blockquote>
<p>sudo apt update &amp;&amp; apt-get install -y kubelet=1.13.1-00 kubernetes-cni=0.6.0-00 kubeadm=1.13.1-00 kubectl=1.13.1-00</p>
</blockquote>
<ul>
<li>kubelet æ°¸ä¹…çš„åç«¯æœåŠ¡</li>
<li>kubectl å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œç”¨æˆ·å’Œå¼€å‘è€…ä½¿ç”¨kubectlå¯ä»¥è¿ç»´ç»´æŠ¤k8s</li>
<li>kubeadm ä¹Ÿæ˜¯å®¢æˆ·ç«¯è¿›ç¨‹ï¼Œæƒé™å¾ˆé«˜ï¼Œç›¸å½“äºç®¡ç†å‘˜ï¼Œç”¨çš„å¾ˆå°‘</li>
</ul>
</li>
<li>
<p>è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</p>
<blockquote>
<p>sudo systemctl enable kubelet &amp;&amp; systemctl start kubelet</p>
<p>sudo shutdown -r now</p>
</blockquote>
</li>
<li>
<p>éªŒè¯k8s</p>
<blockquote>
<p>kubectl get nodes</p>
<p>kubectl version</p>
</blockquote>
</li>
</ul>
<h2 id="åˆ›å»ºå¤šèŠ‚ç‚¹">åˆ›å»ºå¤šèŠ‚ç‚¹</h2>
<ul>
<li>
<p>å°†å·²ç»æ­å»ºå¥½çš„ç¯å¢ƒçš„è™šæ‹Ÿæœºå¤åˆ¶ä¸¤ä»½å‡ºæ¥ï¼Œæ­å»ºä¸€ä¸ªä¸‰èŠ‚ç‚¹çš„é›†ç¾¤</p>
<p>å°†å·²ç»æ­å»ºå¥½å¼€å‘ç¯å¢ƒçš„è™šæ‹Ÿæœºå…³æœºï¼Œç„¶ååˆ›å»ºå®Œæ•´å…‹éš†</p>
</li>
<li>
<p>ä¹‹åå†ç”¨ifconfigå‘½ä»¤æŸ¥çœ‹æ–°èŠ‚ç‚¹çš„ipï¼Œç”¨secureCRTç™»å½•èŠ‚ç‚¹</p>
</li>
<li>
<p>ç»™nodeé…ç½®hostname</p>
<blockquote>
<p>su</p>
<p>vim /etc/hostname</p>
<p>#åˆ†åˆ«æ”¹ä¸ºmaster/node1/node2</p>
</blockquote>
</li>
<li>
<p>é…ç½®ipåœ°å€</p>
<blockquote>
<p>vim /etc/netplan/50-cloud-init.yaml</p>
</blockquote>
</li>
</ul>
<p>network:</p>
<p>â€‹	 ethernets:</p>
<p>â€‹			ens33:</p>
<p>â€‹					addresses: [172.16.234.134/24]</p>
<p>â€‹					dhcp4: false</p>
<p>â€‹					gateway4: 172.16.234.2</p>
<p>â€‹					nameservers:</p>
<p>â€‹									addresses: [172.16.234.2]</p>
<p>â€‹					optional: true</p>
<p>â€‹			version: 2</p>
<p>æŒ‰ç…§è‡ªå·±èŠ‚ç‚¹çš„ipé…ç½®ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å®šä¸ºè¿ç»­çš„ipï¼Œæ–¹ä¾¿æ“ä½œï¼Œdhcpæ”¹æˆfalseé˜²æ­¢æ¯æ¬¡é‡å¯ipå˜æ‰</p>
<p>â€‹	&gt; netplan apply</p>
<p>ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<ul>
<li>
<p>ä¿®æ”¹hostsæ–‡ä»¶</p>
<blockquote>
<p>vim /etc/hosts</p>
<p>#è¾“å…¥ä»¥ä¸‹å†…å®¹</p>
<p>#172.16.234.132 master</p>
<p>#172.16.234.133 node1</p>
<p>#172.16.234.134 node2</p>
</blockquote>
</li>
</ul>
<p>ä¸‰ä¸ªèŠ‚ç‚¹å‡éœ€è¦é…ç½®,é€šè¿‡pingæ¥æ£€éªŒæ˜¯å¦é…ç½®æˆåŠŸ</p>
<h2 id="éƒ¨ç½²k8sé›†ç¾¤">éƒ¨ç½²k8sé›†ç¾¤</h2>
<ul>
<li>
<p>---------<font color=red><strong>masterèŠ‚ç‚¹ä¸Šé…ç½®</strong></font> --------</p>
</li>
<li>
<p>åˆ›å»ºk8sçš„ç®¡ç†å·¥å…·kubeadmå¯¹åº”çš„é…ç½®æ–‡ä»¶ï¼Œå€™é€‰æ“ä½œåœ¨/home/itcast/working/ ç›®å½•ä¸‹</p>
</li>
<li>
<p>ä½¿ç”¨kubeadmé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡åœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šdockeré•œåƒåœ°å€éƒ¨ç½²</p>
<p>ç”Ÿæˆé…ç½®æ–‡ä»¶</p>
<blockquote>
<p>kubeadm config print init-defaults ClusterConfiguration &gt; kubeadm.conf</p>
</blockquote>
</li>
<li>
<p>ä¿®æ”¹é…ç½®æ–‡ä»¶é‡Œé¢çš„ä¸‹é¢é¡¹</p>
<blockquote>
<p>vim kubeadm.conf</p>
<p>#ä¿®æ”¹k8sç‰ˆæœ¬å·ä¸ºv1.13.1</p>
<p>kubernetesVersion: v1.13.1</p>
<p>#ä¿®æ”¹hostnameä¸ºmaster</p>
<p>name: master</p>
<p>#ä¿®æ”¹kubeadm.confä¸­çš„APIæœåŠ¡å™¨åœ°å€</p>
<p>localAPIEndpoint:</p>
<p>â€‹    advertiseAddress: 172.16.234.132    # masterçš„IP</p>
<p>â€‹    bindPortï¼š6443</p>
<p>#é…ç½®å­ç½‘ç½‘ç»œ</p>
<p>networking:</p>
<p>â€‹    dnsDomian: cluster.local</p>
<p>â€‹    podSubnet: &quot;10.244.0.0/16&quot;         #  k8så†…éƒ¨podç½‘ç»œ,å®˜æ–¹æ¨è</p>
<p>â€‹    servicesSubnet: 10.96.0.0/12    # k8sæœåŠ¡ç½‘ç»œ,å®˜æ–¹æ¨è</p>
<p>scheduler: {}</p>
</blockquote>
</li>
<li>
<p>æ‹‰å–k8så¿…å¤‡çš„æ¨¡å—é•œåƒ</p>
<blockquote>
<p>#æŸ¥çœ‹éœ€è¦å“ªäº›é•œåƒæ–‡ä»¶éœ€è¦æ‹‰å–</p>
<p>kubeadm config images list --config kubeadm.conf</p>
<p>#k8s.gcr.io/kube-apiserver:v1.13.1.                   å¯¹å¤–ç«¯å£ï¼Œæä¾›å…¥å£è®©å¤–éƒ¨è®¿é—®é›†ç¾¤<br>
#k8s.gcr.io/kube-controller-manager:v1.13.1     å†…éƒ¨ç®¡ç†å™¨<br>
#k8s.gcr.io/kube-scheduler:v1.13.1                   å†…éƒ¨ä»»åŠ¡è°ƒåº¦å™¨<br>
#k8s.gcr.io/kube-proxy:v1.13.1                         è´Ÿè½½å‡è¡¡<br>
#k8s.gcr.io/pause:3.1                                     ä¸šåŠ¡å®¹å™¨å…±äº«Pauseå®¹å™¨çš„ç½‘ç»œæ ˆå’ŒVolumeæŒ‚è½½å·ï¼Œå› æ­¤ä»–ä»¬ä¹‹é—´é€šä¿¡å’Œæ•°æ®äº¤æ¢æ›´ä¸ºé«˜æ•ˆ<br>
#k8s.gcr.io/etcd:3.2.24                                  æ•°æ®ä¸€è‡´æ€§<br>
#k8s.gcr.io/coredns:1.2.6</p>
<p>#æ‹‰å–å…¨éƒ¨å½“å‰ç‰ˆæœ¬k8så…³è”çš„é•œåƒ</p>
<p>kubeadm config images pull --config ./kubeadm.conf</p>
<p>#å¦‚æœæ— æ³•ä¸‹è½½ï¼Œåªèƒ½å»docker.ioä»“åº“æ‰‹åŠ¨æ‹‰é•œåƒç„¶åæ”¹tagï¼ˆæˆ–è€…registry.cn-hangzhou.aliyuncs.com/google_containersï¼‰</p>
<p>docker pull mirrorgooglecontainers/kube-apiserver:v1.13.1</p>
<p>docker tag mirrorgooglecontainers/kube-apiserver:v1.13.1 k8s.gcr.io/kube-apiserver:v1.13.1 #æ‰“tagï¼Œå’Œéœ€è¦çš„é•œåƒåä¿æŒä¸€è‡´</p>
<p>docker rmi mirrorgooglecontainers/kube-apiserver:v1.13.1    #åˆ é™¤æ‰å¤šä½™çš„é•œåƒ</p>
<p>#å…¶ä»–æ‰€æœ‰é•œåƒç±»ä¼¼,k8s.gcr.io/coredns:1.2.6ç‰¹ä¾‹</p>
<p>docker pull coredns/coredns:1.1.3</p>
<p>root@tan:/home/tan/package# docker images<br>
REPOSITORY                           TAG                 IMAGE ID            CREATED             SIZE<br>
k8s.gcr.io/kube-proxy                v1.13.1             fdb321fd30a0        11 months ago       80.2MB<br>
k8s.gcr.io/kube-apiserver            v1.13.1             40a63db91ef8        11 months ago       181MB<br>
k8s.gcr.io/kube-controller-manager   v1.13.1             26e6f1db2a52        11 months ago       146MB<br>
k8s.gcr.io/kube-scheduler            v1.13.1             ab81d7360408        11 months ago       79.6MB<br>
k8s.gcr.io/etcd                      3.2.24              3cab8e1b9802        14 months ago       220MB<br>
k8s.gcr.io/coredns                   1.2.6               b3b94275d97c        18 months ago       45.6MB<br>
k8s.gcr.io/pause                     3.1                 da86e6ba6ca1        23 months ago       742kB</p>
</blockquote>
</li>
<li>
<p>åˆå§‹åŒ–k8sç¯å¢ƒ</p>
<blockquote>
<p>sudo kubeadm init --config ./kubeadm.conf</p>
</blockquote>
</li>
</ul>
<p>å›æ˜¾å¦‚ä¸‹ï¼š</p>
<pre><code>	 &gt; Your Kubernetes master has initialized successfully!
	 &gt;
	 &gt; To start using your cluster, you need to run the following as a regular user:
	 &gt;
	 &gt; â€‹    mkdir -p $HOME/.kube
	 &gt;
	 &gt; â€‹	sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
	 &gt;
	 &gt; â€‹	sudo chown $(id -u):$(id -g) $HOME/.kube/config
	 &gt;
	 &gt; You should now deploy a pod network to the cluster.
	 &gt; Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
	 &gt;   https://kubernetes.io/docs/concepts/cluster-administration/addons/
	 &gt;
	 &gt; You can now join any number of machines by running the following on each node
	 &gt; as root:
	 &gt;
	 &gt;   kubeadm join 172.16.234.132:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:ebc50ff8588c35917f9c6f84f2bd8048352b82bfb9ef06cf5b63934cb9862f49
</code></pre>
<p>æ ¹æ®æç¤ºï¼Œåšå¦‚ä¸‹æ“ä½œ</p>
<blockquote>
<p>#masterèŠ‚ç‚¹åŸºæœ¬æ–‡ä»¶å¤¹é…ç½®</p>
</blockquote>
<blockquote>
<p>mkdir -p $HOME/.kube</p>
<p>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</p>
<p>sudo chown <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><mi>i</mi><mi>d</mi><mo>âˆ’</mo><mi>u</mi><mo>)</mo><mo>:</mo></mrow><annotation encoding="application/x-tex">(id -u):</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathdefault">i</span><span class="mord mathdefault">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">u</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">:</span></span></span></span>(id -g) $HOME/.kube/config</p>
</blockquote>
<p>åŒæ—¶ï¼Œå¦‚æœnodeèŠ‚ç‚¹æƒ³è¦åŠ å…¥masteré›†ç¾¤ï¼Œéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<blockquote>
<p>kubeadm join 172.16.234.132:6443 --token abcdef.0123456789abcdef --discovery-token-ca-cert-hash sha256:ebc50ff8588c35917f9c6f84f2bd8048352b82bfb9ef06cf5b63934cb9862f49</p>
</blockquote>
<ul>
<li>
<p>å¯åŠ¨k8s</p>
<blockquote>
<p>sudo systemctl enable kubelet</p>
<p>sudo systemctl start kubelet</p>
</blockquote>
</li>
<li>
<p>éªŒè¯k8så¯åŠ¨ç»“æœ</p>
<blockquote>
<p>kubectl get node</p>
</blockquote>
</li>
</ul>
<p>å¦‚æœæœ‰é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒè¿™ä¸ª <a href="https://stackoverflow.com/questions/52720380/kubernetes-api-server-is-not-starting-on-a-single-kubeadm-cluster">æ‹‰å–æœ€æ–°ç‰ˆæœ¬</a>ç„¶åé‡æ–°æ¥ä¸€éï¼Œæˆ‘å°±æ˜¯è¿™ä¸ªèŠ±äº†ä¸€ä¸‹åˆï¼ˆå¾®ç¬‘è„¸ï¼‰</p>
<p>æœªå®Œå¾…ç»­ã€‚ã€‚ã€‚</p>

            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://twFR.github.io/post/fibobacci/">
              <h3 class="post-title">
                fibobacci
              </h3>
            </a>
          </div>
        

        
          
            <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>

<script>

  var gitalk = new Gitalk({
    clientID: 'db306bd8ac595ee09a0e',
    clientSecret: '7e169f0897298c132e7c038d4d53e8fece891efb',
    repo: 'twFR.github.io',
    owner: 'twFR',
    admin: ['twFR'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')

</script>

          

          
        

        <div class="site-footer">
  çœŸæœ‰æ„æ€ ç»æ— å¯èƒ½
ä¸è¦æ…Œ é—®é¢˜ä¸å¤§â˜˜
 | 
  <a class="rss" href="https://twFR.github.io/atom.xml" target="_blank">RSS</a>
</div>

<script>
  hljs.initHighlightingOnLoad()
</script>

      </div>
    </div>
  </body>
</html>
